{"version":3,"sources":["features/auth/authSlice.ts","utils/normalizeHref.ts","features/chat/utils/htmlEntity.ts","utils/fetchRequest.ts","api/twitch.ts","api/bttv.ts","api/ffz.ts","api/chatHistory.ts","features/chat/utils/findEmote.ts","features/auth/authUtils.ts","features/options/optionsSelectors.ts","features/auth/hooks/useInitializeAuth.ts","features/chat/hooks/useFetchChatData.ts","features/chat/hooks/useCurrentChannel.ts","hooks/usePrevious.ts","features/chat/utils/replaceEmojis.ts","features/chat/hooks/useTwitchClient.ts","hooks/useSetState.ts","features/chat/utils/getUsersByBeginText.ts","features/chat/hooks/useChatInput.ts","hooks/useOnClickOutside.ts","icons/close.svg","components/IconButton.tsx","components/ChatModal.tsx","icons/smiley-face.svg","components/Scrollbar.tsx","icons/search.svg","features/chat/components/EmotePicker.tsx","features/chat/components/ChatInput.tsx","icons/gears.svg","icons/twitch.svg","components/Button.tsx","components/Switch.tsx","features/options/Options.tsx","features/chat/components/ChatControls.tsx","features/chat/components/Message.tsx","features/chat/components/Notice.tsx","features/chat/components/UserNotice.tsx","features/chat/components/ChatMessage.tsx","features/chat/components/Messages.tsx","features/chat/components/JoinChannel.tsx","features/chat/components/Chat.tsx","features/auth/Auth.tsx","features/auth/Logout.tsx","features/auth/AuthCallback.tsx","styles/common.js","styles/colors.js","styles/vars.js","styles/index.js","app/App.tsx","serviceWorker.ts","app/rootReducer.ts","app/store.ts","index.tsx","features/chat/utils/parseMessageEntities.ts","features/chat/utils/normalizeMessages.ts","features/chat/slice/messages.ts","features/chat/utils/parseApiResponse.ts","features/chat/slice/twitchEmotes.ts","features/chat/slice/bttvEmotes.ts","features/chat/slice/ffzEmotes.ts","features/chat/slice/badges.ts","features/chat/slice/blockedUsers.ts","features/chat/slice/chatSlice.ts","features/chat/slice/params.ts","../../src/client.ts","../../src/utils.ts","../../src/parse.ts","../../src/normalize.ts","../../src/types.ts","features/chat/utils/createEmoteCategories.ts","features/chat/selectors/chatSelectors.ts","features/options/optionsUtils.ts","features/options/optionsSlice.ts","utils/constants.ts","utils/assertNever.ts","features/chat/utils/getEmotesByText.ts","features/chat/utils/emotesUsageStatistic.ts"],"names":["initialState","isAuthReady","isAuth","userId","userLogin","auth","createSlice","name","reducers","initializeAuth","state","payload","invalidateAuth","fetchUserRequest","fetchUserSuccess","data","id","login","fetchUserFailure","actions","fetchUser","async","dispatch","users","api","writeUserToLocatStorage","e","isAuthReadySelector","isAuthSelector","userLoginSelector","userIdSelector","isStartsWithProtocolRegex","normalizeHref","href","test","TWITCH_EMOTES_CDN","regexEmotesMap","getFfzSrcSet","R","dpi","url","createTwitchEmote","code","type","alt","src","srcSet","createBttvEmote","createFfzEmote","urls","createEmoji","createMention","text","target","createLink","createBadges","badges","globalBadges","channelBadges","version","badge","versions","title","description","image_url_1x","imageUrl1x","image_url_2x","imageUrl2x","image_url_4x","imageUrl4x","label","createBadge","Boolean","fetchRequest","timeout","restOptions","options","fetchTimeout","API_REQUESTS_TIMEOUT","controller","AbortController","signal","setTimeout","abort","response","fetch","ok","Error","statusText","json","apiRequestKraken","headers","Accept","process","Authorization","localStorage","getItem","LS_ACCESS_TOKEN","apiRequestHelix","fetchTwitchEmotes","fetchGlobalBadges","language","fetchChannelBadges","channelId","fetchBlockedUsers","fetchBttvGlobalEmotes","fetchBttvChannelEmotes","fetchFfzGlobalEmotes","fetchFfzChannelEmotes","fetchChatHistory","channel","findTwitchEmoteByIdInSets","sets","set","Object","values","result","htmlEntity","regexMap","4","9","findTwitchEmoteByNameInSets","RegExp","findEmote","twitch","byId","twitchGlobal","twitchUser","byName","byText","limit","items","emote","begins","length","contains","index","toLowerCase","indexOf","push","bttv","bttvGlobal","bttvChannel","findById","findByName","ffz","ffzGlobal","ffzChannel","authParams","client_id","TWITCH_API_CLIENT_ID","redirect_uri","TWITCH_API_REDIRECT_URI","response_type","scope","join","claims","JSON","stringify","id_token","email_verified","picture","preferred_username","getAuthUrl","search","entries","map","key","value","TWITCH_API_AUTH_BASE","isAuthRedirect","hash","startsWith","user","setItem","LS_USER","readUserFromLocatStorage","parse","optionsSelector","showTimestamps","splitChat","fixedWidth","isShowTimestampsSelector","isSplitChatSelector","isFixedWidthSelector","useInitializeAuth","useDispatch","useSelector","useEffect","idToken","params","jwtData","jwt","decode","sub","useFetchChatData","currentChannel","currentChannelSelector","currentChannelId","currentChannelIdSelector","isTwitchEmotesLoaded","isTwitchEmotesLoadedSelector","isBttvGlobalEmotesLoaded","isBttvGlobalEmotesLoadedSelector","isBttvChannelEmotesLoaded","isBttvChannelEmotesLoadedSelector","isFfzGlobalEmotesLoaded","isFfzGlobalEmotesLoadedSelector","isFfzChannelEmotesLoaded","isFfzChannelEmotesLoadedSelector","isGlobalBadgesLoaded","isGlobalBadgesLoadedSelector","isChannelBadgesLoaded","isChannelBadgesLoadedSelector","isHistoryLoaded","isHistoryLoadedSelector","isBlockedUsersLoaded","isBlockedUsersLoadedSelector","isHistoryAdded","isHistoryAddedSelector","isReadyToAddHistory","addChatHistory","useCurrentChannel","history","useHistory","location","slice","updateCurrentChannel","LS_LAST_CHANNEL","document","lastChannel","pathname","usePrevious","ref","useRef","current","replaceEmojis","split","word","emoji","emojilib","char","useTwitchClient","isConnected","isConnectedSelector","prevChannel","clientRef","registerEvents","useCallback","client","on","updateIsConnected","updateGlobalUserParams","updateUserParams","updateRoomParams","message","addMessage","disconnect","uuid","tags","targetUserId","clearChat","part","twitchIrc","connect","useMemo","say","trim","normalizedMessage","handleUserState","ownMessage","removeListeners","handleNotice","NOTICE_MESSAGE_TAGS","includes","msgId","off","useSetState","useState","patch","prevState","Function","getUsersByBeginText","beginText","beginTextLower","nameLower","suggestionsInitialState","isActive","activeIndex","start","end","setSuggestionsIndexUp","rest","setSuggestionsIndexDown","replaceSuggestionText","currentItem","insertedText","textBefore","substring","testAfter","useChatInput","setText","onSendMessage","chatInputRef","suggestions","setSuggestions","emotes","emotesSelector","usersSelector","usersRef","emotesRef","suggestionsRef","handleChange","selectionStart","spaceIndexBefore","lastIndexOf","spaceIndexAfter","usersMatch","SUGGESTION_TYPES","regex","exec","emotesMatch","getEmotesByText","handleKeyUp","handleKeyDown","preventDefault","t","handleSuggestionMouseEnter","handleSuggestionClick","focus","handleBlur","events","arePassiveEvents","arePassiveEventsSupported","getOptions","event","passive","undefined","isContainsNode","el","node","useOnClickOutside","handler","handlerRef","useLatest","listener","Array","isArray","some","r","forEach","addEventListener","removeEventListener","_extends","assign","i","arguments","source","prototype","hasOwnProperty","call","apply","this","_ref","createElement","fill","d","SvgClose","svgRef","props","viewBox","ForwardRef","forwardRef","sizes","small","css","medium","IconButton","styled","button","attrs","p","size","ChatModalRoot","div","CloseButton","CloseIcon","CloseIconSvg","ChatModal","children","onClose","onClick","fillRule","clipRule","SvgSmileyFace","Scrollbar","CustomScrollbar","disableTracksWidthCompensation","SvgSearch","EmotePickerRoot","Categories","Category","CategoryHeader","CategoryItems","Emote","img","SearchBlock","SearchInput","input","SearchIcon","SearchIconSvg","EmotePicker","onEmoteClick","setSearch","searchInputRef","emoteCategories","emoteCategoriesSelector","placeholder","onChange","ChatInputRoot","ChatInputInner","Suggestions","SuggestionItem","SuggestionImage","TextareaInput","TextareaWrapper","isSuggestions","EmotesModal","Textarea","showScroll","EmotesButton","SmileyFaceIcon","SmileyFaceIconSvg","ChatInput","React","isDisabled","onKeyUp","onKeyDown","onBlur","onSuggestionMouseEnter","onSuggestionClick","textareaRef","suggestionNodesRef","isShowTextareaScroll","setIsShowTextareaScroll","isEmotesModalVisible","setIsEmotesModalVisible","isEmotesLoaded","isEmotesLoadedSelector","handleCloseEmotesModal","renderUser","onMouseEnter","renderEmote","renderSuggestions","inputRef","maxLength","maxRows","disabled","onHeightChange","height","memo","SvgGears","_ref2","_ref3","SvgTwitch","Button","SwitchRoot","Label","Input","Switch","checked","readOnly","aria-label","htmlFor","defaultProps","OptionsRoot","Header","h2","Option","OptionText","span","Profile","UserName","color","LogOutButton","Link","Badge","Options","userDisplayName","userDisplayNameSelector","userColor","userColorSelector","userBadgesImages","userBadgesImagesSelector","renderOption","changeChatOption","renderOptionsCategory","to","ChatControlsRoot","Controls","OptionsModal","OptionsButton","GearsIcon","GearsIconSvg","TwitchIcon","TwitchIconSvg","isOptionsModalVisible","setIsOptionsModalVisible","optionsModalRef","optionsButtonRef","optionsNodesRef","handleCloseOptionsModal","as","prev","MessageRoot","isAction","isHistory","isDeleted","isMention","isEven","Name","Emoji","Mention","isOwnMessage","a","Timestamp","entities","displayName","timestamp","isShowTimestamps","onNameRightClick","isVisible","setIsVisible","format","Date","renderBadges","onContextMenu","item","data-emote-id","rel","renderMessageArray","NoticeRoot","Notice","UserNoticeRoot","UserNotice","systemMessage","assertNever","MessagesRoot","StyledScrollbar","MoreMessagesButton","Messages","isMoreMessagesButtonVisible","setIsMoreMessagesButtonVisible","messages","messagesSelector","isEvenSelector","isSplitChat","scrollbarRef","handleScrollToBottom","scrollToBottom","getIsEven","onUpdate","clientHeight","contentScrollHeight","scrollTop","JoinChannelRoot","Title","JoinButton","JoinChannel","setValue","handleChangeChannel","onKeyPress","ChatRoot","ChatWrapper","isFixedWidth","Chat","textRef","handleSendMessage","chatInput","handleNameRightClick","trimLeft","handleEmoteClick","Auth","window","Logout","removeItem","LS_ID_TOKEN","AuthCallback","URLSearchParams","accessToken","get","createGlobalStyle","colors","vars","common","getHomeComponent","App","exact","path","render","component","isLocalhost","hostname","match","registerValidSW","swUrl","config","navigator","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","console","log","onSuccess","catch","error","rootReducer","combineReducers","chat","store","configureStore","reducer","ReactGA","initialize","page","pageview","require","default","ReactDOM","getElementById","URL","origin","contentType","status","ready","unregister","reload","checkValidServiceWorker","mentionRegex","linkRegex","urlRegex","strict","normalizeEmbeddedEmotes","embeddedEmotes","reduce","Number","parseInt","acc","findEntity","parseTwitch","twitchEmote","emojiMatch","twemojiParser","assetType","mentionMatch","linkMatch","parseMessageEntities","offset","arrayOffset","spaceIndex","startIndex","endIndex","entity","keys","entityObject","difference","textAfter","normalizeHistoryMessages","rawMessages","chatState","fakeState","globalBadgesSelector","channelBadgesSelector","blockedUsers","blockedUsersSelector","rawMessage","tekko","command","prefix","parsedTags","tmiSentTs","normalizeHistoryMessage","sliceMessages","diff","CHANNEL_MESSAGES_LIMIT","addedItemsCount","isSliced","normalizePayload","normalizeMessage","noticeType","normalizeNotice","systemMsg","normalizeUserNotice","writeEmotesUsageStatistic","now","normalizeOwnMessage","messagesReducers","newItems","slicedMessages","prevIsEven","STORE_USERS_LIMIT","sliceUsers","rawHistory","prevItems","isAdded","createAsyncThunk","parseTwitchEmotes","parseFfzChannelEmotes","parseBlockedUsers","parseBadges","ffzEmotesExtraReducers","builder","addCase","pending","ffzEmotes","global","fulfilled","default_sets","defaultSets","parseFfzGlobalEmotes","rejected","meta","arg","byChannels","twitchEmotes","bttvEmotes","room","extraReducers","messagesExtraReducers","twitchEmotesExtraReducers","channelEmotes","sharedEmotes","bttvEmotesExtraReducers","badgesExtraReducers","blockedUsersExtraReducers","getIsAction","normalizeActionMessage","getChannelFromMessage","isNode","booleanMessageTags","numberMessageTags","tagNamesMap","depricatedMessageTags","normalizeTagValue","raw","indexes","followersOnly","slow","parseMessageTags","normalizeState","normalizeCommand","trailing","Commands","Client","socket","globalUserState","channels","_connected","_connecting","_registered","secure","connection","receiveRaw","rawData","sendRaw","ircMessage","middle","sendCommand","commandParams","_handleMessage","eventData","normalizeGlobalUserState","normalizeWhisper","normalizeChatMessage","_connectInNode","host","port","Promise","handleConnect","resolve","tls","reject","_connectInBrowser","WebSocket","wasClean","reason","_register","nick","Math","pass","handleRegister","_updateGlobalUserState","_updateUserState","userState","_updateRoomState","roomState","UserNoticeType","getTwitchUserEmoteCategories","getMainEmoteCategories","createSelector","filter","createEmoteCategories","mainEmoteCategories","frequentlyUsed","getEmotesFromUsageStatistic","twitchEmotesSelector","twitchGlobalEmotesSelector","twitchUserEmotesSelector","roomId","readOptionsFromLocalStorage","LS_OPTIONS","blacklistKeywords","highlightKeywords","changeOption","LS_EMOTES_USAGE_STATISTIC","textLower","readEmotesUsageStatistic","statistic","getUsageStatisticFromEntities","v","lastUpdatedAt","uses","mergeFn","left","right","newHistory","normalizeHistory","emoteEntity"],"mappings":"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","file":"static/js/main.635415f2.chunk.js","sourcesContent":["/* eslint-disable no-param-reassign */\nimport { createSlice, PayloadAction } from '@reduxjs/toolkit';\n\nimport * as api from 'api';\nimport { AppThunk } from 'app/store';\nimport { RootState } from 'app/rootReducer';\nimport { writeUserToLocatStorage } from 'features/auth/authUtils';\n\ntype AuthState = {\n  isAuthReady: boolean;\n  isAuth: boolean;\n  userId: string | null;\n  userLogin: string | null;\n};\n\ntype InitializeAuth = {\n  isAuth: boolean;\n  userId?: string;\n  userLogin?: string;\n};\n\nexport const initialState: AuthState = {\n  isAuthReady: false,\n  isAuth: false,\n  userId: null,\n  userLogin: null,\n};\n\nconst auth = createSlice({\n  name: 'auth',\n  initialState,\n  reducers: {\n    initializeAuth: (\n      state,\n      { payload }: PayloadAction<InitializeAuth>,\n    ): void => {\n      state.isAuthReady = true;\n      state.isAuth = payload.isAuth;\n\n      if (payload.userId) {\n        state.userId = payload.userId;\n      }\n\n      if (payload.userLogin) {\n        state.userLogin = payload.userLogin;\n      }\n    },\n\n    invalidateAuth: (): AuthState => initialState,\n\n    fetchUserRequest: (state): void => {\n      state.isAuthReady = false;\n      state.isAuth = false;\n    },\n\n    fetchUserSuccess: (\n      state,\n      { payload }: PayloadAction<api.TwitchUsersResponse>,\n    ): void => {\n      state.isAuthReady = true;\n      state.isAuth = true;\n\n      state.userId = payload.data[0].id;\n      state.userLogin = payload.data[0].login;\n    },\n\n    fetchUserFailure: (state, { payload }: PayloadAction<string>): void => {\n      state.isAuthReady = true;\n      state.isAuth = false;\n    },\n  },\n});\n\nexport const {\n  initializeAuth,\n  invalidateAuth,\n  fetchUserRequest,\n  fetchUserSuccess,\n  fetchUserFailure,\n} = auth.actions;\n\nexport default auth.reducer;\n\nexport const fetchUser = (userId: string): AppThunk => async (\n  dispatch,\n): Promise<void> => {\n  try {\n    dispatch(fetchUserRequest());\n    const users = await api.fetchUser(userId);\n    const { id, login } = users.data[0];\n    writeUserToLocatStorage({ id, login });\n    dispatch(fetchUserSuccess(users));\n  } catch (e) {\n    dispatch(fetchUserFailure(e));\n  }\n};\n\nexport const isAuthReadySelector = (state: RootState): boolean =>\n  state.auth.isAuthReady;\n\nexport const isAuthSelector = (state: RootState): boolean => state.auth.isAuth;\n\nexport const userLoginSelector = (state: RootState): string | null =>\n  state.auth.userLogin;\n\nexport const userIdSelector = (state: RootState): string | null =>\n  state.auth.userId;\n","// https://regex101.com/r/cpaNXh/1\nconst isStartsWithProtocolRegex = /^(?:(?:[a-z]+:)?\\/\\/)/;\n\nconst normalizeHref = (href: string) =>\n  isStartsWithProtocolRegex.test(href) ? href : `//${href}`;\n\nexport default normalizeHref;\n","import * as R from 'ramda';\r\nimport twitchIrc from 'twitch-simple-irc';\r\n\r\nimport * as api from 'api';\r\nimport normalizeHref from 'utils/normalizeHref';\r\n\r\nexport interface TwitchEmote {\r\n  type: 'twitch-emote';\r\n  id: number;\r\n  alt: string;\r\n  src: string;\r\n  srcSet: string;\r\n}\r\nexport interface BttvEmote {\r\n  type: 'bttv-emote';\r\n  id: string;\r\n  alt: string;\r\n  src: string;\r\n  srcSet: string;\r\n}\r\nexport interface FfzEmote {\r\n  type: 'ffz-emote';\r\n  id: number;\r\n  alt: string;\r\n  src: string;\r\n  srcSet: string;\r\n}\r\nexport interface Emoji {\r\n  type: 'emoji';\r\n  alt: string;\r\n  src: string;\r\n}\r\nexport interface Mention {\r\n  type: 'mention';\r\n  text: string;\r\n  target: string;\r\n}\r\nexport interface Link {\r\n  type: 'link';\r\n  text: string;\r\n  href: string;\r\n}\r\nexport interface Badge {\r\n  alt: string;\r\n  label: string;\r\n  src: string;\r\n  srcSet: string;\r\n}\r\n\r\nexport type Emote = TwitchEmote | BttvEmote | FfzEmote;\r\n\r\nconst TWITCH_EMOTES_CDN = '//static-cdn.jtvnw.net/emoticons/v1';\r\nconst BTTV_EMOTES_CDN = '//cdn.betterttv.net/emote';\r\n\r\n// prettier-ignore\r\nexport const regexEmotesMap: Record<string, string> = {\r\n  '[oO](_|\\\\.)[oO]': 'O_o',\r\n  '\\\\&gt\\\\;\\\\(':     '>(',\r\n  '\\\\&lt\\\\;3':       '<3',\r\n  '\\\\:-?(o|O)':      ':O',\r\n  '\\\\:-?(p|P)':      ':P',\r\n  '\\\\:-?[\\\\\\\\/]':    ':/',\r\n  '\\\\:-?[z|Z|\\\\|]':  ':Z',\r\n  '\\\\:-?\\\\(':        ':(',\r\n  '\\\\:-?\\\\)':        ':)',\r\n  '\\\\:-?D':          ':D',\r\n  '\\\\;-?(p|P)':      ';P',\r\n  '\\\\;-?\\\\)':        ';)',\r\n  'R-?\\\\)':          'R)',\r\n  'B-?\\\\)':          'B)',\r\n};\r\n\r\nexport const getFfzSrcSet = R.pipe<{}, [string, string][], string[], string>(\r\n  R.toPairs,\r\n  R.map(([dpi, url]) => `${url} ${dpi}x`),\r\n  R.join(', '),\r\n);\r\n\r\nexport const createTwitchEmote = ({\r\n  id,\r\n  code,\r\n}: api.TwitchEmote): TwitchEmote => ({\r\n  type: 'twitch-emote',\r\n  id,\r\n  alt: regexEmotesMap[code] || code,\r\n  src: `${TWITCH_EMOTES_CDN}/${id}/1.0`,\r\n  srcSet: `${TWITCH_EMOTES_CDN}/${id}/1.0 1x, ${TWITCH_EMOTES_CDN}/${id}/2.0 2x, ${TWITCH_EMOTES_CDN}/${id}/3.0 4x`,\r\n});\r\n\r\nexport const createBttvEmote = ({\r\n  id,\r\n  code,\r\n}: api.BttvGlobalEmote | api.BttvChannelEmote): BttvEmote => ({\r\n  type: 'bttv-emote',\r\n  id,\r\n  alt: code,\r\n  src: `${BTTV_EMOTES_CDN}/${id}/1x`,\r\n  srcSet: `${BTTV_EMOTES_CDN}/${id}/2x 2x, ${BTTV_EMOTES_CDN}/${id}/3x 4x`,\r\n});\r\n\r\nexport const createFfzEmote = ({ id, name, urls }: api.FfzEmote): FfzEmote => ({\r\n  type: 'ffz-emote',\r\n  id,\r\n  alt: name,\r\n  src: urls[1],\r\n  srcSet: getFfzSrcSet(urls),\r\n});\r\n\r\nexport const createEmoji = (alt: string, src: string): Emoji => ({\r\n  type: 'emoji',\r\n  alt: `:${alt}:`,\r\n  src,\r\n});\r\n\r\nexport const createMention = (text: string, target: string): Mention => ({\r\n  type: 'mention',\r\n  text,\r\n  target,\r\n});\r\n\r\nexport const createLink = (href: string): Link => ({\r\n  type: 'link',\r\n  text: href,\r\n  href: normalizeHref(href),\r\n});\r\n\r\nexport const createBadge = ({\r\n  title,\r\n  description,\r\n  image_url_1x: imageUrl1x,\r\n  image_url_2x: imageUrl2x,\r\n  image_url_4x: imageUrl4x,\r\n}: api.TwitchBadgeVersion): Badge => ({\r\n  alt: title,\r\n  label: description,\r\n  src: imageUrl1x,\r\n  srcSet: `${imageUrl1x} 1x, ${imageUrl2x} 2x, ${imageUrl4x} 4x`,\r\n});\r\n\r\nexport const createBadges = (\r\n  badges: twitchIrc.Badges,\r\n  globalBadges: Record<string, api.TwitchBadge>,\r\n  channelBadges: Record<string, api.TwitchBadge>,\r\n): Badge[] => {\r\n  const mapBadges = ([name, version]: [string, string]): Badge | false => {\r\n    const badge =\r\n      channelBadges[name]?.versions[version] ||\r\n      globalBadges[name]?.versions[version];\r\n\r\n    return badge ? createBadge(badge) : false;\r\n  };\r\n\r\n  return R.pipe<{}, [string, string][], any[], any[]>(\r\n    R.toPairs,\r\n    R.map(mapBadges),\r\n    R.filter(Boolean),\r\n  )(badges);\r\n};\r\n","import { API_REQUESTS_TIMEOUT } from 'utils/constants';\n\nexport interface FetchRequestOptions extends RequestInit {\n  timeout?: number;\n}\n\nconst fetchRequest = async (\n  url: string,\n  { timeout, ...restOptions }: FetchRequestOptions = {},\n) => {\n  let options = { ...restOptions };\n  const fetchTimeout = timeout || API_REQUESTS_TIMEOUT;\n\n  if (fetchTimeout) {\n    const controller = new AbortController();\n\n    options = { ...options, signal: controller.signal };\n\n    setTimeout(() => controller.abort(), fetchTimeout);\n  }\n\n  const response = await fetch(url, options);\n\n  if (!response.ok) {\n    throw Error(response.statusText);\n  }\n\n  const body = await response.json();\n\n  return body;\n};\n\nexport default fetchRequest;\n","import { LS_ACCESS_TOKEN } from 'utils/constants';\r\nimport fetchRequest, { FetchRequestOptions } from 'utils/fetchRequest';\r\n\r\nconst TWITCH_API_HELIX = 'https://api.twitch.tv/helix';\r\nconst TWITCH_API_KRAKEN = 'https://api.twitch.tv/kraken';\r\n\r\nconst getHelixHeaders = () => ({\r\n  Authorization: `Bearer ${localStorage.getItem(LS_ACCESS_TOKEN)}`,\r\n});\r\n\r\nconst getKrakenHeaders = () => ({\r\n  Accept: 'application/vnd.twitchtv.v5+json',\r\n  'Client-ID': process.env.REACT_APP_TWITCH_API_CLIENT_ID,\r\n  Authorization: `OAuth ${localStorage.getItem(LS_ACCESS_TOKEN)}`,\r\n});\r\n\r\nconst apiRequestHelix = (url: string, options?: FetchRequestOptions) =>\r\n  fetchRequest(`${TWITCH_API_HELIX}${url}`, {\r\n    ...options,\r\n    headers: getHelixHeaders(),\r\n  } as FetchRequestOptions);\r\n\r\nconst apiRequestKraken = (url: string, options?: FetchRequestOptions) =>\r\n  fetchRequest(`${TWITCH_API_KRAKEN}${url}`, {\r\n    ...options,\r\n    headers: getKrakenHeaders(),\r\n  } as FetchRequestOptions);\r\n\r\nexport interface TwitchUser {\r\n  id: string;\r\n  login: string;\r\n  display_name: string;\r\n  type: string;\r\n  broadcaster_type: string;\r\n  description: string;\r\n  profile_image_url: string;\r\n  offline_image_url: string;\r\n  view_count: number;\r\n}\r\n\r\nexport interface TwitchUsersResponse {\r\n  data: TwitchUser[];\r\n}\r\n\r\nexport interface TwitchEmote {\r\n  id: number;\r\n  code: string;\r\n}\r\n\r\nexport interface TwitchEmotesResponse {\r\n  emoticon_sets: Record<string, TwitchEmote[]>;\r\n}\r\n\r\nexport interface TwitchBadgeVersion {\r\n  image_url_1x: string;\r\n  image_url_2x: string;\r\n  image_url_4x: string;\r\n  description: string;\r\n  title: string;\r\n  click_action: string;\r\n  click_url: string;\r\n  last_updated: null;\r\n}\r\n\r\nexport interface TwitchBadge {\r\n  versions: Record<string, TwitchBadgeVersion>;\r\n}\r\n\r\nexport interface TwitchBadgesResponse {\r\n  badge_sets: Record<string, TwitchBadge>;\r\n}\r\n\r\nexport interface TwitchBlockedUser {\r\n  display_name: string;\r\n  _id: string;\r\n  name: string;\r\n  type: string;\r\n  bio: string | null;\r\n  created_at: string;\r\n  updated_at: string;\r\n  logo: string;\r\n}\r\n\r\nexport interface TwitchBlockedUsersResponse {\r\n  _total: number;\r\n  blocks: {\r\n    user: TwitchBlockedUser;\r\n  }[];\r\n}\r\n\r\nexport const fetchUser = (userId: string): Promise<TwitchUsersResponse> =>\r\n  apiRequestHelix(`/users?id=${userId}`);\r\n\r\nexport const fetchTwitchEmotes = (\r\n  userId: string,\r\n): Promise<TwitchEmotesResponse> => apiRequestKraken(`/users/${userId}/emotes`);\r\n\r\nexport const fetchGlobalBadges = (\r\n  language = 'en',\r\n): Promise<TwitchBadgesResponse> =>\r\n  fetchRequest(\r\n    `https://badges.twitch.tv/v1/badges/global/display?language=${language}`,\r\n  );\r\n\r\nexport const fetchChannelBadges = (\r\n  channelId: string,\r\n  language = 'en',\r\n): Promise<TwitchBadgesResponse> =>\r\n  fetchRequest(\r\n    `https://badges.twitch.tv/v1/badges/channels/${channelId}/display?language=${language}`,\r\n  );\r\n\r\nexport const fetchBlockedUsers = (\r\n  userId: string,\r\n): Promise<TwitchBlockedUsersResponse> =>\r\n  apiRequestKraken(`/users/${userId}/blocks`);\r\n","import fetchRequest from 'utils/fetchRequest';\r\n\r\nexport interface BttvEmote {\r\n  id: string;\r\n  code: string;\r\n  imageType: 'png' | 'gif';\r\n}\r\n\r\nexport interface BttvGlobalEmote extends BttvEmote {\r\n  userId: string;\r\n}\r\n\r\nexport interface BttvChannelEmote extends BttvEmote {\r\n  user: {\r\n    id: string;\r\n    name: string;\r\n    displayName: string;\r\n    providerId: string;\r\n  };\r\n}\r\n\r\nexport type BttvGlobalEmotesResponse = BttvGlobalEmote[];\r\n\r\nexport interface BttvChannelEmotesResponse {\r\n  id: string;\r\n  bots: string[];\r\n  channelEmotes: BttvChannelEmote[];\r\n  sharedEmotes: BttvChannelEmote[];\r\n}\r\n\r\nexport const fetchBttvGlobalEmotes = (): Promise<BttvGlobalEmotesResponse> =>\r\n  fetchRequest('https://api.betterttv.net/3/cached/emotes/global');\r\n\r\nexport const fetchBttvChannelEmotes = (\r\n  channelId: string,\r\n): Promise<BttvChannelEmotesResponse> =>\r\n  fetchRequest(`https://api.betterttv.net/3/cached/users/twitch/${channelId}`);\r\n","import fetchRequest from 'utils/fetchRequest';\r\n\r\nexport interface FfzEmote {\r\n  css: null;\r\n  height: number;\r\n  hidden: boolean;\r\n  id: number;\r\n  margins: null;\r\n  modifier: boolean;\r\n  name: string;\r\n  offset: null;\r\n  owner: {\r\n    _id: number;\r\n    display_name: string;\r\n    name: string;\r\n  };\r\n  public: boolean;\r\n  urls: {\r\n    '1': string;\r\n    '2'?: string;\r\n    '4'?: string;\r\n  };\r\n  width: number;\r\n}\r\n\r\ninterface FfzEmoteSet {\r\n  _type: number;\r\n  css: null;\r\n  description: null;\r\n  emoticons: FfzEmote[];\r\n  icon: null;\r\n  id: number;\r\n  title: string;\r\n}\r\n\r\nexport interface FfzGlobalEmotesResponse {\r\n  default_sets: number[];\r\n  sets: Record<string, FfzEmoteSet>;\r\n  users: Record<string, string[]>;\r\n}\r\n\r\nexport interface FfzChannelEmotesResponse {\r\n  room: {\r\n    _id: number;\r\n    css: null;\r\n    display_name: string;\r\n    id: string;\r\n    is_group: boolean;\r\n    mod_urls: null;\r\n    moderator_badge: null;\r\n    set: number;\r\n    twitch_id: number;\r\n    user_badges: {};\r\n  };\r\n  sets: Record<string, FfzEmoteSet>;\r\n}\r\n\r\nexport const fetchFfzGlobalEmotes = (): Promise<FfzGlobalEmotesResponse> =>\r\n  fetchRequest('https://api.frankerfacez.com/v1/set/global');\r\n\r\nexport const fetchFfzChannelEmotes = (\r\n  channelId: string,\r\n): Promise<FfzChannelEmotesResponse> =>\r\n  fetchRequest(`https://api.frankerfacez.com/v1/room/id/${channelId}`);\r\n","import fetchRequest from 'utils/fetchRequest';\r\n\r\nexport interface ChatHistoryResponse {\r\n  messages: string[];\r\n  error: null;\r\n}\r\n\r\n// eslint-disable-next-line import/prefer-default-export\r\nexport const fetchChatHistory = (\r\n  channel: string,\r\n): Promise<ChatHistoryResponse> =>\r\n  fetchRequest(\r\n    `https://recent-messages.robotty.de/api/v2/recent-messages/${channel}?clearchatToNotice=true`,\r\n  );\r\n","import * as R from 'ramda';\n\nimport * as api from 'api';\nimport * as htmlEntity from 'features/chat/utils/htmlEntity';\nimport { StateEmotes } from 'features/chat/selectors/chatSelectors';\nimport { EmotesByText } from 'features/chat/utils/getEmotesByText';\n\n// by id\n\nconst findTwitchEmoteByIdInSets = (\n  id: number,\n  sets: Record<string, api.TwitchEmote[]>,\n) => {\n  // eslint-disable-next-line no-restricted-syntax\n  for (const set of Object.values(sets)) {\n    const result = R.find(R.propEq('id', id), set);\n\n    if (result) return htmlEntity.createTwitchEmote(result);\n  }\n\n  return null;\n};\n\nconst findTwitchEmoteById = (\n  id: number,\n  { twitchGlobal, twitchUser }: NonNullable<StateEmotes>,\n) =>\n  findTwitchEmoteByIdInSets(id, twitchGlobal) ||\n  findTwitchEmoteByIdInSets(id, twitchUser);\n\nconst findBttvEmoteById = (\n  id: string,\n  { bttvGlobal, bttvChannel }: NonNullable<StateEmotes>,\n) => {\n  const findById = R.find<api.BttvGlobalEmote | api.BttvChannelEmote>(\n    R.propEq('id', id),\n  );\n  const result = findById(bttvGlobal) || findById(bttvChannel);\n\n  return result ? htmlEntity.createBttvEmote(result) : null;\n};\n\nconst findFfzEmoteById = (\n  id: number,\n  { ffzGlobal, ffzChannel }: NonNullable<StateEmotes>,\n) => {\n  const findById = R.find<api.FfzEmote>(R.propEq('id', id));\n  const result = findById(ffzGlobal) || findById(ffzChannel);\n\n  return result ? htmlEntity.createFfzEmote(result) : null;\n};\n\n// by name\n\nconst regexMap: Record<number, string> = {\n  4: '>\\\\(', // '\\\\&gt\\\\;\\\\('\n  9: '<3', // '\\\\&lt\\\\;3'\n};\n\nconst findTwitchEmoteByNameInSets = (\n  name: string,\n  sets: Record<string, api.TwitchEmote[]>,\n) => {\n  // eslint-disable-next-line no-restricted-syntax\n  for (const set of Object.values(sets)) {\n    const result = R.find(({ id, code }) => {\n      // 1-14 - match by regex\n      if (id >= 1 && id <= 14) {\n        const regexString = regexMap[id] || code;\n        return RegExp(`^${regexString}$`).test(name);\n      }\n\n      return name === code;\n    }, set);\n\n    if (result) return htmlEntity.createTwitchEmote(result);\n  }\n\n  return null;\n};\n\nconst findTwitchEmoteByName = (\n  name: string,\n  { twitchGlobal, twitchUser }: NonNullable<StateEmotes>,\n) =>\n  findTwitchEmoteByNameInSets(name, twitchGlobal) ||\n  findTwitchEmoteByNameInSets(name, twitchUser);\n\nconst findBttvEmoteByName = (\n  name: string,\n  { bttvGlobal, bttvChannel }: NonNullable<StateEmotes>,\n) => {\n  const findByName = R.find<api.BttvGlobalEmote | api.BttvChannelEmote>(\n    R.propEq('code', name),\n  );\n  const result = findByName(bttvGlobal) || findByName(bttvChannel);\n\n  return result ? htmlEntity.createBttvEmote(result) : null;\n};\n\nconst findFfzEmoteByName = (\n  name: string,\n  { ffzGlobal, ffzChannel }: NonNullable<StateEmotes>,\n) => {\n  const findByName = R.find<api.FfzEmote>(R.propEq('name', name));\n  const result = findByName(ffzGlobal) || findByName(ffzChannel);\n\n  return result ? htmlEntity.createFfzEmote(result) : null;\n};\n\n// by text\n\n/* eslint-disable no-restricted-syntax */\nconst findTwitchEmotesByText = (\n  result: EmotesByText,\n  sets: Record<string, api.TwitchEmote[]>,\n  text: string,\n  limit: number,\n): boolean => {\n  for (const items of Object.values(sets)) {\n    for (const emote of items) {\n      if (result.begins.length + result.contains.length === limit) return true;\n\n      const index = emote.code.toLowerCase().indexOf(text);\n\n      if (index !== -1) {\n        const type = index === 0 ? 'begins' : 'contains';\n\n        result[type].push(htmlEntity.createTwitchEmote(emote));\n      }\n    }\n  }\n\n  return false;\n};\n\nconst findBttvEmotesByText = (\n  result: EmotesByText,\n  bttv: api.BttvGlobalEmote[] | api.BttvChannelEmote[],\n  text: string,\n  limit: number,\n): boolean => {\n  for (const emote of bttv) {\n    if (result.begins.length + result.contains.length === limit) return true;\n\n    const index = emote.code.toLowerCase().indexOf(text);\n\n    if (index !== -1) {\n      const type = index === 0 ? 'begins' : 'contains';\n\n      result[type].push(htmlEntity.createBttvEmote(emote));\n    }\n  }\n\n  return false;\n};\n\nconst findFfzEmotesByText = (\n  result: EmotesByText,\n  ffz: api.FfzEmote[],\n  text: string,\n  limit: number,\n): boolean => {\n  for (const emote of ffz) {\n    if (result.begins.length + result.contains.length === limit) return true;\n\n    const index = emote.name.toLowerCase().indexOf(text);\n\n    if (index !== -1) {\n      const type = index === 0 ? 'begins' : 'contains';\n\n      result[type].push(htmlEntity.createFfzEmote(emote));\n    }\n  }\n\n  return false;\n};\n/* eslint-enable no-restricted-syntax */\n\nconst findEmote = {\n  twitch: {\n    byId: findTwitchEmoteById,\n    byName: findTwitchEmoteByName,\n    byText: findTwitchEmotesByText,\n  },\n  bttv: {\n    byId: findBttvEmoteById,\n    byName: findBttvEmoteByName,\n    byText: findBttvEmotesByText,\n  },\n  ffz: {\n    byId: findFfzEmoteById,\n    byName: findFfzEmoteByName,\n    byText: findFfzEmotesByText,\n  },\n};\n\nexport default findEmote;\n","import {\n  TWITCH_API_AUTH_BASE,\n  TWITCH_API_CLIENT_ID,\n  TWITCH_API_REDIRECT_URI,\n  LS_USER,\n} from 'utils/constants';\n\ntype StoredUser = {\n  id: string;\n  login: string;\n};\n\n/* eslint-disable @typescript-eslint/camelcase */\nconst authParams = {\n  client_id: TWITCH_API_CLIENT_ID,\n  redirect_uri: TWITCH_API_REDIRECT_URI,\n  response_type: 'token+id_token',\n  scope: [\n    'openid',\n    'channel:moderate',\n    'chat:edit',\n    'chat:read',\n    'whispers:read',\n    'whispers:edit',\n    'user_blocks_read',\n    'user_blocks_edit',\n    'user_subscriptions',\n  ].join('+'),\n  claims: JSON.stringify({\n    id_token: { email_verified: null, picture: null, preferred_username: null },\n  }),\n  // TODO:\n  // state: uid(),\n};\n/* eslint-enable @typescript-eslint/camelcase */\n\nexport const getAuthUrl = (): string => {\n  const search = Object.entries(authParams)\n    .map(([key, value]) => `${key}=${value}`)\n    .join('&');\n\n  return `${TWITCH_API_AUTH_BASE}?${search}`;\n};\n\nexport const isAuthRedirect = (hash: string): boolean =>\n  hash.startsWith('#access_token=');\n\nexport const writeUserToLocatStorage = (user: StoredUser): void => {\n  localStorage.setItem(LS_USER, JSON.stringify(user));\n};\n\nexport const readUserFromLocatStorage = (): StoredUser | null => {\n  let user;\n\n  try {\n    user = JSON.parse(localStorage.getItem(LS_USER) as string);\n  } catch (e) {\n    user = null;\n  }\n\n  if (!user || !user.id || !user.login) return null;\n\n  return user as StoredUser;\n};\n","import { RootState } from 'app/rootReducer';\n\ntype OptionItem = {\n  type: 'switch' | 'input';\n  id: string;\n  name: string;\n  title: string;\n  description: string;\n  value: boolean | string;\n};\n\ntype OptionCategories = {\n  title: string;\n  items: OptionItem[];\n};\n\nexport const optionsSelector = (state: RootState): OptionCategories[] => [\n  {\n    title: 'My preferences',\n    items: [\n      {\n        type: 'switch',\n        id: 'show-timestamps',\n        name: 'showTimestamps',\n        title: 'Show Timestamps',\n        description: '',\n        value: state.options.showTimestamps,\n      },\n      {\n        type: 'switch',\n        id: 'split-chat',\n        name: 'splitChat',\n        title: 'Split Chat',\n        description: '',\n        value: state.options.splitChat,\n      },\n      {\n        type: 'switch',\n        id: 'fixed-width',\n        name: 'fixedWidth',\n        title: 'Fixed Width',\n        description: '',\n        value: state.options.fixedWidth,\n      },\n      // {\n      //   type: 'input',\n      //   id: 'blacklist-keywords',\n      //   name: 'blacklistKeywords',\n      //   title: 'Set Blacklist Keywords',\n      //   description: '',\n      //   value: state.options.blacklistKeywords,\n      // },\n      // {\n      //   type: 'input',\n      //   id: 'highlight-keywords',\n      //   name: 'highlightKeywords',\n      //   title: 'Set Highlight Keywords',\n      //   description: '',\n      //   value: state.options.highlightKeywords,\n      // },\n    ],\n  },\n];\n\nexport const isShowTimestampsSelector = (state: RootState) =>\n  state.options.showTimestamps;\n\nexport const isSplitChatSelector = (state: RootState) =>\n  state.options.splitChat;\n\nexport const isFixedWidthSelector = (state: RootState) =>\n  state.options.fixedWidth;\n","import { useEffect } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport jwt from 'jsonwebtoken';\n\nimport {\n  isAuthReadySelector,\n  initializeAuth,\n  fetchUser,\n} from 'features/auth/authSlice';\nimport { readUserFromLocatStorage } from 'features/auth/authUtils';\n\nconst useInitializeAuth = () => {\n  const dispatch = useDispatch();\n  const isAuthReady = useSelector(isAuthReadySelector);\n\n  useEffect(() => {\n    if (isAuthReady) return;\n\n    const { idToken } = localStorage;\n    const user = readUserFromLocatStorage();\n\n    if (!idToken) {\n      dispatch(initializeAuth({ isAuth: false }));\n      return;\n    }\n\n    if (user) {\n      const { id, login } = user;\n      const params = { isAuth: true, userId: id, userLogin: login };\n\n      dispatch(initializeAuth(params));\n    } else {\n      const jwtData = jwt.decode(idToken);\n\n      if (jwtData) {\n        dispatch(fetchUser(jwtData.sub));\n      } else {\n        dispatch(initializeAuth({ isAuth: false }));\n      }\n    }\n  }, [dispatch, isAuthReady]);\n};\n\nexport default useInitializeAuth;\n","import { useEffect } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\n\nimport {\n  isAuthReadySelector,\n  isAuthSelector,\n  userIdSelector,\n} from 'features/auth/authSlice';\nimport {\n  currentChannelSelector,\n  currentChannelIdSelector,\n  isHistoryAddedSelector,\n  isHistoryLoadedSelector,\n  isTwitchEmotesLoadedSelector,\n  isBttvGlobalEmotesLoadedSelector,\n  isBttvChannelEmotesLoadedSelector,\n  isFfzGlobalEmotesLoadedSelector,\n  isFfzChannelEmotesLoadedSelector,\n  isGlobalBadgesLoadedSelector,\n  isChannelBadgesLoadedSelector,\n  isBlockedUsersLoadedSelector,\n} from 'features/chat/selectors';\nimport {\n  addChatHistory,\n  fetchChatHistory,\n  fetchTwitchEmotes,\n  fetchBttvGlobalEmotes,\n  fetchBttvChannelEmotes,\n  fetchFfzGlobalEmotes,\n  fetchFfzChannelEmotes,\n  fetchChannelBadges,\n  fetchGlobalBadges,\n  fetchBlockedUsers,\n} from 'features/chat/slice';\n\nconst useFetchChatData = () => {\n  const dispatch = useDispatch();\n\n  const isAuthReady = useSelector(isAuthReadySelector);\n  const isAuth = useSelector(isAuthSelector);\n  const userId = useSelector(userIdSelector);\n  const currentChannel = useSelector(currentChannelSelector);\n  const currentChannelId = useSelector(currentChannelIdSelector);\n\n  const isTwitchEmotesLoaded = useSelector(isTwitchEmotesLoadedSelector);\n  const isBttvGlobalEmotesLoaded = useSelector(\n    isBttvGlobalEmotesLoadedSelector,\n  );\n  const isBttvChannelEmotesLoaded = useSelector(\n    isBttvChannelEmotesLoadedSelector,\n  );\n  const isFfzGlobalEmotesLoaded = useSelector(isFfzGlobalEmotesLoadedSelector);\n  const isFfzChannelEmotesLoaded = useSelector(\n    isFfzChannelEmotesLoadedSelector,\n  );\n  const isGlobalBadgesLoaded = useSelector(isGlobalBadgesLoadedSelector);\n  const isChannelBadgesLoaded = useSelector(isChannelBadgesLoadedSelector);\n  const isHistoryLoaded = useSelector(isHistoryLoadedSelector);\n  const isBlockedUsersLoaded = useSelector(isBlockedUsersLoadedSelector);\n  const isHistoryAdded = useSelector(isHistoryAddedSelector);\n\n  const isReadyToAddHistory =\n    isAuthReady &&\n    currentChannel &&\n    !isHistoryAdded &&\n    (isAuth ? isTwitchEmotesLoaded : true) &&\n    (isAuth ? isBlockedUsersLoaded : true) &&\n    isBttvGlobalEmotesLoaded &&\n    isBttvChannelEmotesLoaded &&\n    isFfzGlobalEmotesLoaded &&\n    isFfzChannelEmotesLoaded &&\n    isGlobalBadgesLoaded &&\n    isChannelBadgesLoaded &&\n    isHistoryLoaded;\n\n  useEffect(() => {\n    dispatch(fetchBttvGlobalEmotes());\n    dispatch(fetchFfzGlobalEmotes());\n    dispatch(fetchGlobalBadges());\n  }, [dispatch]);\n\n  useEffect(() => {\n    if (isReadyToAddHistory) {\n      dispatch(addChatHistory(currentChannel));\n    }\n  }, [dispatch, currentChannel, isReadyToAddHistory]);\n\n  useEffect(() => {\n    if (!isHistoryAdded && currentChannel) {\n      dispatch(fetchChatHistory(currentChannel));\n    }\n  }, [dispatch, currentChannel, isHistoryAdded]);\n\n  useEffect(() => {\n    if (isAuthReady && isAuth && userId) {\n      dispatch(fetchTwitchEmotes(userId));\n      dispatch(fetchBlockedUsers(userId));\n    }\n  }, [dispatch, isAuthReady, isAuth, userId]);\n\n  // TODO: check if emotes and badges is already in the store\n\n  useEffect(() => {\n    if (currentChannel && currentChannelId) {\n      const params = {\n        channel: currentChannel,\n        channelId: currentChannelId,\n      };\n\n      dispatch(fetchBttvChannelEmotes(params));\n      dispatch(fetchFfzChannelEmotes(params));\n      dispatch(fetchChannelBadges(params));\n    }\n  }, [dispatch, currentChannel, currentChannelId]);\n};\n\nexport default useFetchChatData;\n","import { useEffect } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { useHistory } from 'react-router-dom';\n\nimport { LS_LAST_CHANNEL } from 'utils/constants';\nimport { updateCurrentChannel } from 'features/chat/slice';\n\n// TODO: remove lastChannel if can't connect to the channel\n\nconst useCurrentChannel = () => {\n  const history = useHistory();\n  const dispatch = useDispatch();\n  const { hash } = history.location;\n\n  useEffect(() => {\n    if (hash && hash.length > 1) {\n      const channel = hash.slice(1);\n\n      dispatch(updateCurrentChannel(channel));\n\n      localStorage.setItem(LS_LAST_CHANNEL, channel);\n\n      document.title = channel\n        ? `#${channel} - ${process.env.REACT_APP_NAME} `\n        : (process.env.REACT_APP_NAME as string);\n\n      return;\n    }\n\n    const lastChannel = localStorage.getItem(LS_LAST_CHANNEL);\n\n    if (lastChannel) {\n      history.push({ pathname: '/chat/', hash: lastChannel });\n\n      dispatch(updateCurrentChannel(lastChannel));\n    } else {\n      dispatch(updateCurrentChannel(''));\n    }\n  }, [dispatch, history, hash]);\n};\n\nexport default useCurrentChannel;\n","import { useEffect, useRef } from 'react';\n\nconst usePrevious = <T>(state: T): T | undefined => {\n  const ref = useRef<T>();\n\n  useEffect(() => {\n    ref.current = state;\n  });\n\n  return ref.current;\n};\n\nexport default usePrevious;\n","import { lib as emojilib } from 'emojilib';\n\nconst replaceEmojis = (text: string): string =>\n  text\n    .split(' ')\n    .map((word: string) => {\n      if (word[0] !== ':' || word[word.length - 1] !== ':') {\n        return word;\n      }\n\n      const name = word.slice(1, -1);\n      const emoji = emojilib[name];\n\n      return emoji && emoji.char ? emoji.char : word;\n    })\n    .join(' ');\n\nexport default replaceEmojis;\n","import { useEffect, useRef, useMemo, useCallback } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { v4 as uuid } from 'uuid';\nimport * as twitchIrc from 'twitch-simple-irc';\n\nimport usePrevious from 'hooks/usePrevious';\nimport { NOTICE_MESSAGE_TAGS, LS_ACCESS_TOKEN } from 'utils/constants';\nimport {\n  addMessage,\n  clearChat,\n  updateIsConnected,\n  updateGlobalUserParams,\n  updateUserParams,\n  updateRoomParams,\n} from 'features/chat/slice';\nimport {\n  currentChannelSelector,\n  isConnectedSelector,\n} from 'features/chat/selectors';\nimport replaceEmojis from 'features/chat/utils/replaceEmojis';\nimport {\n  isAuthSelector,\n  isAuthReadySelector,\n  userLoginSelector,\n  invalidateAuth,\n} from 'features/auth/authSlice';\nimport { readUserFromLocatStorage } from 'features/auth/authUtils';\n\nconst useTwitchClient = () => {\n  const dispatch = useDispatch();\n\n  const isAuthReady = useSelector(isAuthReadySelector);\n  const isAuth = useSelector(isAuthSelector);\n  const userLogin = useSelector(userLoginSelector);\n  const isConnected = useSelector(isConnectedSelector);\n  const currentChannel = useSelector(currentChannelSelector);\n  const prevChannel = usePrevious(currentChannel);\n  const clientRef = useRef<twitchIrc.Client | null>(null);\n\n  const registerEvents = useCallback(\n    (client: typeof clientRef) => {\n      if (!client.current) return;\n\n      const handleRegister = () => dispatch(updateIsConnected(true));\n\n      const handleDisconnect = () => dispatch(updateIsConnected(false));\n\n      const handleGlobalUserState = (data: twitchIrc.GlobalUserStateEvent) =>\n        dispatch(updateGlobalUserParams(data));\n\n      const handleUserState = (data: twitchIrc.UserStateEvent) =>\n        dispatch(updateUserParams(data));\n\n      const handleRoomState = (data: twitchIrc.RoomStateEvent) =>\n        dispatch(updateRoomParams(data));\n\n      const handleMessage = (message: twitchIrc.MessageEvent) =>\n        dispatch(addMessage({ type: 'message', message }));\n\n      const handleNotice = (message: twitchIrc.NoticeEvent) => {\n        if (\n          client.current &&\n          message.message === 'Login authentication failed'\n        ) {\n          dispatch(invalidateAuth());\n          client.current.disconnect();\n          // eslint-disable-next-line no-param-reassign\n          client.current = null;\n          return;\n        }\n\n        dispatch(addMessage({ type: 'notice', message, id: uuid() }));\n      };\n\n      const handleUserNotice = (message: twitchIrc.UserNoticeEvent) =>\n        dispatch(addMessage({ type: 'user-notice', message }));\n\n      const handleClearChat = (data: twitchIrc.ClearChatEvent) => {\n        if (!data.tags.targetUserId) return;\n        dispatch(clearChat(data));\n      };\n\n      client.current.on('register', handleRegister);\n      client.current.on('disconnect', handleDisconnect);\n      client.current.on('globaluserstate', handleGlobalUserState);\n      client.current.on('userstate', handleUserState);\n      client.current.on('roomstate', handleRoomState);\n      client.current.on('message', handleMessage);\n      client.current.on('notice', handleNotice);\n      client.current.on('usernotice', handleUserNotice);\n      client.current.on('clearchat', handleClearChat);\n    },\n    [dispatch],\n  );\n\n  useEffect(() => {\n    return () => {\n      if (clientRef.current) {\n        clientRef.current.disconnect();\n        clientRef.current = null;\n      }\n    };\n  }, [clientRef]);\n\n  useEffect(() => {\n    if (!currentChannel || !isAuthReady) return;\n\n    if (!clientRef.current) {\n      const options = isAuth\n        ? {\n            name: userLogin as string,\n            auth: localStorage.getItem(LS_ACCESS_TOKEN) as string,\n          }\n        : null;\n\n      (async () => {\n        clientRef.current = new twitchIrc.Client(options);\n\n        registerEvents(clientRef);\n\n        await clientRef.current.connect();\n\n        clientRef.current.join(currentChannel);\n      })();\n\n      return;\n    }\n\n    if (prevChannel && prevChannel !== currentChannel) {\n      clientRef.current.part(prevChannel);\n      clientRef.current.join(currentChannel);\n    }\n  }, [\n    dispatch,\n    registerEvents,\n    isAuth,\n    isAuthReady,\n    isConnected,\n    userLogin,\n    currentChannel,\n    prevChannel,\n  ]);\n\n  const client = () => ({\n    say(channel: string, message: string) {\n      if (!clientRef.current || !message.trim()) return;\n\n      const normalizedMessage = replaceEmojis(message.trim());\n\n      clientRef.current.say(channel, normalizedMessage);\n\n      function handleUserState(data: twitchIrc.UserStateEvent) {\n        if (data.channel === channel) {\n          const user = readUserFromLocatStorage();\n\n          const ownMessage = {\n            message: normalizedMessage,\n            channel,\n            tags: data.tags,\n            userId: user?.id,\n            userLogin: user?.login,\n          };\n\n          dispatch(addMessage({ type: 'own-message', message: ownMessage }));\n\n          // eslint-disable-next-line @typescript-eslint/no-use-before-define\n          removeListeners();\n        }\n      }\n\n      function handleNotice(data: twitchIrc.NoticeEvent) {\n        if (\n          data.channel === channel &&\n          NOTICE_MESSAGE_TAGS.includes(data.tags.msgId)\n        ) {\n          // eslint-disable-next-line @typescript-eslint/no-use-before-define\n          removeListeners();\n        }\n      }\n\n      function removeListeners() {\n        if (!clientRef.current) return;\n\n        clientRef.current.off('notice', handleNotice);\n        clientRef.current.off('userstate', handleUserState);\n      }\n\n      clientRef.current.on('notice', handleNotice);\n      clientRef.current.on('userstate', handleUserState);\n\n      setTimeout(() => removeListeners(), 10000);\n    },\n  });\n\n  return useMemo(client, [clientRef, dispatch]);\n};\n\nexport default useTwitchClient;\n","import { useCallback, useState } from 'react';\n\nconst useSetState = <T extends object>(\n  initialState: T = {} as T,\n): [T, (patch: Partial<T> | ((prevState: T) => Partial<T>)) => void] => {\n  const [state, set] = useState<T>(initialState);\n  const setState = useCallback(\n    (patch) => {\n      set((prevState) => ({\n        ...prevState,\n        ...(patch instanceof Function ? patch(prevState) : patch),\n      }));\n    },\n    [set],\n  );\n\n  return [state, setState];\n};\n\nexport default useSetState;\n","const getUsersByBeginText = (\n  beginText: string,\n  users: string[],\n  limit = 5,\n): string[] => {\n  const result = [];\n  const beginTextLower = beginText.toLowerCase();\n\n  // eslint-disable-next-line no-restricted-syntax\n  for (const name of users) {\n    if (result.length === limit) return result;\n\n    const nameLower = name.toLowerCase();\n\n    if (beginTextLower === '' || nameLower.startsWith(beginTextLower)) {\n      result.push(name);\n    }\n  }\n\n  return result;\n};\n\nexport default getUsersByBeginText;\n","import { useRef, useCallback } from 'react';\nimport { useSelector } from 'react-redux';\n\nimport useSetState from 'hooks/useSetState';\nimport { SUGGESTION_TYPES } from 'utils/constants';\nimport getUsersByBeginText from 'features/chat/utils/getUsersByBeginText';\nimport getEmotesByText from 'features/chat/utils/getEmotesByText';\nimport * as htmlEntity from 'features/chat/utils/htmlEntity';\nimport { usersSelector, emotesSelector } from 'features/chat/selectors';\n\ninterface ASuggestions {\n  isActive: boolean;\n  activeIndex: number;\n  start: number;\n  end: number;\n}\ninterface UserSuggestions extends ASuggestions {\n  type: 'users';\n  items: string[];\n}\ninterface EmoteSuggestions extends ASuggestions {\n  type: 'emotes';\n  items: htmlEntity.Emote[];\n}\nexport type SuggestionsState = UserSuggestions | EmoteSuggestions;\n\nconst suggestionsInitialState: SuggestionsState = {\n  type: 'users',\n  isActive: false,\n  items: [],\n  activeIndex: 0,\n  start: 0,\n  end: 0,\n};\n\nconst setSuggestionsIndexUp = ({\n  activeIndex,\n  items,\n  ...rest\n}: SuggestionsState) =>\n  ({\n    activeIndex: activeIndex === 0 ? items.length - 1 : activeIndex - 1,\n    items,\n    ...rest,\n  } as SuggestionsState);\n\nconst setSuggestionsIndexDown = ({\n  activeIndex,\n  items,\n  ...rest\n}: SuggestionsState) =>\n  ({\n    activeIndex: activeIndex === items.length - 1 ? 0 : activeIndex + 1,\n    items,\n    ...rest,\n  } as SuggestionsState);\n\nconst replaceSuggestionText = (\n  text: string,\n  { type, items, activeIndex, start, end }: SuggestionsState,\n) => {\n  if (items.length === 0) return text;\n\n  const currentItem = items[activeIndex];\n  const insertedText =\n    type === 'users'\n      ? `@${currentItem}`\n      : (currentItem as htmlEntity.Emote).alt;\n\n  const textBefore = text.substring(0, start);\n  const testAfter = text.substring(end) || ' ';\n\n  return `${textBefore}${insertedText}${testAfter}`;\n};\n\nconst useChatInput = (\n  setText: (value: React.SetStateAction<string>) => void,\n  onSendMessage: () => void,\n  chatInputRef: React.RefObject<HTMLElement>,\n) => {\n  const [suggestions, setSuggestions] = useSetState<SuggestionsState>(\n    suggestionsInitialState,\n  );\n\n  const emotes = useSelector(emotesSelector);\n  const users = useSelector(usersSelector);\n\n  const usersRef = useRef(users);\n  usersRef.current = users;\n  const emotesRef = useRef(emotes);\n  emotesRef.current = emotes;\n  const suggestionsRef = useRef(suggestions);\n  suggestionsRef.current = suggestions;\n\n  const handleChange = useCallback(\n    (e: React.ChangeEvent<HTMLTextAreaElement>) => {\n      const { value, selectionStart } = e.target;\n\n      setText(value);\n\n      const spaceIndexBefore = value.lastIndexOf(' ', selectionStart - 1);\n      const spaceIndexAfter = value.indexOf(' ', selectionStart);\n\n      const start = spaceIndexBefore === -1 ? 0 : spaceIndexBefore + 1;\n      const end = spaceIndexAfter === -1 ? value.length : spaceIndexAfter;\n\n      const word = value.substring(start, end);\n\n      const usersMatch = SUGGESTION_TYPES.users.regex.exec(word);\n\n      if (usersMatch) {\n        const [, beginText] = usersMatch;\n        const items = getUsersByBeginText(\n          beginText,\n          usersRef.current,\n          SUGGESTION_TYPES.users.limit,\n        );\n\n        setSuggestions({\n          type: 'users',\n          isActive: true,\n          items,\n          activeIndex: 0,\n          start,\n          end,\n        });\n\n        return;\n      }\n\n      const emotesMatch = SUGGESTION_TYPES.emotes.regex.exec(word);\n\n      if (emotesMatch && emotesRef.current) {\n        const [, text] = emotesMatch;\n        const items = getEmotesByText(\n          text,\n          emotesRef.current,\n          SUGGESTION_TYPES.emotes.limit,\n        );\n\n        setSuggestions({\n          type: 'emotes',\n          isActive: true,\n          items,\n          activeIndex: 0,\n          start,\n          end,\n        });\n\n        return;\n      }\n\n      if (suggestionsRef.current.isActive) {\n        setSuggestions(suggestionsInitialState);\n      }\n    },\n    [setText, setSuggestions, suggestionsRef],\n  );\n\n  const handleKeyUp = useCallback(\n    (e: React.KeyboardEvent<HTMLTextAreaElement>) => {},\n    [],\n  );\n\n  const handleKeyDown = useCallback(\n    (e: React.KeyboardEvent<HTMLTextAreaElement>) => {\n      if (suggestionsRef.current.isActive) {\n        if (e.key === 'Enter' || e.key === 'Tab') {\n          e.preventDefault();\n          setText((t) => replaceSuggestionText(t, suggestionsRef.current));\n          setSuggestions(suggestionsInitialState);\n\n          return;\n        }\n\n        if (e.key === 'ArrowUp') {\n          e.preventDefault();\n          setSuggestions(setSuggestionsIndexUp);\n          return;\n        }\n\n        if (e.key === 'ArrowDown') {\n          e.preventDefault();\n          setSuggestions(setSuggestionsIndexDown);\n          return;\n        }\n\n        if (e.key === 'Escape') {\n          setSuggestions({ isActive: false });\n          return;\n        }\n      }\n\n      if (!suggestionsRef.current.isActive) {\n        if (e.key === 'Enter') {\n          e.preventDefault();\n          onSendMessage();\n        }\n      }\n    },\n    [onSendMessage, setText, setSuggestions, suggestionsRef],\n  );\n\n  const handleSuggestionMouseEnter = useCallback(\n    (activeIndex: number) => setSuggestions({ activeIndex }),\n    [setSuggestions],\n  );\n\n  const handleSuggestionClick = useCallback(\n    (activeIndex: number) => {\n      setText((t) =>\n        replaceSuggestionText(t, { ...suggestionsRef.current, activeIndex }),\n      );\n\n      if (chatInputRef.current) {\n        chatInputRef.current.focus();\n      }\n\n      setSuggestions(suggestionsInitialState);\n    },\n    [setText, setSuggestions, chatInputRef],\n  );\n\n  const handleBlur = useCallback(() => {\n    setSuggestions({ isActive: false });\n  }, [setSuggestions]);\n\n  return {\n    suggestions,\n    handleChange,\n    handleKeyUp,\n    handleKeyDown,\n    handleBlur,\n    handleSuggestionMouseEnter,\n    handleSuggestionClick,\n  };\n};\n\nexport default useChatInput;\n","import { useEffect } from 'react';\nimport arePassiveEventsSupported from 'are-passive-events-supported';\nimport useLatest from 'use-latest';\n\nconst MOUSEDOWN = 'mousedown';\nconst TOUCHSTART = 'touchstart';\n\ntype HandledEvents = [typeof MOUSEDOWN, typeof TOUCHSTART];\ntype HandledEventsType = HandledEvents[number];\ntype PossibleEvent = {\n  [Type in HandledEventsType]: HTMLElementEventMap[Type];\n}[HandledEventsType];\ntype Handler = (event: PossibleEvent) => void;\n\nconst events: HandledEvents = [MOUSEDOWN, TOUCHSTART];\n\nconst arePassiveEvents = arePassiveEventsSupported();\n\nconst getOptions = (event: HandledEventsType) =>\n  event === MOUSEDOWN && arePassiveEvents ? { passive: true } : undefined;\n\nconst isContainsNode = (el: HTMLElement | null, node: Node) =>\n  el && el.contains(node);\n\nconst useOnClickOutside = (\n  ref:\n    | React.RefObject<HTMLElement>\n    | React.RefObject<React.RefObject<HTMLElement>[]>,\n  handler: Handler | null,\n) => {\n  const handlerRef = useLatest(handler);\n\n  useEffect(() => {\n    if (!handler) {\n      return;\n    }\n\n    const listener = (event: PossibleEvent) => {\n      if (!ref.current || !handlerRef.current) return;\n\n      const isContains = Array.isArray(ref.current)\n        ? ref.current.some((r) =>\n            isContainsNode(r.current, event.target as Node),\n          )\n        : isContainsNode(ref.current, event.target as Node);\n\n      if (isContains) {\n        return;\n      }\n\n      handlerRef.current(event);\n    };\n\n    events.forEach((event) => {\n      document.addEventListener(event, listener, getOptions(event));\n    });\n\n    // eslint-disable-next-line consistent-return\n    return () => {\n      events.forEach((event) => {\n        document.removeEventListener(\n          event,\n          listener,\n          getOptions(event) as EventListenerOptions,\n        );\n      });\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [!handler]);\n};\n\nexport default useOnClickOutside;\n","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React from \"react\";\n\nvar _ref = /*#__PURE__*/React.createElement(\"path\", {\n  fill: \"currentColor\",\n  d: \"M8.5 10L4 5.5 5.5 4 10 8.5 14.5 4 16 5.5 11.5 10l4.5 4.5-1.5 1.5-4.5-4.5L5.5 16 4 14.5 8.5 10z\"\n});\n\nconst SvgClose = ({\n  svgRef,\n  title,\n  ...props\n}) => /*#__PURE__*/React.createElement(\"svg\", _extends({\n  viewBox: \"0 0 20 20\",\n  ref: svgRef\n}, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref);\n\nconst ForwardRef = React.forwardRef((props, ref) => /*#__PURE__*/React.createElement(SvgClose, _extends({\n  svgRef: ref\n}, props)));\nexport default __webpack_public_path__ + \"static/media/close.992b249e.svg\";\nexport { ForwardRef as ReactComponent };","import styled, { css } from 'styled-components';\n\nconst sizes = {\n  small: css`\n    width: 24px;\n    height: 24px;\n  `,\n  medium: css`\n    width: 30px;\n    height: 30px;\n  `,\n  // large: css``,\n};\n\nconst IconButton = styled.button.attrs({\n  type: 'button',\n})<{ size?: 'small' | 'medium' }>`\n  margin: 0;\n  padding: 0;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: none;\n  border: none;\n  outline: none;\n  color: #fff;\n  border-radius: 4px;\n  cursor: pointer;\n\n  ${(p) => sizes[p.size || 'medium']};\n\n  &:hover,\n  &:focus {\n    background-color: rgba(255, 255, 255, 0.15);\n  }\n\n  &:active {\n    background-color: rgba(255, 255, 255, 0.2);\n  }\n\n  &:focus {\n    box-shadow: 0 0 6px 0 #772ce8;\n  }\n`;\n\nexport default IconButton;\n","import React from 'react';\nimport styled from 'styled-components';\n\nimport { ReactComponent as CloseIconSvg } from 'icons/close.svg';\nimport IconButton from 'components/IconButton';\n\nconst ChatModalRoot = styled.div`\n  height: 100%;\n  box-shadow: rgba(0, 0, 0, 0.4) 0px 4px 8px 0px,\n    rgba(0, 0, 0, 0.4) 0px 0px 4px 0px;\n  background-color: #18181b;\n  white-space: normal;\n  color: #fff;\n  border-radius: 4px;\n`;\nconst CloseButton = styled(IconButton).attrs({ size: 'small' })`\n  position: absolute;\n  top: 5px;\n  right: 5px;\n`;\nconst CloseIcon = styled(CloseIconSvg)`\n  display: block;\n  width: 20px;\n  height: 20px;\n`;\n\ntype Props = {\n  children: React.ReactNode;\n  onClose: (event: React.MouseEvent<HTMLButtonElement, MouseEvent>) => void;\n};\n\nconst ChatModal = ({ children, onClose }: Props) => (\n  <ChatModalRoot>\n    <CloseButton onClick={onClose}>\n      <CloseIcon />\n    </CloseButton>\n    {children}\n  </ChatModalRoot>\n);\n\nexport default ChatModal;\n","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React from \"react\";\n\nvar _ref = /*#__PURE__*/React.createElement(\"g\", {\n  fill: \"currentColor\"\n}, /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M7 11a1 1 0 100-2 1 1 0 000 2zm7-1a1 1 0 11-2 0 1 1 0 012 0zm-4 4a2 2 0 002-2H8a2 2 0 002 2z\"\n}), /*#__PURE__*/React.createElement(\"path\", {\n  fillRule: \"evenodd\",\n  d: \"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-2 0a6 6 0 11-12 0 6 6 0 0112 0z\",\n  clipRule: \"evenodd\"\n}));\n\nconst SvgSmileyFace = ({\n  svgRef,\n  title,\n  ...props\n}) => /*#__PURE__*/React.createElement(\"svg\", _extends({\n  viewBox: \"0 0 20 20\",\n  ref: svgRef\n}, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref);\n\nconst ForwardRef = React.forwardRef((props, ref) => /*#__PURE__*/React.createElement(SvgSmileyFace, _extends({\n  svgRef: ref\n}, props)));\nexport default __webpack_public_path__ + \"static/media/smiley-face.1cc055ed.svg\";\nexport { ForwardRef as ReactComponent };","import CustomScrollbar from 'react-scrollbars-custom';\nimport styled from 'styled-components';\n\nconst Scrollbar = styled(CustomScrollbar).attrs({\n  disableTracksWidthCompensation: true,\n})`\n  overflow-y: auto;\n\n  .ScrollbarsCustom-Content {\n    padding: 0 !important;\n  }\n\n  .ScrollbarsCustom-TrackY {\n    background: none !important;\n  }\n\n  .ScrollbarsCustom-ThumbY {\n    margin-left: auto;\n    margin-right: auto;\n    width: 6px !important;\n  }\n`;\n\nexport default Scrollbar;\n","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React from \"react\";\n\nvar _ref = /*#__PURE__*/React.createElement(\"path\", {\n  fill: \"currentColor\",\n  fillRule: \"evenodd\",\n  d: \"M13.192 14.606a7 7 0 111.414-1.414l3.101 3.1-1.414 1.415-3.1-3.1zM14 9A5 5 0 114 9a5 5 0 0110 0z\",\n  clipRule: \"evenodd\"\n});\n\nconst SvgSearch = ({\n  svgRef,\n  title,\n  ...props\n}) => /*#__PURE__*/React.createElement(\"svg\", _extends({\n  viewBox: \"0 0 20 20\",\n  ref: svgRef\n}, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref);\n\nconst ForwardRef = React.forwardRef((props, ref) => /*#__PURE__*/React.createElement(SvgSearch, _extends({\n  svgRef: ref\n}, props)));\nexport default __webpack_public_path__ + \"static/media/search.a2f0945f.svg\";\nexport { ForwardRef as ReactComponent };","import React, { useState, useEffect, useRef } from 'react';\nimport { useSelector } from 'react-redux';\nimport styled from 'styled-components';\n\nimport type { RootState } from 'app/rootReducer';\nimport Scrollbar from 'components/Scrollbar';\nimport { emoteCategoriesSelector } from 'features/chat/selectors';\nimport type { EmoteCategory } from 'features/chat/utils/createEmoteCategories';\nimport { ReactComponent as SearchIconSvg } from 'icons/search.svg';\n\nconst EmotePickerRoot = styled.div`\n  padding-top: 30px;\n  padding-bottom: 16px;\n  height: 100%;\n`;\nconst Categories = styled.div`\n  height: calc(100% - 30px);\n`;\nconst Category = styled.div`\n  padding-top: 10px;\n  padding-right: 16px;\n  padding-left: 16px;\n\n  &:not(:last-child) {\n    padding-bottom: 10px;\n    border-bottom: 1px solid rgba(255, 255, 255, 0.15);\n  }\n`;\nconst CategoryHeader = styled.div`\n  padding-bottom: 10px;\n  font-size: 12px;\n  font-weight: bold;\n  color: rgba(255, 255, 255, 0.8);\n`;\nconst CategoryItems = styled.div``;\nconst Emote = styled.img`\n  padding: 2px;\n  width: 32px;\n  height: 32px;\n  object-fit: contain;\n\n  &:hover {\n    background-color: rgba(119, 44, 232, 0.2);\n    cursor: pointer;\n  }\n`;\nconst SearchBlock = styled.div`\n  position: relative;\n  padding: 0 16px;\n  color: #adadb8;\n`;\nconst SearchInput = styled.input`\n  padding-left: 30px;\n  padding-right: 10px;\n  width: 100%;\n  height: 30px;\n  color: #efeff1;\n  font-family: inherit;\n  line-height: 1.5;\n  background-clip: padding-box;\n  background-color: rgba(255, 255, 255, 0.15);\n  border: 2px solid rgba(255, 255, 255, 0.15);\n  outline: 0;\n  border-radius: 4px;\n  appearance: none;\n  transition: box-shadow 0.1s ease-in, border 0.1s ease-in,\n    background-color 0.1s ease-in;\n\n  &:focus {\n    background-color: #000;\n    border-color: #9147ff;\n  }\n`;\nconst SearchIcon = styled(SearchIconSvg)`\n  position: absolute;\n  top: 50%;\n  left: 21px;\n  display: block;\n  width: 20px;\n  height: 20px;\n  transform: translateY(-50%);\n`;\n\ntype Props = {\n  onEmoteClick: (name: string) => void;\n};\n\nconst EmotePicker = ({ onEmoteClick }: Props) => {\n  const [search, setSearch] = useState('');\n  const searchInputRef = useRef<HTMLInputElement>(null);\n  const emoteCategories = useSelector((state: RootState) =>\n    emoteCategoriesSelector(state, search),\n  );\n\n  useEffect(() => {\n    if (searchInputRef.current) {\n      searchInputRef.current.focus();\n    }\n\n    return () => setSearch('');\n  }, []);\n\n  const renderCategory = ({ title, items }: EmoteCategory, key: number) => (\n    <Category key={key}>\n      {!!title && <CategoryHeader>{title}</CategoryHeader>}\n      <CategoryItems>\n        {items.map(({ alt, src, srcSet }) => (\n          <Emote\n            key={alt}\n            alt={alt}\n            src={src}\n            srcSet={srcSet}\n            onClick={() => onEmoteClick(alt)}\n          />\n        ))}\n      </CategoryItems>\n    </Category>\n  );\n\n  return (\n    <EmotePickerRoot>\n      <SearchBlock>\n        <SearchIcon />\n        <SearchInput\n          ref={searchInputRef}\n          placeholder=\"Search for Emotes\"\n          value={search}\n          onChange={(e) => setSearch(e.target.value)}\n        />\n      </SearchBlock>\n      <Categories>\n        <Scrollbar>{emoteCategories.map(renderCategory)}</Scrollbar>\n      </Categories>\n    </EmotePickerRoot>\n  );\n};\n\nexport default EmotePicker;\n","/* eslint-disable react/prop-types */\nimport React, { useState, useRef } from 'react';\nimport { useSelector } from 'react-redux';\nimport styled, { css } from 'styled-components';\nimport TextareaAutosize from 'react-textarea-autosize';\nimport useOnClickOutside from 'hooks/useOnClickOutside';\n\nimport ChatModal from 'components/ChatModal';\nimport IconButton from 'components/IconButton';\nimport { ReactComponent as SmileyFaceIconSvg } from 'icons/smiley-face.svg';\nimport EmotePicker from 'features/chat/components/EmotePicker';\nimport { SuggestionsState } from 'features/chat/hooks/useChatInput';\nimport { isEmotesLoadedSelector } from 'features/chat/selectors';\nimport * as htmlEntity from 'features/chat/utils/htmlEntity';\n\nconst ChatInputRoot = styled.div`\n  padding-left: 10px;\n  padding-right: 10px;\n  padding-bottom: 10px;\n  background-color: #18181b;\n\n  & > :not(:last-child) {\n    margin-bottom: 10px;\n  }\n`;\nconst ChatInputInner = styled.div`\n  position: relative;\n`;\nconst Suggestions = styled.div`\n  position: absolute;\n  left: 0;\n  right: 0;\n  bottom: 100%;\n  margin-left: -5px;\n  margin-bottom: -5px;\n  margin-right: -5px;\n  margin-bottom: 0;\n  padding-top: 10px;\n  padding-bottom: 5px;\n  padding-left: 10px;\n  padding-right: 10px;\n  border: 1px solid rgba(255, 255, 255, 0.15);\n  border-bottom: none;\n  background-color: #18181b;\n  color: #fff;\n  border-top-left-radius: 6px;\n  border-top-right-radius: 6px;\n  /* box-shadow: 0 1px 2px rgba(0, 0, 0, 0.15), 0 0px 2px rgba(0, 0, 0, 0.1); */\n`;\nconst SuggestionItem = styled.div<{ isActive: boolean }>`\n  display: flex;\n  justify-content: flex-start;\n  align-items: center;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  padding-left: 10px;\n  padding-right: 10px;\n  border-radius: 2px;\n  background-color: ${(p) =>\n    p.isActive ? 'rgba(255, 255, 255, 0.15)' : 'transparent'};\n  cursor: pointer;\n`;\nconst SuggestionImage = styled.img`\n  margin-right: 8px;\n  width: 28px;\n  height: 28px;\n  object-fit: contain;\n`;\nconst TextareaInput = styled.div`\n  position: relative;\n`;\nconst TextareaWrapper = styled.div<{ isSuggestions: boolean }>`\n  ${(p) =>\n    p.isSuggestions &&\n    css`\n      margin-left: -5px;\n      margin-bottom: -5px;\n      margin-right: -5px;\n      padding: 5px;\n      border: 1px solid rgba(255, 255, 255, 0.15);\n      border-top: none;\n      border-bottom-left-radius: 6px;\n      border-bottom-right-radius: 6px;\n      /* box-shadow: 0 2px 3px -1px rgba(0, 0, 0, 0.1),\n        0 2px 2px -2px rgba(0, 0, 0, 0.02); */\n\n      & > ${TextareaInput} {\n        margin-left: -1px;\n        margin-bottom: -1px;\n        margin-right: -1px;\n      }\n    `};\n`;\nconst EmotesModal = styled.div`\n  position: absolute;\n  top: auto;\n  right: 0;\n  bottom: 100%;\n  margin-bottom: 8px;\n  width: 320px;\n  height: 405px;\n  min-width: 0;\n  white-space: nowrap;\n`;\n// TODO: remove this after styled-components fix this\n/* eslint-disable react/jsx-props-no-spreading, @typescript-eslint/no-unused-vars */\nconst TextareaAutosizeFiltered = ({ showScroll, ...rest }: any) => (\n  <TextareaAutosize {...rest} />\n);\n/* eslint-enable react/jsx-props-no-spreading, @typescript-eslint/no-unused-vars */\nconst Textarea = styled(TextareaAutosizeFiltered)<{ showScroll: boolean }>`\n  display: block;\n  padding-top: 10px;\n  padding-bottom: 10px;\n  padding-left: 10px;\n  padding-right: 32px;\n  width: 100%;\n  height: 38px;\n  max-height: 91px;\n  min-height: 40px;\n  overflow-x: hidden;\n  overflow-y: ${(p) => (p.showScroll ? 'auto' : 'hidden')};\n  border: 2px solid transparent;\n  background-color: rgba(255, 255, 255, 0.15);\n  font-family: inherit;\n  font-size: 12px;\n  line-height: 1.5;\n  border-radius: 4px;\n  outline: none;\n  color: #fff;\n  resize: none;\n  transition-duration: 0.1s;\n  transition-timing-function: ease-in;\n  transition-property: box-shadow, border, background-color;\n\n  &:focus {\n    background-color: #000;\n    border-color: #9147ff;\n  }\n\n  &[disabled] {\n    opacity: 0.5;\n    pointer-events: none;\n  }\n`;\nconst EmotesButton = styled(IconButton)`\n  position: absolute;\n  right: 5px;\n  bottom: 5px;\n`;\nconst SmileyFaceIcon = styled(SmileyFaceIconSvg)`\n  display: block;\n  width: 20px;\n  height: 20px;\n`;\n\ntype Props = {\n  text: string;\n  suggestions: SuggestionsState;\n  isDisabled: boolean;\n  onEmoteClick: (name: string) => void;\n  onChange: (event: React.ChangeEvent<HTMLTextAreaElement>) => void;\n  onKeyUp: (event: React.KeyboardEvent<HTMLTextAreaElement>) => void;\n  onKeyDown: (event: React.KeyboardEvent<HTMLTextAreaElement>) => void;\n  onBlur: () => void;\n  onSuggestionMouseEnter: (index: number) => void;\n  onSuggestionClick: (index: number) => void;\n};\n\nconst ChatInput = React.forwardRef<HTMLTextAreaElement, Props>(\n  (\n    {\n      text,\n      suggestions,\n      isDisabled,\n      onEmoteClick,\n      onChange,\n      onKeyUp,\n      onKeyDown,\n      onBlur,\n      onSuggestionMouseEnter,\n      onSuggestionClick,\n    },\n    textareaRef,\n  ) => {\n    const chatInputRef = useRef(null);\n    const suggestionsRef = useRef<HTMLDivElement>(null);\n    const suggestionNodesRef = useRef([\n      textareaRef,\n      suggestionsRef,\n    ] as React.RefObject<HTMLElement>[]);\n\n    useOnClickOutside(suggestionNodesRef, () => onBlur());\n\n    const [isShowTextareaScroll, setIsShowTextareaScroll] = useState(false);\n    const [isEmotesModalVisible, setIsEmotesModalVisible] = useState(false);\n    const isEmotesLoaded = useSelector(isEmotesLoadedSelector);\n    const handleCloseEmotesModal = () => setIsEmotesModalVisible(false);\n\n    useOnClickOutside(chatInputRef, handleCloseEmotesModal);\n\n    const renderSuggestions = ({\n      type,\n      items,\n      activeIndex,\n    }: SuggestionsState) => {\n      const renderUser = (name: string, index: number) => (\n        <SuggestionItem\n          key={name}\n          isActive={index === activeIndex}\n          onMouseEnter={() => onSuggestionMouseEnter(index)}\n          onClick={() => onSuggestionClick(index)}\n        >\n          {name}\n        </SuggestionItem>\n      );\n\n      const renderEmote = (\n        { src, srcSet, alt }: htmlEntity.Emote,\n        index: number,\n      ) => (\n        <SuggestionItem\n          key={alt}\n          isActive={index === activeIndex}\n          onMouseEnter={() => onSuggestionMouseEnter(index)}\n          onClick={() => onSuggestionClick(index)}\n        >\n          <SuggestionImage src={src} srcSet={srcSet} alt={alt} />\n          {alt}\n        </SuggestionItem>\n      );\n\n      const renderItems = () =>\n        type === 'users'\n          ? (items as string[]).map(renderUser)\n          : (items as htmlEntity.Emote[]).map(renderEmote);\n\n      return (\n        <Suggestions ref={suggestionsRef}>\n          {items.length ? renderItems() : 'No matches'}\n        </Suggestions>\n      );\n    };\n\n    const renderEmotesButton = () => (\n      <EmotesButton\n        onClick={() => setIsEmotesModalVisible(!isEmotesModalVisible)}\n      >\n        <SmileyFaceIcon />\n      </EmotesButton>\n    );\n\n    const renderEmotesModal = () => (\n      <EmotesModal>\n        <ChatModal onClose={handleCloseEmotesModal}>\n          <EmotePicker onEmoteClick={onEmoteClick} />\n        </ChatModal>\n      </EmotesModal>\n    );\n\n    const handleHeightChange = (height: number) =>\n      setIsShowTextareaScroll(height >= 96);\n\n    return (\n      <ChatInputRoot ref={chatInputRef}>\n        <ChatInputInner>\n          {suggestions.isActive && renderSuggestions(suggestions)}\n          <TextareaWrapper isSuggestions={suggestions.isActive}>\n            <TextareaInput>\n              <Textarea\n                inputRef={textareaRef}\n                value={text}\n                placeholder=\"Send a message\"\n                maxLength={500}\n                maxRows={4}\n                disabled={isDisabled}\n                showScroll={isShowTextareaScroll}\n                onChange={onChange}\n                onKeyUp={onKeyUp}\n                onKeyDown={onKeyDown}\n                onHeightChange={handleHeightChange}\n              />\n              {isEmotesLoaded && renderEmotesButton()}\n            </TextareaInput>\n          </TextareaWrapper>\n          {isEmotesModalVisible && renderEmotesModal()}\n        </ChatInputInner>\n      </ChatInputRoot>\n    );\n  },\n);\n\nexport default React.memo(ChatInput);\n","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React from \"react\";\n\nvar _ref = /*#__PURE__*/React.createElement(\"g\", {\n  fill: \"currentColor\"\n}, /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M10 8a2 2 0 100 4 2 2 0 000-4z\"\n}), /*#__PURE__*/React.createElement(\"path\", {\n  fillRule: \"evenodd\",\n  d: \"M9 2h2a2.01 2.01 0 001.235 1.855l.53.22a2.01 2.01 0 002.185-.439l1.414 1.414a2.01 2.01 0 00-.439 2.185l.22.53A2.01 2.01 0 0018 9v2a2.01 2.01 0 00-1.855 1.235l-.22.53a2.01 2.01 0 00.44 2.185l-1.415 1.414a2.01 2.01 0 00-2.184-.439l-.531.22A2.01 2.01 0 0011 18H9a2.01 2.01 0 00-1.235-1.854l-.53-.22a2.009 2.009 0 00-2.185.438L3.636 14.95a2.009 2.009 0 00.438-2.184l-.22-.531A2.01 2.01 0 002 11V9c.809 0 1.545-.487 1.854-1.235l.22-.53a2.009 2.009 0 00-.438-2.185L5.05 3.636a2.01 2.01 0 002.185.438l.53-.22A2.01 2.01 0 009 2zm-4 8l1.464 3.536L10 15l3.535-1.464L15 10l-1.465-3.536L10 5 6.464 6.464 5 10z\",\n  clipRule: \"evenodd\"\n}));\n\nconst SvgGears = ({\n  svgRef,\n  title,\n  ...props\n}) => /*#__PURE__*/React.createElement(\"svg\", _extends({\n  viewBox: \"0 0 20 20\",\n  ref: svgRef\n}, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref);\n\nconst ForwardRef = React.forwardRef((props, ref) => /*#__PURE__*/React.createElement(SvgGears, _extends({\n  svgRef: ref\n}, props)));\nexport default __webpack_public_path__ + \"static/media/gears.5f76af43.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React from \"react\";\n\nvar _ref = /*#__PURE__*/React.createElement(\"path\", {\n  fill: \"#fff\",\n  d: \"M13 8l-5 5v18h6v5l5-5h4l9-9V8z\"\n});\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"path\", {\n  fill: \"#9147ff\",\n  d: \"M26 25l4-4V10H14v15h4v4l4-4z\"\n});\n\nvar _ref3 = /*#__PURE__*/React.createElement(\"path\", {\n  fill: \"#fff\",\n  d: \"M20 14h2v6h-2v-6zm7 0v6h-2v-6h2z\"\n});\n\nconst SvgTwitch = ({\n  svgRef,\n  title,\n  ...props\n}) => /*#__PURE__*/React.createElement(\"svg\", _extends({\n  viewBox: \"0 0 40 40\",\n  ref: svgRef\n}, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref, _ref2, _ref3);\n\nconst ForwardRef = React.forwardRef((props, ref) => /*#__PURE__*/React.createElement(SvgTwitch, _extends({\n  svgRef: ref\n}, props)));\nexport default __webpack_public_path__ + \"static/media/twitch.75e6e194.svg\";\nexport { ForwardRef as ReactComponent };","import styled from 'styled-components';\n\nconst Button = styled.button.attrs({ type: 'button' })`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 0 10px;\n  height: 30px;\n  border: none;\n  color: #fff;\n  background-color: #9147ff;\n  outline: none;\n  font-size: 12px;\n  border-radius: 4px;\n  text-decoration: none;\n  cursor: pointer;\n\n  &:hover {\n    background-color: #772ce8;\n  }\n\n  &:active {\n    background-color: #5c16c5;\n  }\n\n  &:focus {\n    box-shadow: 0 0 6px 0 #772ce8;\n  }\n\n  &[disabled] {\n    background-color: rgba(255, 255, 255, 0.26);\n    color: rgba(255, 255, 255, 0.8);\n    opacity: 0.5;\n    cursor: not-allowed;\n  }\n`;\n\nexport default Button;\n","import React from 'react';\nimport styled from 'styled-components';\n\nconst SwitchRoot = styled.div`\n  position: relative;\n  display: flex;\n  flex-direction: column;\n  line-height: 20px;\n`;\nconst Label = styled.label`\n  content: '';\n  position: relative;\n  display: inline-block;\n  order: 0;\n  width: 35px;\n  height: 20px;\n  vertical-align: bottom;\n  border-radius: 10px/50%;\n  background-color: rgba(0, 0, 0, 0.3);\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.15), 0 0 2px rgba(0, 0, 0, 0.1);\n  transition: background-color 0.1s ease;\n  cursor: pointer;\n\n  &:after {\n    content: '';\n    position: absolute;\n    top: 2px;\n    left: 2px;\n    bottom: 2px;\n    display: block;\n    width: 16px;\n    border-radius: 50%;\n    background-color: #fff;\n    transition: left 0.1s ease;\n  }\n`;\nconst Input = styled.input.attrs({ type: 'checkbox' })`\n  position: absolute;\n  opacity: 0;\n\n  &:checked + ${Label} {\n    background-color: #9147ff;\n\n    &:after {\n      content: '';\n      top: 2px;\n      left: calc(100% - 18px);\n    }\n\n    &:before {\n      content: '';\n      position: absolute;\n      top: 9px;\n      left: 10px;\n      display: block;\n      height: 3px;\n      width: 7px;\n      border-bottom: 2px solid #fff;\n      border-left: 2px solid #fff;\n      transform: translate3d(-50%, -50%, 0) rotate(-45deg);\n    }\n  }\n`;\n\ntype Props = {\n  id: string;\n  label: string;\n  checked?: boolean;\n  readOnly?: boolean;\n  onChange?: (event: React.ChangeEvent<HTMLInputElement>) => void;\n};\n\nconst Switch = ({ id, label, checked, readOnly, onChange }: Props) => (\n  <SwitchRoot>\n    <Input\n      id={id}\n      aria-label={label}\n      checked={checked}\n      readOnly={readOnly}\n      onChange={onChange}\n    />\n    <Label htmlFor={id} />\n  </SwitchRoot>\n);\n\nSwitch.defaultProps = {\n  checked: false,\n  readOnly: false,\n  onChange: () => {},\n};\n\nexport default Switch;\n","import React, { useCallback } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { Link } from 'react-router-dom';\nimport styled from 'styled-components';\n\nimport Scrollbar from 'components/Scrollbar';\nimport Switch from 'components/Switch';\nimport {\n  userDisplayNameSelector,\n  userColorSelector,\n  userBadgesImagesSelector,\n} from 'features/chat/selectors';\nimport { isAuthSelector } from 'features/auth/authSlice';\nimport { changeChatOption } from 'features/options/optionsSlice';\nimport { optionsSelector } from 'features/options/optionsSelectors';\n\nconst OptionsRoot = styled.div`\n  padding: 16px;\n  height: 100%;\n`;\nconst Header = styled.h2`\n  margin: 0;\n  padding: 0;\n  font-size: 14px;\n  text-align: center;\n  color: rgba(255, 255, 255, 0.8);\n`;\nconst Categories = styled(Scrollbar)`\n  height: 100%;\n`;\nconst Category = styled.div`\n  &:not(:last-child) {\n    padding-bottom: 10px;\n    border-bottom: 1px solid rgba(255, 255, 255, 0.15);\n  }\n`;\nconst CategoryHeader = styled.div`\n  padding: 8px 0;\n  font-weight: bold;\n  color: rgba(255, 255, 255, 0.6);\n`;\nconst CategoryItems = styled.div``;\nconst Option = styled.div`\n  display: flex;\n  justify-content: space-between;\n  padding: 4px 0;\n  cursor: pointer;\n`;\nconst OptionText = styled.span``;\nconst Profile = styled.div`\n  display: flex;\n  align-items: center;\n`;\nconst UserName = styled.div`\n  font-weight: bold;\n  color: ${(p) => p.color};\n`;\nconst LogOutButton = styled(Link)`\n  margin-left: auto;\n  color: #bf94ff;\n  text-decoration: none;\n  cursor: pointer;\n\n  &:focus,\n  &:hover {\n    color: #a970ff;\n    text-decoration: underline;\n  }\n\n  &:visited {\n    color: #a970ff;\n  }\n`;\nconst Badge = styled.img`\n  margin-right: 3px;\n  max-width: 100%;\n  vertical-align: middle;\n  border-radius: 3px;\n`;\n\nconst Options = () => {\n  const dispatch = useDispatch();\n  const options = useSelector(optionsSelector);\n\n  const isAuth = useSelector(isAuthSelector);\n\n  const userDisplayName = useSelector(userDisplayNameSelector);\n  const userColor = useSelector(userColorSelector);\n  const userBadgesImages = useSelector(userBadgesImagesSelector);\n\n  const renderOption = useCallback(\n    ({ id, name, title, description, value }) => (\n      <Option\n        key={id}\n        onClick={() => dispatch(changeChatOption({ name, value: !value }))}\n        title={description}\n      >\n        <OptionText>{title}</OptionText>\n        <Switch\n          id={id}\n          label={title}\n          checked={value}\n          onChange={() => dispatch(changeChatOption({ name, value }))}\n        />\n      </Option>\n    ),\n    [dispatch],\n  );\n\n  const renderProfileCategory = () => {\n    return (\n      <Category>\n        <CategoryHeader>Profile</CategoryHeader>\n        <CategoryItems>\n          <Profile>\n            {userBadgesImages.map(({ alt, label, src, srcSet }, key) => (\n              <Badge\n                // eslint-disable-next-line react/no-array-index-key\n                key={key}\n                alt={alt}\n                aria-label={label}\n                src={src}\n                srcSet={srcSet}\n              />\n            ))}\n            <UserName color={userColor}>{userDisplayName}</UserName>\n            <LogOutButton to=\"/chat/logout\">Log Out</LogOutButton>\n          </Profile>\n        </CategoryItems>\n      </Category>\n    );\n  };\n\n  const renderOptionsCategory = useCallback(\n    ({ title, items }, key) => (\n      <Category key={key}>\n        {!!title && <CategoryHeader>{title}</CategoryHeader>}\n        <CategoryItems>{items.map(renderOption)}</CategoryItems>\n      </Category>\n    ),\n    [renderOption],\n  );\n\n  return (\n    <OptionsRoot>\n      <Header>Chat settings</Header>\n      <Categories>\n        {isAuth && renderProfileCategory()}\n        {options.map(renderOptionsCategory)}\n      </Categories>\n    </OptionsRoot>\n  );\n};\n\nexport default Options;\n","import React, { useState, useRef } from 'react';\nimport { useSelector } from 'react-redux';\nimport styled, { css } from 'styled-components';\nimport { Link } from 'react-router-dom';\n\nimport useOnClickOutside from 'hooks/useOnClickOutside';\nimport { ReactComponent as GearsIconSvg } from 'icons/gears.svg';\nimport { ReactComponent as TwitchIconSvg } from 'icons/twitch.svg';\nimport Button from 'components/Button';\nimport IconButton from 'components/IconButton';\nimport ChatModal from 'components/ChatModal';\nimport Options from 'features/options/Options';\nimport { isAuthSelector, isAuthReadySelector } from 'features/auth/authSlice';\n\nconst ChatControlsRoot = styled.div`\n  position: relative;\n  padding-left: 10px;\n  padding-right: 10px;\n  padding-bottom: 10px;\n`;\nconst Controls = styled.div`\n  display: flex;\n  align-items: center;\n\n  & > :not(:last-child) {\n    margin-right: 8px;\n  }\n`;\nconst OptionsModal = styled.div`\n  position: absolute;\n  top: auto;\n  right: 10px;\n  bottom: 100%;\n  margin-bottom: 10px;\n  width: 320px;\n  height: 405px;\n  min-width: 0;\n  white-space: nowrap;\n`;\nexport const buttonStyles = css`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 0 10px;\n  height: 30px;\n  border: none;\n  color: #fff;\n  background-color: #9147ff;\n  outline: none;\n  font-size: 12px;\n  border-radius: 4px;\n  text-decoration: none;\n  cursor: pointer;\n\n  &:hover {\n    background-color: #772ce8;\n  }\n\n  &:active {\n    background-color: #5c16c5;\n  }\n\n  &:focus {\n    box-shadow: 0 0 6px 0 #772ce8;\n  }\n\n  &[disabled] {\n    background-color: rgba(255, 255, 255, 0.26);\n    color: rgba(255, 255, 255, 0.8);\n    opacity: 0.5;\n    cursor: not-allowed;\n  }\n`;\nconst OptionsButton = styled(IconButton)`\n  margin-left: auto;\n`;\nconst GearsIcon = styled(GearsIconSvg)`\n  display: block;\n  width: 20px;\n  height: 20px;\n`;\nconst TwitchIcon = styled(TwitchIconSvg)`\n  display: block;\n  margin-right: 4px;\n  width: 20px;\n  height: 20px;\n`;\n\ntype Props = {\n  isDisabled: boolean;\n  onSendMessage: () => void;\n};\n\nconst ChatControls = ({ isDisabled, onSendMessage }: Props) => {\n  const [isOptionsModalVisible, setIsOptionsModalVisible] = useState(false);\n  const optionsModalRef = useRef(null);\n  const optionsButtonRef = useRef(null);\n  const optionsNodesRef = useRef([optionsModalRef, optionsButtonRef]);\n\n  const isAuthReady = useSelector(isAuthReadySelector);\n  const isAuth = useSelector(isAuthSelector);\n\n  const handleCloseOptionsModal = () => setIsOptionsModalVisible(false);\n  useOnClickOutside(optionsNodesRef, handleCloseOptionsModal);\n\n  const renderSignInButton = () => (\n    <Button as={Link} to=\"/chat/auth\">\n      <TwitchIcon />\n      Sign in with Twitch\n    </Button>\n  );\n\n  const renderOptionsModal = () => (\n    <OptionsModal ref={optionsModalRef}>\n      <ChatModal onClose={handleCloseOptionsModal}>\n        <Options />\n      </ChatModal>\n    </OptionsModal>\n  );\n\n  return (\n    <ChatControlsRoot>\n      <Controls>\n        {isAuthReady && !isAuth && renderSignInButton()}\n        <OptionsButton\n          ref={optionsButtonRef}\n          onClick={() => setIsOptionsModalVisible((prev) => !prev)}\n        >\n          <GearsIcon />\n        </OptionsButton>\n        <Button disabled={isDisabled} onClick={onSendMessage}>\n          Chat\n        </Button>\n      </Controls>\n      {isOptionsModalVisible && renderOptionsModal()}\n    </ChatControlsRoot>\n  );\n};\n\nexport default React.memo(ChatControls);\n","import React, { useState } from 'react';\r\nimport styled, { css } from 'styled-components';\r\nimport { format } from 'date-fns/fp';\r\n\r\nimport {\r\n  Message as MessageType,\r\n  MessageEntity,\r\n} from 'features/chat/slice/messages';\r\nimport * as htmlEntity from 'features/chat/utils/htmlEntity';\r\n\r\ntype MessageRootProps = {\r\n  isAction: boolean;\r\n  isHistory: boolean;\r\n  isDeleted: boolean;\r\n  isMention: boolean;\r\n  isEven: boolean;\r\n};\r\n\r\nconst getChatMessageBg = (p: MessageRootProps) => {\r\n  if (p.isMention) return 'rgba(255, 0, 0, 0.3)';\r\n  if (p.isEven) return '#1f1925';\r\n  return 'transparent';\r\n};\r\n\r\nconst MessageRoot = styled.div<MessageRootProps>`\r\n  padding: 5px 20px;\r\n  color: ${(p) => (p.isAction ? p.color : '#fff')};\r\n  opacity: ${(p) => (p.isHistory || p.isDeleted ? '0.5' : '1')};\r\n  line-height: 20px;\r\n  word-wrap: break-word;\r\n  background-color: ${getChatMessageBg};\r\n`;\r\nconst Name = styled.span`\r\n  font-weight: bold;\r\n  color: ${(p) => p.color};\r\n  cursor: pointer;\r\n`;\r\nconst Emoji = styled.img`\r\n  display: inline-block;\r\n  margin-top: -5px;\r\n  margin-bottom: -4px;\r\n  width: 20px;\r\n  height: auto;\r\n  vertical-align: middle;\r\n`;\r\n// https://github.com/night/BetterTTV/blob/master/src/modules/emotes/style.css\r\n// prettier-ignore\r\nconst Emote = styled.img`\r\n  display: inline-block;\r\n  margin: -5px 0;\r\n  vertical-align: middle;\r\n\r\n  /* Prevent stacking of IceCold, SoSnowy */\r\n  &[data-emote-id='5849c9a4f52be01a7ee5f79d'] + &[data-emote-id='5849c9a4f52be01a7ee5f79d'],\r\n  &[data-emote-id='567b5b520e984428652809b6'] + &[data-emote-id='567b5b520e984428652809b6'] {\r\n    display: none;\r\n  }\r\n\r\n  /* IceCold */\r\n  &        + &[data-emote-id='5849c9a4f52be01a7ee5f79d'],\r\n  ${Emoji} + &[data-emote-id='5849c9a4f52be01a7ee5f79d'] {\r\n    margin-left: -33px;\r\n  }\r\n\r\n  /* SoSnowy */\r\n  &        + &[data-emote-id='567b5b520e984428652809b6'],\r\n  ${Emoji} + &[data-emote-id='567b5b520e984428652809b6'] {\r\n    margin-left: -32px;\r\n  }\r\n\r\n  /* SantaHat */\r\n  &        + &[data-emote-id='58487cc6f52be01a7ee5f205'],\r\n  ${Emoji} + &[data-emote-id='58487cc6f52be01a7ee5f205'] {\r\n    margin-left: -34px;\r\n    margin-top: -18px;\r\n  }\r\n\r\n  /* TopHat, CandyCane, ReinDeer */\r\n  &        + &[data-emote-id='5849c9c8f52be01a7ee5f79e'],\r\n  ${Emoji} + &[data-emote-id='5849c9c8f52be01a7ee5f79e'],\r\n  &        + &[data-emote-id='567b5c080e984428652809ba'],\r\n  ${Emoji} + &[data-emote-id='567b5c080e984428652809ba'],\r\n  &        + &[data-emote-id='567b5dc00e984428652809bd'],\r\n  ${Emoji} + &[data-emote-id='567b5dc00e984428652809bd'] {\r\n    margin-left: -31px;\r\n    margin-top: -18px;\r\n  }\r\n\r\n  /* cvHazmat, cvMask */\r\n  &        + &[data-emote-id='5e76d338d6581c3724c0f0b2'],\r\n  ${Emoji} + &[data-emote-id='5e76d338d6581c3724c0f0b2'],\r\n  &        + &[data-emote-id='5e76d399d6581c3724c0f0b8'],\r\n  ${Emoji} + &[data-emote-id='5e76d399d6581c3724c0f0b8'] {\r\n    margin-left: -34px;\r\n    height: 34px;\r\n    width: 34px;\r\n  }\r\n`;\r\nconst Mention = styled.span<{ isActive: boolean; isOwnMessage: boolean }>`\r\n  ${(p) =>\r\n    (p.isActive || p.isOwnMessage) &&\r\n    css`\r\n      padding: 2px 4px;\r\n    `};\r\n  ${(p) =>\r\n    p.isOwnMessage &&\r\n    css`\r\n      background-color: #40404a;\r\n      color: #fff;\r\n    `};\r\n  ${(p) =>\r\n    p.isActive &&\r\n    css`\r\n      background-color: #fafafa;\r\n      color: #18181b;\r\n    `};\r\n`;\r\nconst Link = styled.a`\r\n  color: #bf94ff;\r\n  text-decoration: none;\r\n  cursor: pointer;\r\n\r\n  &:focus,\r\n  &:hover {\r\n    color: #a970ff;\r\n    text-decoration: underline;\r\n  }\r\n\r\n  &:visited {\r\n    color: #a970ff;\r\n  }\r\n`;\r\nconst Timestamp = styled.span`\r\n  margin-right: 5px;\r\n  color: rgba(255, 255, 255, 0.6);\r\n`;\r\nconst Badge = styled.img`\r\n  margin-bottom: 2px;\r\n  margin-right: 3px;\r\n  max-width: 100%;\r\n  vertical-align: middle;\r\n  border-radius: 3px;\r\n`;\r\n\r\nconst renderMessageArray = (login: string, userLogin: string | null) => (\r\n  item: MessageEntity,\r\n  key: number,\r\n) => {\r\n  if (typeof item !== 'object') return item;\r\n\r\n  if (\r\n    item.type === 'twitch-emote' ||\r\n    item.type === 'bttv-emote' ||\r\n    item.type === 'ffz-emote'\r\n  ) {\r\n    return (\r\n      <Emote\r\n        key={key}\r\n        src={item.src}\r\n        srcSet={item.srcSet}\r\n        alt={item.alt}\r\n        data-emote-id={item.id}\r\n      />\r\n    );\r\n  }\r\n\r\n  if (item.type === 'emoji') {\r\n    return <Emoji key={key} src={item.src} alt={item.alt} />;\r\n  }\r\n\r\n  if (item.type === 'mention') {\r\n    return (\r\n      <Mention\r\n        key={key}\r\n        isActive={item.target === userLogin}\r\n        isOwnMessage={login === userLogin}\r\n      >\r\n        {item.text}\r\n      </Mention>\r\n    );\r\n  }\r\n\r\n  if (item.type === 'link') {\r\n    return (\r\n      <Link\r\n        key={key}\r\n        href={item.href}\r\n        rel=\"noreferrer noopener\"\r\n        target=\"_blank\"\r\n      >\r\n        {item.text}\r\n      </Link>\r\n    );\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\nconst renderBadges = (badges: htmlEntity.Badge[]) =>\r\n  badges.map(({ alt, label, src, srcSet }, key: number) => (\r\n    // eslint-disable-next-line react/no-array-index-key\r\n    <Badge key={key} alt={alt} aria-label={label} src={src} srcSet={srcSet} />\r\n  ));\r\n\r\ntype Props = {\r\n  message: MessageType;\r\n  userLogin: string | null;\r\n  isEven: boolean;\r\n  isShowTimestamps: boolean;\r\n  onNameRightClick: (name: string) => void;\r\n};\r\n\r\nconst MESSAGE_DELETED_LABEL = '<message deleted>';\r\n\r\nconst Message = ({\r\n  message: {\r\n    message,\r\n    entities,\r\n    user: { login, color, displayName, badges },\r\n    timestamp,\r\n    isHistory,\r\n    isAction,\r\n    isDeleted,\r\n  },\r\n  userLogin,\r\n  isEven,\r\n  isShowTimestamps,\r\n  // onNameClick,\r\n  onNameRightClick,\r\n}: Props) => {\r\n  const [isVisible, setIsVisible] = useState(false);\r\n  const isMention =\r\n    login !== userLogin && RegExp(userLogin as string, 'gi').test(message);\r\n\r\n  const handleNameRightClick = (\r\n    e: React.MouseEvent<HTMLSpanElement, MouseEvent>,\r\n  ) => {\r\n    onNameRightClick(displayName);\r\n    e.preventDefault();\r\n  };\r\n\r\n  return (\r\n    <MessageRoot\r\n      isHistory={isHistory}\r\n      isAction={isAction}\r\n      isEven={isEven}\r\n      isMention={isMention}\r\n      isDeleted={isDeleted}\r\n      color={color}\r\n    >\r\n      {isShowTimestamps && (\r\n        <Timestamp>{format('h:mm', new Date(timestamp))}</Timestamp>\r\n      )}\r\n      {badges.length > 0 && renderBadges(badges)}\r\n      <Name color={color} onContextMenu={handleNameRightClick}>\r\n        {displayName}\r\n      </Name>\r\n      {isAction ? ' ' : ': '}\r\n      {isDeleted && !isVisible ? (\r\n        // eslint-disable-next-line jsx-a11y/anchor-is-valid\r\n        <Link onClick={() => setIsVisible(true)}>{MESSAGE_DELETED_LABEL}</Link>\r\n      ) : (\r\n        entities.map(renderMessageArray(login, userLogin))\r\n      )}\r\n    </MessageRoot>\r\n  );\r\n};\r\n\r\nexport default React.memo(Message);\r\n","import React from 'react';\nimport styled from 'styled-components';\n\nimport { Notice as NoticeType } from 'features/chat/slice/messages';\n\nconst NoticeRoot = styled.div<{ isEven: boolean }>`\n  padding: 5px 20px;\n  color: rgba(255, 255, 255, 0.6);\n  line-height: 20px;\n  word-wrap: break-word;\n  background-color: ${(p) => (p.isEven ? '#1f1925' : 'transparent')};\n`;\n\ntype Props = {\n  message: NoticeType;\n  isEven: boolean;\n};\n\nconst Notice = ({ message: { message }, isEven }: Props) => (\n  <NoticeRoot isEven={isEven}>{message}</NoticeRoot>\n);\n\nexport default Notice;\n","import React from 'react';\nimport styled from 'styled-components';\n\nimport { UserNotice as UserNoticeType } from 'features/chat/slice/messages';\n\nconst UserNoticeRoot = styled.div`\n  padding: 5px 20px 5px 16px;\n  line-height: 20px;\n  word-wrap: break-word;\n  border-left: 4px solid #9147ff;\n  color: #fff;\n`;\n\ntype Props = {\n  message: UserNoticeType;\n};\n\nconst UserNotice = ({ message: { systemMessage } }: Props) => (\n  <UserNoticeRoot>{systemMessage}</UserNoticeRoot>\n);\n\nexport default UserNotice;\n","import React from 'react';\n\nimport assertNever from 'utils/assertNever';\nimport { ChatMessage as ChatMessageType } from 'features/chat/slice/messages';\nimport Message from 'features/chat/components/Message';\nimport Notice from 'features/chat/components/Notice';\nimport UserNotice from 'features/chat/components/UserNotice';\n\ntype Props = {\n  message: ChatMessageType;\n  userLogin: string | null;\n  isEven: boolean;\n  isShowTimestamps: boolean;\n  // onNameClick: (name: string) => void;\n  onNameRightClick: (name: string) => void;\n};\n\nconst ChatMessage = ({\n  message,\n  userLogin,\n  isEven,\n  isShowTimestamps,\n  // onNameClick,\n  onNameRightClick,\n}: Props) => {\n  if (message.type === 'message') {\n    return (\n      <Message\n        message={message}\n        userLogin={userLogin}\n        isEven={isEven}\n        isShowTimestamps={isShowTimestamps}\n        // onNameClick={onNameClick}\n        onNameRightClick={onNameRightClick}\n      />\n    );\n  }\n\n  if (message.type === 'notice') {\n    return <Notice message={message} isEven={isEven} />;\n  }\n\n  if (message.type === 'user-notice') {\n    return <UserNotice message={message} />;\n  }\n\n  return assertNever(message);\n};\n\nexport default React.memo(ChatMessage);\n","import React, { useState, useEffect, useRef } from 'react';\nimport { useSelector } from 'react-redux';\nimport styled from 'styled-components';\nimport ScrollbarType from 'react-scrollbars-custom';\nimport { ScrollState } from 'react-scrollbars-custom/dist/types/types';\n\nimport Scrollbar from 'components/Scrollbar';\nimport ChatMessage from 'features/chat/components/ChatMessage';\nimport { messagesSelector, isEvenSelector } from 'features/chat/selectors';\nimport { userLoginSelector } from 'features/auth/authSlice';\nimport {\n  isShowTimestampsSelector,\n  isSplitChatSelector,\n} from 'features/options/optionsSelectors';\n\nconst MORE_MESSAGES_OFFSET = 100;\n\nconst MessagesRoot = styled.div`\n  position: relative;\n  flex-grow: 1;\n`;\nconst StyledScrollbar = styled(Scrollbar)`\n  .ScrollbarsCustom-Content {\n    padding-bottom: 10px !important;\n  }\n`;\nconst MoreMessagesButton = styled.button<{ isVisible: boolean }>`\n  position: absolute;\n  left: 50%;\n  bottom: 10px;\n  display: ${(p) => (p.isVisible ? 'block' : 'none')};\n  padding: 5px 20px;\n  background: rgba(0, 0, 0, 0.6);\n  color: #fff;\n  border-radius: 4px;\n  border: none;\n  outline: none;\n  cursor: pointer;\n  transform: translateX(-50%);\n`;\n\ntype Props = {\n  onNameRightClick: (name: string) => void;\n};\n\nconst Messages = ({ onNameRightClick }: Props) => {\n  const [\n    isMoreMessagesButtonVisible,\n    setIsMoreMessagesButtonVisible,\n  ] = useState(false);\n\n  const messages = useSelector(messagesSelector);\n  const userLogin = useSelector(userLoginSelector);\n\n  const isEven = useSelector(isEvenSelector);\n  const isShowTimestamps = useSelector(isShowTimestampsSelector);\n  const isSplitChat = useSelector(isSplitChatSelector);\n\n  const handleScrollUpdate = ({\n    clientHeight,\n    contentScrollHeight,\n    scrollTop,\n  }: ScrollState) => {\n    const maxScrollTop = contentScrollHeight - clientHeight;\n    const isVisible = scrollTop + MORE_MESSAGES_OFFSET < maxScrollTop;\n\n    setIsMoreMessagesButtonVisible(isVisible);\n  };\n\n  const scrollbarRef = useRef<ScrollbarType>(null);\n\n  const handleScrollToBottom = () => {\n    if (scrollbarRef.current) {\n      scrollbarRef.current.scrollToBottom();\n    }\n  };\n\n  useEffect(() => {\n    if (!isMoreMessagesButtonVisible) {\n      handleScrollToBottom();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [messages]);\n\n  const getIsEven = (key: number) => {\n    if (!isSplitChat) return false;\n    return isEven ? key % 2 === 1 : key % 2 === 0;\n  };\n\n  return (\n    <MessagesRoot>\n      <StyledScrollbar onUpdate={handleScrollUpdate} ref={scrollbarRef}>\n        {messages.map((message, key) => (\n          <ChatMessage\n            key={message.id}\n            message={message}\n            userLogin={userLogin}\n            isEven={getIsEven(key)}\n            isShowTimestamps={isShowTimestamps}\n            onNameRightClick={onNameRightClick}\n          />\n        ))}\n      </StyledScrollbar>\n      <MoreMessagesButton\n        onClick={handleScrollToBottom}\n        isVisible={isMoreMessagesButtonVisible}\n      >\n        More messages below\n      </MoreMessagesButton>\n    </MessagesRoot>\n  );\n};\n\nexport default Messages;\n","import React, { useState, useRef, useEffect } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport styled from 'styled-components';\n\nimport Button from 'components/Button';\n\nconst JoinChannelRoot = styled.div`\n  padding: 10px;\n  flex-grow: 1;\n  width: 320px;\n`;\nconst Title = styled.h2`\n  margin-top: 0;\n  margin-bottom: 10px;\n  padding: 0;\n  color: #fff;\n`;\nconst Controls = styled.div`\n  display: flex;\n\n  & > :not(:last-child) {\n    margin-right: 10px;\n  }\n`;\nconst Input = styled.input`\n  display: block;\n  padding: 4px 10px;\n  width: 100%;\n  border: 2px solid transparent;\n  background-color: rgba(255, 255, 255, 0.15);\n  font-family: inherit;\n  font-size: 12px;\n  line-height: 1.5;\n  border-radius: 4px;\n  outline: none;\n  color: #fff;\n  resize: none;\n  transition-duration: 0.1s;\n  transition-timing-function: ease-in;\n  transition-property: box-shadow, border, background-color;\n\n  &:focus {\n    background-color: #000;\n    border-color: #9147ff;\n  }\n\n  &[disabled] {\n    opacity: 0.5;\n    pointer-events: none;\n  }\n`;\nconst JoinButton = styled(Button)`\n  flex-shrink: none;\n`;\n\nconst JoinChannel = () => {\n  const history = useHistory();\n  const [value, setValue] = useState('');\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  useEffect(() => {\n    if (inputRef.current) {\n      inputRef.current.focus();\n    }\n  }, []);\n\n  const handleChangeChannel = () => {\n    history.push({\n      pathname: '/chat/',\n      hash: value,\n    });\n  };\n\n  const handleKeyPress = (e: React.KeyboardEvent<HTMLInputElement>) => {\n    if (e.key === 'Enter') {\n      handleChangeChannel();\n    }\n  };\n\n  return (\n    <JoinChannelRoot>\n      <Title>Channel to join: </Title>\n      <Controls>\n        <Input\n          ref={inputRef}\n          value={value}\n          onChange={(e) => setValue(e.target.value)}\n          onKeyPress={handleKeyPress}\n        />\n        <JoinButton onClick={handleChangeChannel} disabled={!value}>\n          Join\n        </JoinButton>\n      </Controls>\n    </JoinChannelRoot>\n  );\n};\n\nexport default JoinChannel;\n","import React, { useState, useCallback, useRef } from 'react';\nimport { useSelector } from 'react-redux';\nimport styled from 'styled-components';\n\nimport { isAuthSelector } from 'features/auth/authSlice';\nimport { isFixedWidthSelector } from 'features/options/optionsSelectors';\nimport useInitializeAuth from 'features/auth/hooks/useInitializeAuth';\nimport useFetchChatData from 'features/chat/hooks/useFetchChatData';\nimport useCurrentChannel from 'features/chat/hooks/useCurrentChannel';\nimport useTwitchClient from 'features/chat/hooks/useTwitchClient';\nimport useChatInput from 'features/chat/hooks/useChatInput';\nimport {\n  currentChannelSelector,\n  isConnectedSelector,\n} from 'features/chat/selectors';\nimport ChatInput from 'features/chat/components/ChatInput';\nimport ChatControls from 'features/chat/components/ChatControls';\nimport Messages from 'features/chat/components/Messages';\nimport JoinChannel from 'features/chat/components/JoinChannel';\n\nconst ChatRoot = styled.div`\n  height: 100vh;\n  font-size: 12px;\n  background-color: #0e0e10;\n`;\nconst ChatWrapper = styled.div<{ isFixedWidth: boolean }>`\n  display: flex;\n  flex-direction: column;\n  width: ${(p) => (p.isFixedWidth ? '340px' : 'auto')};\n  height: 100%;\n  background-color: #18181b;\n`;\n\nconst Chat = () => {\n  const [text, setText] = useState('');\n\n  const client = useTwitchClient();\n\n  useInitializeAuth();\n  useCurrentChannel();\n  useFetchChatData();\n\n  const currentChannel = useSelector(currentChannelSelector);\n\n  const isAuth = useSelector(isAuthSelector);\n  const isConnected = useSelector(isConnectedSelector);\n\n  const isFixedWidth = useSelector(isFixedWidthSelector);\n  const chatInputRef = useRef<HTMLTextAreaElement>(null);\n\n  const textRef = useRef(text);\n  textRef.current = text;\n\n  const isDisabled = !isAuth || !isConnected;\n\n  const handleSendMessage = useCallback(() => {\n    if (!client || !textRef.current) return;\n\n    client.say(currentChannel, textRef.current);\n\n    setText('');\n  }, [client, currentChannel, textRef, setText]);\n\n  const chatInput = useChatInput(setText, handleSendMessage, chatInputRef);\n\n  const handleNameRightClick = useCallback(\n    (name: string) => {\n      setText((t) => `${t.trim()} @${name} `.trimLeft());\n      if (chatInputRef.current) {\n        chatInputRef.current.focus();\n      }\n    },\n    [setText, chatInputRef],\n  );\n\n  const handleEmoteClick = useCallback(\n    (name: string) => {\n      setText((t) => `${t.trim()} ${name} `.trimLeft());\n    },\n    [setText],\n  );\n\n  return (\n    <ChatRoot>\n      <ChatWrapper isFixedWidth={isFixedWidth}>\n        {currentChannel ? (\n          <Messages onNameRightClick={handleNameRightClick} />\n        ) : (\n          <JoinChannel />\n        )}\n        <ChatInput\n          ref={chatInputRef}\n          text={text}\n          suggestions={chatInput.suggestions}\n          isDisabled={isDisabled}\n          onEmoteClick={handleEmoteClick}\n          onChange={chatInput.handleChange}\n          onKeyUp={chatInput.handleKeyUp}\n          onKeyDown={chatInput.handleKeyDown}\n          onBlur={chatInput.handleBlur}\n          onSuggestionMouseEnter={chatInput.handleSuggestionMouseEnter}\n          onSuggestionClick={chatInput.handleSuggestionClick}\n        />\n        <ChatControls\n          isDisabled={isDisabled}\n          onSendMessage={handleSendMessage}\n        />\n      </ChatWrapper>\n    </ChatRoot>\n  );\n};\n\nexport default Chat;\n","import { getAuthUrl } from 'features/auth/authUtils';\n\nconst Auth = () => {\n  window.location.href = getAuthUrl();\n\n  return null;\n};\n\nexport default Auth;\n","import { useDispatch } from 'react-redux';\nimport { useHistory } from 'react-router-dom';\n\nimport {\n  LS_ACCESS_TOKEN,\n  LS_ID_TOKEN,\n  LS_USER,\n  LS_LAST_CHANNEL,\n} from 'utils/constants';\nimport { invalidateAuth } from 'features/auth/authSlice';\n\nconst Logout = () => {\n  const history = useHistory();\n  const dispatch = useDispatch();\n\n  localStorage.removeItem(LS_ACCESS_TOKEN);\n  localStorage.removeItem(LS_ID_TOKEN);\n  localStorage.removeItem(LS_USER);\n\n  dispatch(invalidateAuth());\n\n  history.push({\n    pathname: '/chat/',\n    hash: localStorage.getItem(LS_LAST_CHANNEL) || '',\n  });\n\n  return null;\n};\n\nexport default Logout;\n","import { useHistory } from 'react-router-dom';\n\nimport { LS_ACCESS_TOKEN, LS_ID_TOKEN, LS_LAST_CHANNEL } from 'utils/constants';\n\nconst AuthCallback = () => {\n  const history = useHistory();\n\n  if (!window.location.hash) return null;\n\n  const params = new URLSearchParams(window.location.hash.slice(1));\n\n  const accessToken = params.get('access_token');\n  const idToken = params.get('id_token');\n\n  if (!accessToken || !idToken) return null;\n\n  localStorage.setItem(LS_ACCESS_TOKEN, accessToken);\n  localStorage.setItem(LS_ID_TOKEN, idToken);\n\n  history.push({\n    pathname: '/chat/',\n    hash: localStorage.getItem(LS_LAST_CHANNEL) || '',\n  });\n\n  return null;\n};\n\nexport default AuthCallback;\n","import { css } from 'styled-components';\n\nexport default css`\n  * {\n    box-sizing: border-box;\n  }\n  body {\n    margin: 0;\n    font-family: Roobert, Helvetica Neue, Helvetica, Arial, sans-serif;\n  }\n`;\n","import { css } from 'styled-components';\n\nexport default css``;\n","import { css } from 'styled-components';\n\nexport default css``;\n","import { createGlobalStyle } from 'styled-components';\n\nimport common from 'styles/common';\nimport colors from 'styles/colors';\nimport vars from 'styles/vars';\n\nexport default createGlobalStyle`\n  :root {\n    ${colors};\n    ${vars};\n  }\n  ${common};\n`;\n","import React from 'react';\nimport {\n  BrowserRouter as Router,\n  Switch,\n  Route,\n  RouteComponentProps,\n} from 'react-router-dom';\n\nimport { isAuthRedirect } from 'features/auth/authUtils';\nimport Chat from 'features/chat/components/Chat';\nimport Auth from 'features/auth/Auth';\nimport Logout from 'features/auth/Logout';\nimport AuthCallback from 'features/auth/AuthCallback';\nimport GlobalStyles from 'styles';\n\nconst getHomeComponent = ({ location }: RouteComponentProps) =>\n  isAuthRedirect(location.hash) ? <AuthCallback /> : <Chat />;\n\nconst App: React.FC = () => (\n  <>\n    <Router>\n      <Switch>\n        <Route exact path=\"/chat/\" render={getHomeComponent} />\n        <Route exact path=\"/chat/auth\" component={Auth} />\n        <Route exact path=\"/chat/logout\" component={Logout} />\n      </Switch>\n    </Router>\n    <GlobalStyles />\n  </>\n);\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/,\n    ),\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nconst registerValidSW = (swUrl: string, config?: Config) => {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      // eslint-disable-next-line no-param-reassign\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.',\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch((error) => {\n      console.error('Error during service worker registration:', error);\n    });\n};\n\nconst checkValidServiceWorker = (swUrl: string, config?: Config) => {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.',\n      );\n    });\n};\n\nexport const register = (config?: Config) => {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA',\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n};\n\nexport const unregister = () => {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then((registration) => {\n      registration.unregister();\n    });\n  }\n};\n","import { combineReducers } from '@reduxjs/toolkit';\n\nimport auth from 'features/auth/authSlice';\nimport chat from 'features/chat/slice/chatSlice';\nimport options from 'features/options/optionsSlice';\n\nconst rootReducer = combineReducers({\n  auth,\n  chat,\n  options,\n});\n\nexport type RootState = ReturnType<typeof rootReducer>;\n\nexport default rootReducer;\n","import { configureStore, Action } from '@reduxjs/toolkit';\n// eslint-disable-next-line import/no-extraneous-dependencies\nimport { ThunkAction } from 'redux-thunk';\n\nimport rootReducer, { RootState } from 'app/rootReducer';\n\nconst store = configureStore({\n  reducer: rootReducer,\n});\n\nif (process.env.NODE_ENV === 'development' && (module as any).hot) {\n  (module as any).hot.accept('./rootReducer', () => {\n    // eslint-disable-next-line global-require\n    const newRootReducer = require('./rootReducer').default;\n    store.replaceReducer(newRootReducer);\n  });\n}\n\nexport type AppDispatch = typeof store.dispatch;\n\nexport type AppThunk = ThunkAction<void, RootState, null, Action<string>>;\n\nexport default store;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { Provider } from 'react-redux';\nimport ReactGA from 'react-ga';\n\nimport * as serviceWorker from 'serviceWorker';\nimport { isAuthRedirect } from 'features/auth/authUtils';\nimport store from 'app/store';\n\nif (process.env.NODE_ENV === 'production') {\n  ReactGA.initialize('UA-139550930-3');\n\n  if (!isAuthRedirect(window.location.hash)) {\n    const page =\n      window.location.pathname + window.location.search + window.location.hash;\n    ReactGA.pageview(page);\n  }\n}\n\nconst render = () => {\n  // eslint-disable-next-line global-require\n  const App = require('./app/App').default;\n\n  ReactDOM.render(\n    <Provider store={store}>\n      <App />\n    </Provider>,\n    document.getElementById('root'),\n  );\n};\n\nrender();\n\nif (process.env.NODE_ENV === 'development' && (module as any).hot) {\n  (module as any).hot.accept('./app/App', render);\n}\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.register();\n","import * as R from 'ramda';\nimport { parse as twemojiParser } from 'twemoji-parser';\nimport { lib as emojilib } from 'emojilib';\nimport urlRegex from 'url-regex';\nimport twitchIrc from 'twitch-simple-irc';\n\nimport { StateEmotes } from 'features/chat/selectors/chatSelectors';\nimport { MessageEntity } from 'features/chat/slice/messages';\nimport * as htmlEntity from 'features/chat/utils/htmlEntity';\nimport findEmote from 'features/chat/utils/findEmote';\n\nconst mentionRegex = /^@([\\p{Letter}\\p{Number}_]+)/u;\nconst linkRegex = urlRegex({ strict: false });\n\nconst normalizeEmbeddedEmotes = (embeddedEmotes: twitchIrc.Emotes) =>\n  Object.entries(embeddedEmotes).reduce((result, [key, items]) => {\n    const id = Number.parseInt(key, 10);\n\n    return {\n      ...result,\n      ...items.reduce((acc, { start }) => ({ ...acc, [start]: id }), {}),\n    };\n  }, {} as Record<string, number>);\n\nconst findEmojiByName = (char: string) =>\n  R.pipe<any, any, any, string | undefined>(\n    R.filter(R.propEq('char', char)),\n    R.keys,\n    R.head,\n  )(emojilib);\n\nconst findEntity = (\n  word: string,\n  emotes: StateEmotes,\n  parseTwitch: boolean,\n):\n  | htmlEntity.TwitchEmote\n  | htmlEntity.BttvEmote\n  | htmlEntity.FfzEmote\n  | htmlEntity.Emoji\n  | [htmlEntity.Mention, number]\n  | htmlEntity.Link\n  | null => {\n  if (!emotes) return null;\n\n  if (parseTwitch) {\n    const twitchEmote = findEmote.twitch.byName(word, emotes);\n\n    if (twitchEmote) return twitchEmote;\n  }\n\n  const emote =\n    findEmote.bttv.byName(word, emotes) || findEmote.ffz.byName(word, emotes);\n\n  if (emote) return emote;\n\n  // Don't parse two or more emotes without spaces between\n  // Don't parse emote if it's not in the emojilib package\n  const emojiMatch = twemojiParser(word, { assetType: 'png' });\n\n  if (\n    emojiMatch &&\n    emojiMatch.length === 1 &&\n    emojiMatch[0].text.length === word.length\n  ) {\n    const emoji = findEmojiByName(word);\n\n    if (emoji) {\n      const [{ url }] = emojiMatch;\n\n      return htmlEntity.createEmoji(emoji, url);\n    }\n  }\n\n  const mentionMatch = word.match(mentionRegex);\n\n  if (mentionMatch) {\n    const [text, target] = mentionMatch;\n\n    return [\n      htmlEntity.createMention(text, target.toLowerCase()),\n      word.length - text.length,\n    ] as [htmlEntity.Mention, number];\n  }\n\n  const linkMatch = word.match(linkRegex);\n\n  if (linkMatch && linkMatch[0].length === word.length) {\n    return htmlEntity.createLink(word);\n  }\n\n  return null;\n};\n\nconst parseMessageEntities = (\n  message: string,\n  emotes: StateEmotes | null,\n  embeddedEmotes: twitchIrc.Emotes | null,\n  isOwnMessage = false,\n): MessageEntity[] => {\n  // If the message was sent by the current user, there is no embedded emotes\n  // So we need to parse twitch emotes manually\n\n  const result = [];\n  let offset = 0;\n  // Before that offset all content was added to the result array\n  let arrayOffset = 0;\n\n  // Check every word. From offset to the next space index\n  do {\n    const spaceIndex = message.indexOf(' ', offset + 1);\n\n    const isStart = offset === 0;\n    const isEnd = spaceIndex === -1;\n\n    const startIndex = isStart ? offset : offset + 1;\n    const endIndex = isEnd ? message.length : spaceIndex;\n\n    const word = message.substring(startIndex, endIndex);\n\n    if (word) {\n      let entity = null;\n\n      // Check embedded twitch emotes\n      if (\n        !isOwnMessage &&\n        embeddedEmotes &&\n        Object.keys(embeddedEmotes).length > 0\n      ) {\n        const normalizedEmotes = normalizeEmbeddedEmotes(embeddedEmotes);\n        const id = normalizedEmotes[startIndex];\n\n        if (id) {\n          entity = htmlEntity.createTwitchEmote({ id, code: word });\n        }\n      }\n\n      // Check other entities\n      if (!entity) {\n        entity = findEntity(word, emotes, isOwnMessage);\n      }\n\n      if (entity) {\n        // Push all text before this entity\n        if (arrayOffset !== startIndex) {\n          const textBefore = message.substring(arrayOffset, startIndex);\n          result.push(textBefore);\n        }\n\n        // If entity it's an array it means entity may be not full word\n        // The second element is the difference between word length and entity length\n        if (Array.isArray(entity)) {\n          const [entityObject, difference] = entity;\n          result.push(entityObject);\n          arrayOffset = endIndex - difference;\n        } else {\n          result.push(entity);\n          arrayOffset = endIndex;\n        }\n      }\n    }\n\n    // If it's the last word and it wasn't added to the result add it now\n    if (spaceIndex === -1 && arrayOffset !== endIndex) {\n      const textAfter = message.substring(arrayOffset, endIndex);\n      result.push(textAfter);\n    }\n\n    offset = spaceIndex;\n  } while (offset !== -1);\n\n  return result;\n};\n\nexport default parseMessageEntities;\n","import { v4 as uuid } from 'uuid';\nimport * as twitchIrc from 'twitch-simple-irc';\nimport * as tekko from 'tekko';\n\nimport type * as api from 'api';\nimport type { RootState } from 'app/rootReducer';\nimport type {\n  Message,\n  Notice,\n  UserNotice,\n  OwnMessage,\n} from 'features/chat/slice/messages';\nimport type { ChatState } from 'features/chat/slice';\nimport {\n  blockedUsersSelector,\n  globalBadgesSelector,\n  channelBadgesSelector,\n  emotesSelector,\n} from 'features/chat/selectors';\nimport type { StateEmotes } from 'features/chat/selectors';\nimport parseMessageEntities from 'features/chat/utils/parseMessageEntities';\nimport * as htmlEntity from 'features/chat/utils/htmlEntity';\nimport { writeEmotesUsageStatistic } from 'features/chat/utils/emotesUsageStatistic';\n\nexport const normalizeMessage = (\n  { message, tags, user, channel, isAction }: twitchIrc.MessageEvent,\n  chatState: ChatState,\n): Message | null => {\n  const fakeState = { chat: chatState } as RootState;\n  const blockedUsers = blockedUsersSelector(fakeState);\n\n  if (blockedUsers.includes(user)) return null;\n\n  const globalBadges = globalBadgesSelector(fakeState);\n  const channelBadges = channelBadgesSelector(fakeState);\n  const emotes = emotesSelector(fakeState);\n\n  return {\n    type: 'message',\n    id: tags.id,\n    message,\n    channel,\n    entities: parseMessageEntities(message, emotes, tags.emotes),\n    user: {\n      id: tags.userId,\n      login: user,\n      displayName: tags.displayName,\n      color: tags.color,\n      badges: htmlEntity.createBadges(tags.badges, globalBadges, channelBadges),\n    },\n    timestamp: tags.tmiSentTs,\n    isAction,\n    isHistory: false,\n    isDeleted: false,\n  };\n};\n\nexport const normalizeNotice = (\n  { message, channel, tags: { msgId } }: twitchIrc.NoticeEvent,\n  id: string,\n): Notice => ({\n  type: 'notice',\n  id,\n  message,\n  channel,\n  noticeType: msgId,\n});\n\nexport const normalizeUserNotice = ({\n  message,\n  channel,\n  tags: { id, msgId, login, systemMsg },\n}: twitchIrc.UserNoticeEvent): UserNotice => ({\n  type: 'user-notice',\n  id,\n  message,\n  channel,\n  noticeType: msgId,\n  systemMessage: systemMsg,\n  user: {\n    login,\n  },\n});\n\nexport const normalizeOwnMessage = (\n  { message, channel, tags, userId, userLogin }: OwnMessage,\n  chatState: ChatState,\n): Message => {\n  const fakeState = { chat: chatState } as RootState;\n  const globalBadges = globalBadgesSelector(fakeState);\n  const channelBadges = channelBadgesSelector(fakeState);\n  const emotes = emotesSelector(fakeState);\n\n  const isAction = message.startsWith('/me ');\n  const normalizedMessage = isAction ? message.slice(4) : message;\n\n  const entities = parseMessageEntities(normalizedMessage, emotes, null, true);\n  writeEmotesUsageStatistic(entities);\n\n  return {\n    type: 'message',\n    id: uuid(),\n    message: normalizedMessage,\n    channel,\n    entities,\n    user: {\n      id: userId as string,\n      login: userLogin as string,\n      displayName: tags.displayName,\n      color: tags.color,\n      badges: htmlEntity.createBadges(tags.badges, globalBadges, channelBadges),\n    },\n    timestamp: Date.now(),\n    isAction,\n    isHistory: false,\n    isDeleted: false,\n  };\n};\n\nexport const normalizeHistoryMessage = (\n  { tags, params: [channel, message], prefix }: tekko.Message,\n  emotes: StateEmotes,\n  globalBadges: Record<string, api.TwitchBadge>,\n  channelBadges: Record<string, api.TwitchBadge>,\n): Message => {\n  const isAction = twitchIrc.getIsAction(message);\n  const normalizedMessage = isAction\n    ? twitchIrc.normalizeActionMessage(message)\n    : message;\n  const parsedTags = (twitchIrc.parseMessageTags(\n    tags,\n  ) as unknown) as twitchIrc.MessageTags;\n\n  return {\n    type: 'message',\n    id: parsedTags.id,\n    message,\n    channel: channel.slice(1),\n    entities: parseMessageEntities(\n      normalizedMessage,\n      emotes,\n      parsedTags.emotes,\n    ),\n    user: {\n      id: parsedTags.userId,\n      login: prefix ? prefix.name : '',\n      displayName: parsedTags.displayName,\n      color: parsedTags.color,\n      badges: htmlEntity.createBadges(\n        parsedTags.badges,\n        globalBadges,\n        channelBadges,\n      ),\n    },\n    timestamp: parsedTags.tmiSentTs,\n    isAction,\n    isHistory: true,\n    isDeleted: false,\n  };\n};\n\nexport const normalizeHistoryMessages = (\n  rawMessages: string[],\n  chatState: ChatState,\n): Message[] => {\n  const fakeState = { chat: chatState } as RootState;\n  const globalBadges = globalBadgesSelector(fakeState);\n  const channelBadges = channelBadgesSelector(fakeState);\n  const emotes = emotesSelector(fakeState);\n  const blockedUsers = blockedUsersSelector(fakeState);\n\n  return rawMessages.reduce<Message[]>((acc, rawMessage) => {\n    const message = tekko.parse(rawMessage) as tekko.Message;\n\n    const { command, prefix } = message;\n\n    if (\n      command === 'PRIVMSG' &&\n      prefix &&\n      !blockedUsers.includes(prefix.name)\n    ) {\n      acc.push(\n        normalizeHistoryMessage(message, emotes, globalBadges, channelBadges),\n      );\n    }\n\n    return acc;\n  }, []);\n};\n","/* eslint-disable no-param-reassign */\nimport { createAsyncThunk } from '@reduxjs/toolkit';\nimport type { PayloadAction, ActionReducerMapBuilder } from '@reduxjs/toolkit';\nimport type twitchIrc from 'twitch-simple-irc';\n\nimport * as api from 'api';\nimport { CHANNEL_MESSAGES_LIMIT, STORE_USERS_LIMIT } from 'utils/constants';\nimport assertNever from 'utils/assertNever';\nimport * as htmlEntity from 'features/chat/utils/htmlEntity';\nimport {\n  normalizeMessage,\n  normalizeNotice,\n  normalizeUserNotice,\n  normalizeHistoryMessages,\n  normalizeOwnMessage,\n} from 'features/chat/utils/normalizeMessages';\nimport type { ChatState } from 'features/chat/slice';\nimport type { FetchResult } from 'utils/types';\n\nexport type MessageEntity =\n  | htmlEntity.TwitchEmote\n  | htmlEntity.BttvEmote\n  | htmlEntity.FfzEmote\n  | htmlEntity.Emoji\n  | htmlEntity.Mention\n  | htmlEntity.Link\n  | string;\n\nexport type Message = {\n  type: 'message';\n  id: string;\n  message: string;\n  channel: string;\n  entities: MessageEntity[];\n  user: {\n    id: string;\n    login: string;\n    displayName: string;\n    color: string;\n    badges: htmlEntity.Badge[];\n  };\n  timestamp: number;\n  isAction: boolean;\n  isHistory: boolean;\n  isDeleted: boolean;\n};\n\nexport type Notice = {\n  type: 'notice';\n  id: string;\n  message: string;\n  channel: string;\n  noticeType: string;\n};\n\nexport type UserNotice = {\n  type: 'user-notice';\n  id: string;\n  message: string;\n  channel: string;\n  noticeType: keyof typeof twitchIrc.UserNoticeType;\n  systemMessage: string;\n  user: {\n    login: string;\n  };\n};\n\nexport type ChatMessage = Message | Notice | UserNotice;\n\nexport type OwnMessage = {\n  message: string;\n  channel: string;\n  tags: twitchIrc.UserStateTags;\n  userId?: string;\n  userLogin?: string;\n};\n\ntype AddMessage = {\n  type: 'message';\n  message: twitchIrc.MessageEvent;\n};\ntype AddNotice = {\n  type: 'notice';\n  id: string;\n  message: twitchIrc.NoticeEvent;\n};\ntype AddUserNotice = {\n  type: 'user-notice';\n  message: twitchIrc.UserNoticeEvent;\n};\ntype AddOwnMessage = {\n  type: 'own-message';\n  message: OwnMessage;\n};\n\ntype AddMessagePayload = AddMessage | AddNotice | AddUserNotice | AddOwnMessage;\n\ntype MessagesStateChannel = {\n  history: FetchResult<string[]> & {\n    isAdded: boolean;\n  };\n  isEven: boolean;\n  items: ChatMessage[];\n  users: string[];\n};\n\nexport type MessagesState = Record<string, MessagesStateChannel>;\n\nexport const messagesInitialState: MessagesState = {};\n\nfunction sliceMessages<T>(items: T[]): T[] {\n  const diff = items.length - CHANNEL_MESSAGES_LIMIT;\n\n  return diff > 0 ? items.slice(diff) : items;\n}\n\nfunction sliceUsers<T>(users: T[]): T[] {\n  const diff = users.length - STORE_USERS_LIMIT;\n\n  return diff > 0 ? users.slice(diff) : users;\n}\n\nconst getIsEven = (\n  prev: boolean,\n  addedItemsCount: number,\n  isSliced: boolean,\n): boolean => {\n  if (isSliced) {\n    return addedItemsCount % 2 ? !prev : prev;\n  }\n\n  return prev;\n};\n\nconst normalizePayload = (\n  data: AddMessagePayload,\n  chatState: ChatState,\n): ChatMessage | null => {\n  if (data.type === 'message') {\n    return normalizeMessage(data.message, chatState);\n  }\n\n  if (data.type === 'notice') {\n    return normalizeNotice(data.message, data.id);\n  }\n\n  if (data.type === 'user-notice') {\n    return normalizeUserNotice(data.message);\n  }\n\n  if (data.type === 'own-message') {\n    return normalizeOwnMessage(data.message, chatState);\n  }\n\n  return assertNever(data);\n};\n\nexport const messagesReducers = {\n  clearChat: (\n    state: ChatState,\n    { payload }: PayloadAction<twitchIrc.ClearChatEvent>,\n  ) => {\n    const {\n      channel,\n      tags: { targetUserId },\n    } = payload;\n\n    // eslint-disable-next-line no-restricted-syntax\n    for (const message of state.messages[channel].items) {\n      if (\n        message.type === 'message' &&\n        message.user.id === targetUserId &&\n        !message.isHistory\n      ) {\n        message.isDeleted = true;\n      }\n    }\n  },\n\n  addMessage: (\n    state: ChatState,\n    { payload }: PayloadAction<AddMessagePayload>,\n  ) => {\n    const message = normalizePayload(payload, state);\n\n    if (!message) return;\n\n    const { channel } = message;\n\n    const prevItems = state.messages[channel].items;\n    const newItems = [...prevItems, message];\n    const slicedMessages = sliceMessages(newItems);\n\n    const isSliced = newItems.length > slicedMessages.length;\n    const prevIsEven = state.messages[channel].isEven;\n\n    state.messages[channel].isEven = getIsEven(prevIsEven, 1, isSliced);\n    state.messages[channel].items = slicedMessages;\n\n    // add user\n    const { users } = state.messages[channel];\n\n    if (\n      message.type === 'message' &&\n      !users.includes(message.user.displayName)\n    ) {\n      users.push(message.user.displayName);\n    }\n\n    state.messages[channel].users = sliceUsers(users);\n  },\n\n  addChatHistory: (state: ChatState, { payload }: PayloadAction<string>) => {\n    const channel = payload;\n\n    const rawHistory = state.messages[channel].history.items;\n    const history = normalizeHistoryMessages(sliceMessages(rawHistory), state);\n    const prevItems = state.messages[channel].items;\n    const newItems = [...history, ...prevItems];\n    const slicedMessages = sliceMessages(newItems);\n\n    const isSliced = newItems.length > slicedMessages.length;\n    const prevIsEven = state.messages[channel].isEven;\n\n    state.messages[channel].isEven = getIsEven(\n      prevIsEven,\n      history.length,\n      isSliced,\n    );\n    state.messages[channel].items = slicedMessages;\n\n    // add users\n    const { users } = state.messages[channel];\n\n    history.forEach((message) => {\n      if (\n        message.type === 'message' &&\n        !users.includes(message.user.displayName)\n      ) {\n        users.push(message.user.displayName);\n      }\n    });\n\n    state.messages[channel].history.items = [];\n    state.messages[channel].history.isAdded = true;\n  },\n};\n\nexport const fetchChatHistory = createAsyncThunk(\n  'chat/fetchChatHistory',\n  (channel: string) => api.fetchChatHistory(channel),\n);\n\nexport const messagesExtraReducers = (\n  builder: ActionReducerMapBuilder<ChatState>,\n) => {\n  builder.addCase(fetchChatHistory.pending, (state, { meta: { arg } }) => {\n    const channel = arg;\n\n    if (!state.messages[channel]) {\n      state.messages[channel] = {\n        history: {\n          status: 'loading',\n          error: {},\n          items: [],\n          isAdded: false,\n        },\n        isEven: false,\n        items: [],\n        users: [],\n      };\n    } else {\n      state.messages[channel].history.status = 'loading';\n      state.messages[channel].history.error = {};\n    }\n  });\n\n  builder.addCase(\n    fetchChatHistory.fulfilled,\n    (state, { payload, meta: { arg } }) => {\n      const channel = arg;\n\n      state.messages[channel].history.status = 'success';\n      state.messages[channel].history.items = payload.messages;\n    },\n  );\n\n  builder.addCase(\n    fetchChatHistory.rejected,\n    (state, { error, meta: { arg } }) => {\n      const channel = arg;\n\n      state.messages[channel].history.status = 'error';\n      state.messages[channel].history.error = error;\n    },\n  );\n};\n","import * as R from 'ramda';\n\nimport * as api from 'api';\n\nexport const parseTwitchEmotes = R.prop('emoticon_sets');\n\nexport const parseBttvGlobalEmotes = (\n  data: api.BttvGlobalEmotesResponse,\n): api.BttvGlobalEmote[] => data;\n\nexport const parseBttvChannelEmotes = (\n  data: api.BttvChannelEmotesResponse,\n): api.BttvChannelEmote[] => [...data.channelEmotes, ...data.sharedEmotes];\n\nexport const parseFfzGlobalEmotes = ({\n  default_sets: defaultSets,\n  sets,\n}: api.FfzGlobalEmotesResponse): api.FfzEmote[] =>\n  R.pipe<any, any, any, any, api.FfzEmote[]>(\n    R.pick((defaultSets as unknown) as string[]),\n    R.values,\n    R.map(R.propOr([], 'emoticons')),\n    R.flatten,\n  )(sets);\n\nexport const parseFfzChannelEmotes: (\n  data: api.FfzChannelEmotesResponse,\n) => api.FfzEmote[] = R.pipe(\n  R.pathOr({}, ['sets']),\n  R.values,\n  R.map(R.pathOr([], ['emoticons'])),\n  R.flatten,\n);\n\nexport const parseBlockedUsers = R.pipe<\n  api.TwitchBlockedUsersResponse,\n  {}[],\n  string[]\n>(R.prop('blocks'), R.map<any, any>(R.path(['user', 'name'])));\n\nexport const parseBadges = R.prop('badge_sets');\n","/* eslint-disable no-param-reassign */\nimport { createAsyncThunk } from '@reduxjs/toolkit';\nimport type { ActionReducerMapBuilder } from '@reduxjs/toolkit';\n\nimport * as api from 'api';\nimport type { ChatState } from 'features/chat/slice';\nimport { parseTwitchEmotes } from 'features/chat/utils/parseApiResponse';\nimport type { FetchResult } from 'utils/types';\n\nexport type TwitchEmotesState = FetchResult<Record<string, api.TwitchEmote[]>>;\n\nexport const twitchEmotesInitialState: TwitchEmotesState = {\n  status: 'idle',\n  error: {},\n  items: {},\n};\n\nexport const fetchTwitchEmotes = createAsyncThunk(\n  'chat/fetchTwitchEmotes',\n  (userId: string) => api.fetchTwitchEmotes(userId),\n);\n\nexport const twitchEmotesExtraReducers = (\n  builder: ActionReducerMapBuilder<ChatState>,\n) => {\n  builder.addCase(fetchTwitchEmotes.pending, (state) => {\n    state.twitchEmotes.status = 'loading';\n    state.twitchEmotes.error = {};\n  });\n\n  builder.addCase(fetchTwitchEmotes.fulfilled, (state, { payload }): void => {\n    state.twitchEmotes.status = 'success';\n    state.twitchEmotes.items = parseTwitchEmotes(payload);\n  });\n\n  builder.addCase(fetchTwitchEmotes.rejected, (state, { error }) => {\n    state.twitchEmotes.status = 'error';\n    state.twitchEmotes.error = error;\n  });\n};\n","/* eslint-disable no-param-reassign */\nimport { createAsyncThunk } from '@reduxjs/toolkit';\nimport type { ActionReducerMapBuilder } from '@reduxjs/toolkit';\n\nimport * as api from 'api';\nimport type { ChatState } from 'features/chat/slice';\nimport {\n  parseBttvGlobalEmotes,\n  parseBttvChannelEmotes,\n} from 'features/chat/utils/parseApiResponse';\nimport type { FetchResult } from 'utils/types';\n\nexport type BttvEmotesState = {\n  global: FetchResult<api.BttvGlobalEmote[]>;\n  byChannels: Record<string, FetchResult<api.BttvChannelEmote[]>>;\n};\n\nexport const bttvEmotesInitialState: BttvEmotesState = {\n  global: {\n    status: 'idle',\n    error: {},\n    items: [],\n  },\n  byChannels: {},\n};\n\nexport const fetchBttvGlobalEmotes = createAsyncThunk(\n  'chat/fetchBttvGlobalEmotes',\n  () => api.fetchBttvGlobalEmotes(),\n);\n\ntype FetchBttvChannelEmotesParams = {\n  channel: string;\n  channelId: string;\n};\n\nexport const fetchBttvChannelEmotes = createAsyncThunk(\n  'chat/fetchBttvChannelEmotes',\n  ({ channelId }: FetchBttvChannelEmotesParams) =>\n    api.fetchBttvChannelEmotes(channelId),\n);\n\nexport const bttvEmotesExtraReducers = (\n  builder: ActionReducerMapBuilder<ChatState>,\n) => {\n  builder.addCase(fetchBttvGlobalEmotes.pending, (state) => {\n    state.bttvEmotes.global.status = 'loading';\n    state.bttvEmotes.global.error = {};\n  });\n\n  builder.addCase(fetchBttvGlobalEmotes.fulfilled, (state, { payload }) => {\n    state.bttvEmotes.global.status = 'success';\n    state.bttvEmotes.global.items = parseBttvGlobalEmotes(payload);\n  });\n\n  builder.addCase(fetchBttvGlobalEmotes.rejected, (state, { error }) => {\n    state.bttvEmotes.global.status = 'error';\n    state.bttvEmotes.global.error = error;\n  });\n\n  builder.addCase(\n    fetchBttvChannelEmotes.pending,\n    (state, { meta: { arg } }) => {\n      const { channel } = arg;\n\n      if (!state.bttvEmotes.byChannels[channel]) {\n        state.bttvEmotes.byChannels[channel] = {\n          status: 'loading',\n          error: {},\n          items: [],\n        };\n      } else {\n        state.bttvEmotes.byChannels[channel].status = 'loading';\n        state.bttvEmotes.byChannels[channel].error = {};\n      }\n    },\n  );\n\n  builder.addCase(\n    fetchBttvChannelEmotes.fulfilled,\n    (state, { payload, meta: { arg } }) => {\n      const { channel } = arg;\n\n      state.bttvEmotes.byChannels[channel].status = 'success';\n      state.bttvEmotes.byChannels[channel].items = parseBttvChannelEmotes(\n        payload,\n      );\n    },\n  );\n\n  builder.addCase(\n    fetchBttvChannelEmotes.rejected,\n    (state, { error, meta: { arg } }) => {\n      const { channel } = arg;\n\n      state.bttvEmotes.byChannels[channel].status = 'error';\n      state.bttvEmotes.byChannels[channel].error = error;\n    },\n  );\n};\n","/* eslint-disable no-param-reassign */\nimport { createAsyncThunk } from '@reduxjs/toolkit';\nimport type { ActionReducerMapBuilder } from '@reduxjs/toolkit';\n\nimport * as api from 'api';\nimport type { ChatState } from 'features/chat/slice';\nimport {\n  parseFfzGlobalEmotes,\n  parseFfzChannelEmotes,\n} from 'features/chat/utils/parseApiResponse';\nimport type { FetchResult } from 'utils/types';\n\nexport type FfzEmotesState = {\n  global: FetchResult<api.FfzEmote[]>;\n  byChannels: Record<string, FetchResult<api.FfzEmote[]>>;\n};\n\nexport const ffzEmotesInitialState: FfzEmotesState = {\n  global: {\n    status: 'idle',\n    error: {},\n    items: [],\n  },\n  byChannels: {},\n};\n\nexport const fetchFfzGlobalEmotes = createAsyncThunk(\n  'chat/fetchFfzGlobalEmotes',\n  () => api.fetchFfzGlobalEmotes(),\n);\n\ntype FetchFfzChannelEmotesParams = {\n  channel: string;\n  channelId: string;\n};\n\nexport const fetchFfzChannelEmotes = createAsyncThunk(\n  'chat/fetchFfzChannelEmotes',\n  ({ channelId }: FetchFfzChannelEmotesParams) =>\n    api.fetchFfzChannelEmotes(channelId),\n);\n\nexport const ffzEmotesExtraReducers = (\n  builder: ActionReducerMapBuilder<ChatState>,\n) => {\n  builder.addCase(fetchFfzGlobalEmotes.pending, (state) => {\n    state.ffzEmotes.global.status = 'loading';\n    state.ffzEmotes.global.error = {};\n  });\n\n  builder.addCase(fetchFfzGlobalEmotes.fulfilled, (state, { payload }) => {\n    state.ffzEmotes.global.status = 'success';\n    state.ffzEmotes.global.items = parseFfzGlobalEmotes(payload);\n  });\n\n  builder.addCase(fetchFfzGlobalEmotes.rejected, (state, { error }) => {\n    state.ffzEmotes.global.status = 'error';\n    state.ffzEmotes.global.error = error;\n  });\n\n  builder.addCase(fetchFfzChannelEmotes.pending, (state, { meta: { arg } }) => {\n    const { channel } = arg;\n\n    if (!state.ffzEmotes.byChannels[channel]) {\n      state.ffzEmotes.byChannels[channel] = {\n        status: 'loading',\n        error: {},\n        items: [],\n      };\n    } else {\n      state.ffzEmotes.byChannels[channel].status = 'loading';\n      state.ffzEmotes.byChannels[channel].error = {};\n    }\n  });\n\n  builder.addCase(\n    fetchFfzChannelEmotes.fulfilled,\n    (state, { payload, meta: { arg } }) => {\n      const { channel } = arg;\n\n      state.ffzEmotes.byChannels[channel].status = 'success';\n      state.ffzEmotes.byChannels[channel].items = parseFfzChannelEmotes(\n        payload,\n      );\n    },\n  );\n\n  builder.addCase(\n    fetchFfzChannelEmotes.rejected,\n    (state, { error, meta: { arg } }) => {\n      const { channel } = arg;\n\n      state.ffzEmotes.byChannels[channel].status = 'error';\n      state.ffzEmotes.byChannels[channel].error = error;\n    },\n  );\n};\n","/* eslint-disable no-param-reassign */\nimport { createAsyncThunk, ActionReducerMapBuilder } from '@reduxjs/toolkit';\n\nimport * as api from 'api';\nimport { FetchResult } from 'utils/types';\nimport type { ChatState } from 'features/chat/slice';\nimport { parseBadges } from 'features/chat/utils/parseApiResponse';\n\ntype Badges = Record<string, api.TwitchBadge>;\n\nexport type BadgesState = {\n  global: FetchResult<Badges>;\n  byChannels: Record<string, FetchResult<Badges>>;\n};\n\nexport const badgesInitialState: BadgesState = {\n  global: {\n    status: 'idle',\n    error: {},\n    items: {},\n  },\n  byChannels: {},\n};\n\nexport const fetchGlobalBadges = createAsyncThunk(\n  'chat/fetchGlobalBadges',\n  () => api.fetchGlobalBadges(),\n);\n\ntype FetchChannelBadgesParams = {\n  channel: string;\n  channelId: string;\n};\n\nexport const fetchChannelBadges = createAsyncThunk(\n  'chat/fetchChannelBadges',\n  ({ channelId }: FetchChannelBadgesParams) =>\n    api.fetchChannelBadges(channelId),\n);\n\nexport const badgesExtraReducers = (\n  builder: ActionReducerMapBuilder<ChatState>,\n) => {\n  builder.addCase(fetchGlobalBadges.pending, (state) => {\n    state.badges.global.status = 'loading';\n    state.badges.global.error = {};\n  });\n\n  builder.addCase(fetchGlobalBadges.fulfilled, (state, { payload }) => {\n    state.badges.global.status = 'success';\n    state.badges.global.items = parseBadges(payload);\n  });\n\n  builder.addCase(fetchGlobalBadges.rejected, (state, { error }) => {\n    state.badges.global.status = 'error';\n    state.badges.global.error = error;\n  });\n\n  builder.addCase(fetchChannelBadges.pending, (state, { meta: { arg } }) => {\n    const { channel } = arg;\n\n    if (!state.badges.byChannels[channel]) {\n      state.badges.byChannels[channel] = {\n        status: 'loading',\n        error: {},\n        items: {},\n      };\n    } else {\n      state.badges.byChannels[channel].status = 'loading';\n      state.badges.byChannels[channel].error = {};\n    }\n  });\n\n  builder.addCase(\n    fetchChannelBadges.fulfilled,\n    (state, { payload, meta: { arg } }) => {\n      const { channel } = arg;\n\n      state.badges.byChannels[channel].status = 'success';\n      state.badges.byChannels[channel].items = parseBadges(payload);\n    },\n  );\n\n  builder.addCase(\n    fetchChannelBadges.rejected,\n    (state, { error, meta: { arg } }) => {\n      const { channel } = arg;\n\n      state.badges.byChannels[channel].status = 'error';\n      state.badges.byChannels[channel].error = error;\n    },\n  );\n};\n","/* eslint-disable no-param-reassign */\nimport { createAsyncThunk } from '@reduxjs/toolkit';\nimport type { ActionReducerMapBuilder } from '@reduxjs/toolkit';\n\nimport * as api from 'api';\nimport type { FetchResult } from 'utils/types';\nimport type { ChatState } from 'features/chat/slice';\nimport { parseBlockedUsers } from 'features/chat/utils/parseApiResponse';\n\nexport type BlockedUsersState = FetchResult<string[]>;\n\nexport const blockedUsersInitialState: BlockedUsersState = {\n  status: 'idle',\n  error: {},\n  items: [],\n};\n\nexport const fetchBlockedUsers = createAsyncThunk(\n  'chat/fetchBlockedUsers',\n  (userId: string) => api.fetchBlockedUsers(userId),\n);\n\nexport const blockedUsersExtraReducers = (\n  builder: ActionReducerMapBuilder<ChatState>,\n) => {\n  builder.addCase(fetchBlockedUsers.pending, (state) => {\n    state.blockedUsers.status = 'loading';\n    state.blockedUsers.error = {};\n  });\n\n  builder.addCase(fetchBlockedUsers.fulfilled, (state, { payload }): void => {\n    state.blockedUsers.status = 'success';\n    state.blockedUsers.items = parseBlockedUsers(payload);\n  });\n\n  builder.addCase(fetchBlockedUsers.rejected, (state, { error }): void => {\n    state.blockedUsers.status = 'error';\n    state.blockedUsers.error = error;\n  });\n};\n","/* eslint-disable no-param-reassign */\nimport { createSlice, PayloadAction } from '@reduxjs/toolkit';\n\nimport {\n  messagesInitialState,\n  messagesReducers,\n  messagesExtraReducers,\n  MessagesState,\n} from 'features/chat/slice/messages';\nimport {\n  twitchEmotesInitialState,\n  twitchEmotesExtraReducers,\n  TwitchEmotesState,\n} from 'features/chat/slice/twitchEmotes';\nimport {\n  bttvEmotesInitialState,\n  bttvEmotesExtraReducers,\n  BttvEmotesState,\n} from 'features/chat/slice/bttvEmotes';\nimport {\n  ffzEmotesInitialState,\n  ffzEmotesExtraReducers,\n  FfzEmotesState,\n} from 'features/chat/slice/ffzEmotes';\nimport {\n  badgesInitialState,\n  badgesExtraReducers,\n  BadgesState,\n} from 'features/chat/slice/badges';\nimport {\n  paramsInitialState,\n  paramsReducers,\n  ParamsState,\n} from 'features/chat/slice/params';\nimport {\n  blockedUsersInitialState,\n  blockedUsersExtraReducers,\n  BlockedUsersState,\n} from 'features/chat/slice/blockedUsers';\n\nexport { fetchChatHistory } from 'features/chat/slice/messages';\nexport { fetchTwitchEmotes } from 'features/chat/slice/twitchEmotes';\nexport {\n  fetchBttvGlobalEmotes,\n  fetchBttvChannelEmotes,\n} from 'features/chat/slice/bttvEmotes';\nexport {\n  fetchFfzGlobalEmotes,\n  fetchFfzChannelEmotes,\n} from 'features/chat/slice/ffzEmotes';\nexport {\n  fetchGlobalBadges,\n  fetchChannelBadges,\n} from 'features/chat/slice/badges';\nexport { fetchBlockedUsers } from 'features/chat/slice/blockedUsers';\n\nexport type ChatState = {\n  isConnected: boolean;\n  currentChannel: string;\n  messages: MessagesState;\n  twitchEmotes: TwitchEmotesState;\n  bttvEmotes: BttvEmotesState;\n  ffzEmotes: FfzEmotesState;\n  badges: BadgesState;\n  params: ParamsState;\n  blockedUsers: BlockedUsersState;\n};\n\nconst initialState: ChatState = {\n  isConnected: false,\n  currentChannel: '',\n  messages: messagesInitialState,\n  twitchEmotes: twitchEmotesInitialState,\n  bttvEmotes: bttvEmotesInitialState,\n  ffzEmotes: ffzEmotesInitialState,\n  badges: badgesInitialState,\n  params: paramsInitialState,\n  blockedUsers: blockedUsersInitialState,\n};\n\nconst chat = createSlice({\n  name: 'chat',\n  initialState,\n  reducers: {\n    updateIsConnected: (state, { payload }: PayloadAction<boolean>): void => {\n      state.isConnected = payload;\n    },\n    updateCurrentChannel: (state, { payload }: PayloadAction<string>): void => {\n      state.currentChannel = payload;\n    },\n\n    ...messagesReducers,\n    ...paramsReducers,\n  },\n  extraReducers: (builder) => {\n    messagesExtraReducers(builder);\n    twitchEmotesExtraReducers(builder);\n    bttvEmotesExtraReducers(builder);\n    ffzEmotesExtraReducers(builder);\n    badgesExtraReducers(builder);\n    blockedUsersExtraReducers(builder);\n  },\n});\n\nexport const {\n  updateIsConnected,\n  updateCurrentChannel,\n\n  // messages\n  clearChat,\n  addMessage,\n  addChatHistory,\n\n  // params\n  updateGlobalUserParams,\n  updateUserParams,\n  updateRoomParams,\n} = chat.actions;\n\nexport default chat.reducer;\n","/* eslint-disable no-param-reassign */\nimport type { PayloadAction } from '@reduxjs/toolkit';\nimport type twitchIrc from 'twitch-simple-irc';\n\nimport type { ChatState } from 'features/chat/slice';\n\ntype Params = {\n  room: twitchIrc.RoomStateTags | null;\n  user: twitchIrc.UserStateTags | null;\n};\n\nexport type ParamsState = {\n  global: twitchIrc.GlobalUserStateTags | null;\n  byChannels: Record<string, Params>;\n};\n\nexport const paramsInitialState: ParamsState = {\n  global: null,\n  byChannels: {},\n};\n\nexport const paramsReducers = {\n  updateGlobalUserParams: (\n    state: ChatState,\n    { payload }: PayloadAction<twitchIrc.GlobalUserStateEvent>,\n  ): void => {\n    state.params.global = payload.tags;\n  },\n\n  updateUserParams: (\n    state: ChatState,\n    { payload }: PayloadAction<twitchIrc.UserStateEvent>,\n  ): void => {\n    const { channel, tags } = payload;\n\n    if (!state.params.byChannels[channel]) {\n      state.params.byChannels[channel] = {\n        room: null,\n        user: null,\n      };\n    }\n\n    state.params.byChannels[channel].user = tags;\n  },\n\n  updateRoomParams: (\n    state: ChatState,\n    { payload }: PayloadAction<twitchIrc.RoomStateEvent>,\n  ): void => {\n    const { channel, tags } = payload;\n\n    if (!state.params.byChannels[channel]) {\n      state.params.byChannels[channel] = {\n        room: null,\n        user: null,\n      };\n    }\n\n    // TODO: merge tags\n    state.params.byChannels[channel].room = tags;\n  },\n};\n","import tls from 'tls';\nimport { Socket } from 'net';\nimport { EventEmitter } from 'events';\nimport * as tekko from 'tekko';\n\nimport {\n  TekkoMessage,\n  MessageEvent,\n  GlobalUserStateEvent,\n  GlobalUserStateTags,\n  UserStateEvent,\n  UserStateTags,\n  RoomStateEvent,\n  RoomStateTags,\n  ClearChatEvent,\n  ClearMessageEvent,\n  HostTargetEvent,\n  NoticeEvent,\n  UserNoticeEvent,\n  WhisperEvent,\n  JoinEvent,\n  PartEvent,\n  PingEvent,\n} from './types';\nimport { isNode, getChannelFromMessage, getRandomUsername } from './utils';\nimport {\n  normalizeChatMessage,\n  normalizeState,\n  normalizeCommand,\n  normalizeWhisper,\n  normalizeGlobalUserState,\n} from './normalize';\n\nexport enum Commands {\n  REPLY001 = '001',\n  PING = 'PING',\n  PONG = 'PONG',\n  JOIN = 'JOIN',\n  PART = 'PART',\n  PRIVMSG = 'PRIVMSG',\n  NOTICE = 'NOTICE',\n  USERNOTICE = 'USERNOTICE',\n  GLOBALUSERSTATE = 'GLOBALUSERSTATE',\n  USERSTATE = 'USERSTATE',\n  ROOMSTATE = 'ROOMSTATE',\n  CLEARCHAT = 'CLEARCHAT',\n  CLEARMSG = 'CLEARMSG',\n  HOSTTARGET = 'HOSTTARGET',\n  WHISPER = 'WHISPER',\n}\n\ninterface ClientOptions {\n  name?: string;\n  auth?: string;\n  secure?: boolean;\n}\n\ninterface Channels {\n  [channel: string]: {\n    userState: UserStateTags;\n    roomState: RoomStateTags;\n  };\n}\n\ntype Listener<T> = (data: T) => void;\n\nexport interface Client {\n  on(event: 'connect', listener: () => void): this;\n  on(event: 'disconnect', listener: (error?: Error) => void): this;\n  on(event: 'register', listener: () => void): this;\n  on(event: 'message', listener: Listener<MessageEvent>): this;\n  on(event: 'notice', listener: Listener<NoticeEvent>): this;\n  on(event: 'usernotice', listener: Listener<UserNoticeEvent>): this;\n  on(event: 'whisper', listener: Listener<WhisperEvent>): this;\n  on(event: 'globaluserstate', listener: Listener<GlobalUserStateEvent>): this;\n  on(event: 'userstate', listener: Listener<UserStateEvent>): this;\n  on(event: 'roomstate', listener: Listener<RoomStateEvent>): this;\n  on(event: 'join', listener: Listener<JoinEvent>): this;\n  on(event: 'part', listener: Listener<PartEvent>): this;\n  on(event: 'clearchat', listener: Listener<ClearChatEvent>): this;\n  on(event: 'clearmessage', listener: Listener<ClearMessageEvent>): this;\n  on(event: 'hosttarget', listener: Listener<HostTargetEvent>): this;\n  on(event: 'ping', listener: Listener<PingEvent>): this;\n  on(event: 'error', listener: (error: Error) => void): this;\n\n  emit(event: 'connect'): boolean;\n  emit(event: 'disconnect', error?: Error): boolean;\n  emit(event: 'register'): boolean;\n  emit(event: 'message', data: MessageEvent): boolean;\n  emit(event: 'notice', data: NoticeEvent): boolean;\n  emit(event: 'usernotice', data: UserNoticeEvent): boolean;\n  emit(event: 'whisper', data: WhisperEvent): boolean;\n  emit(event: 'globaluserstate', data: GlobalUserStateEvent): boolean;\n  emit(event: 'userstate', data: UserStateEvent): boolean;\n  emit(event: 'roomstate', data: RoomStateEvent): boolean;\n  emit(event: 'join', data: JoinEvent): boolean;\n  emit(event: 'part', data: PartEvent): boolean;\n  emit(event: 'clearchat', data: ClearChatEvent): boolean;\n  emit(event: 'clearmessage', data: ClearMessageEvent): boolean;\n  emit(event: 'hosttarget', data: HostTargetEvent): boolean;\n  emit(event: 'ping', data: PingEvent): boolean;\n  emit(event: 'error', error: Error): boolean;\n}\n\nexport class Client extends EventEmitter {\n  socket: WebSocket | Socket | null = null;\n\n  options: ClientOptions;\n\n  globalUserState: GlobalUserStateTags | null = null;\n\n  channels: Channels = {};\n\n  private _connected: boolean = false;\n\n  private _connecting: boolean = false;\n\n  private _registered: boolean = false;\n\n  constructor(options: ClientOptions | null | undefined = {}) {\n    super();\n    this.options = { secure: true, ...options };\n  }\n\n  async connect(): Promise<void> {\n    const connection = isNode\n      ? this._connectInNode()\n      : this._connectInBrowser();\n\n    await connection;\n\n    return this._register();\n  }\n\n  disconnect(): void {\n    if (!this._connected) return;\n\n    if (isNode) {\n      (this.socket as Socket).destroy();\n    } else {\n      (this.socket as WebSocket).close();\n    }\n\n    this.socket = null;\n    this._connected = false;\n    this._connecting = false;\n    this._registered = false;\n\n    this.emit('disconnect');\n  }\n\n  receiveRaw(rawData: string) {\n    const data = rawData.trim().split('\\r\\n');\n\n    data.forEach((line) => this._handleMessage(line));\n  }\n\n  sendRaw(message: string): boolean {\n    if (this.socket === null || !message) {\n      return false;\n    }\n\n    if (isNode) {\n      (this.socket as Socket).write(message);\n    } else {\n      (this.socket as WebSocket).send(message);\n    }\n\n    return true;\n  }\n\n  say(channel: string, message: string): boolean {\n    const ircMessage = tekko.format({\n      command: Commands.PRIVMSG,\n      middle: [`#${channel}`],\n      trailing: message,\n    });\n\n    return this.sendRaw(ircMessage);\n  }\n\n  sendCommand(\n    channel: string,\n    command: string,\n    params: string | Array<string> = '',\n  ): boolean {\n    const commandParams = Array.isArray(params) ? params.join(' ') : params;\n    const ircMessage = tekko.format({\n      command: Commands.PRIVMSG,\n      middle: [`#${channel}`],\n      trailing: `/${command} ${commandParams}`,\n    });\n\n    return this.sendRaw(ircMessage);\n  }\n\n  join(channel: string): boolean {\n    if (!this._registered) return false;\n\n    const ircMessage = tekko.format({\n      command: Commands.JOIN,\n      middle: [`#${channel}`],\n    });\n\n    return this.sendRaw(ircMessage);\n  }\n\n  part(channel: string): boolean {\n    if (!this._registered) return false;\n\n    const ircMessage = tekko.format({\n      command: Commands.PART,\n      middle: [`#${channel}`],\n    });\n\n    return this.sendRaw(ircMessage);\n  }\n\n  _handleMessage(raw: string) {\n    const data: TekkoMessage = tekko.parse(raw) as TekkoMessage;\n    data.raw = raw;\n    const { command } = data;\n\n    if (command === Commands.PING) {\n      this.sendRaw(`${Commands.PONG} :tmi.twitch.tv`);\n      this.emit('ping', { raw });\n\n      return;\n    }\n\n    if (command === Commands.REPLY001) {\n      this.options.name = data.middle[0];\n      this._registered = true;\n\n      this.emit('register');\n\n      return;\n    }\n\n    if (command === Commands.PRIVMSG) {\n      const eventData = normalizeChatMessage(data);\n\n      this.emit('message', eventData);\n\n      return;\n    }\n\n    if (command === Commands.USERSTATE) {\n      const channel = getChannelFromMessage(data);\n      const eventData = normalizeState(data) as UserStateEvent;\n\n      this._updateUserState(channel, eventData.tags);\n      this.emit('userstate', eventData);\n\n      return;\n    }\n\n    if (command === Commands.JOIN) {\n      const channel = getChannelFromMessage(data);\n      const eventData = { channel } as JoinEvent;\n\n      this.emit('join', eventData);\n\n      return;\n    }\n\n    if (command === Commands.PART) {\n      const channel = getChannelFromMessage(data);\n      const eventData = { channel } as PartEvent;\n\n      this.emit('part', eventData);\n\n      return;\n    }\n\n    if (command === Commands.ROOMSTATE) {\n      const channel = getChannelFromMessage(data);\n      const eventData = normalizeState(data) as RoomStateEvent;\n\n      this._updateRoomState(channel, eventData.tags);\n      this.emit('roomstate', eventData);\n\n      return;\n    }\n\n    if (command === Commands.NOTICE) {\n      const eventData = normalizeCommand(data) as NoticeEvent;\n\n      this.emit('notice', eventData);\n\n      return;\n    }\n\n    if (command === Commands.USERNOTICE) {\n      const eventData = (normalizeCommand(data) as unknown) as UserNoticeEvent;\n\n      this.emit('usernotice', eventData);\n\n      return;\n    }\n\n    if (command === Commands.CLEARCHAT) {\n      const eventData = normalizeCommand(data) as ClearChatEvent;\n\n      this.emit('clearchat', eventData);\n\n      return;\n    }\n\n    if (command === Commands.CLEARMSG) {\n      const eventData = normalizeCommand(data) as ClearMessageEvent;\n\n      this.emit('clearmessage', eventData);\n\n      return;\n    }\n\n    if (command === Commands.HOSTTARGET) {\n      const eventData = normalizeCommand(data) as HostTargetEvent;\n\n      this.emit('hosttarget', eventData);\n\n      return;\n    }\n\n    if (command === Commands.WHISPER) {\n      const eventData = normalizeWhisper(data);\n\n      this.emit('whisper', eventData);\n\n      return;\n    }\n\n    if (command === Commands.GLOBALUSERSTATE) {\n      const eventData = normalizeGlobalUserState(data);\n\n      this._updateGlobalUserState(eventData.tags);\n      this.emit('globaluserstate', eventData);\n\n      return;\n    }\n  }\n\n  _connectInNode(): Promise<void> {\n    const host = 'irc.chat.twitch.tv';\n    const port = this.options.secure ? 6697 : 6667;\n\n    return new Promise<void>((resolve, reject) => {\n      this._connecting = true;\n\n      const handleConnect = () => {\n        this._connecting = false;\n        this._connected = true;\n        this.emit('connect');\n        resolve();\n      };\n\n      if (this.options.secure) {\n        this.socket = tls.connect(port, host, {}, handleConnect);\n      } else {\n        this.socket = new Socket();\n        this.socket.connect(port, host, handleConnect);\n      }\n\n      this.socket.on('error', (error: Error) => {\n        this._connected = false;\n        this._connecting = false;\n        this.emit('disconnect', error);\n        reject(error);\n      });\n      this.socket.on('data', (data: Buffer) => {\n        this.receiveRaw(data.toString());\n      });\n      this.socket.on('close', () => {\n        this._connected = false;\n        this._connecting = false;\n        this._registered = false;\n        this.emit('disconnect');\n      });\n    });\n  }\n\n  _connectInBrowser(): Promise<void> {\n    const url = this.options.secure\n      ? 'wss://irc-ws.chat.twitch.tv:443'\n      : 'ws://irc-ws.chat.twitch.tv:80';\n\n    return new Promise<void>((resolve, reject) => {\n      this._connecting = true;\n      this.socket = new WebSocket(url);\n\n      this.socket.onopen = () => {\n        this._connected = true;\n        this._connecting = false;\n        this.emit('connect');\n        resolve();\n      };\n      this.socket.onmessage = ({ data }) => this.receiveRaw(data);\n      this.socket.onerror = () => {};\n      this.socket.onclose = ({ wasClean, code, reason }) => {\n        this.socket = null;\n        this._connected = false;\n        this._connecting = false;\n        this._registered = false;\n\n        if (wasClean) {\n          this.emit('disconnect');\n        } else {\n          const error = new Error(`[${code}] ${reason}`);\n          this.emit('disconnect', error);\n          reject(error);\n        }\n      };\n    });\n  }\n\n  _register(): Promise<void> {\n    if (!this._connected) return Promise.reject();\n    if (this._registered) return Promise.resolve();\n\n    const { name, auth } = this.options;\n\n    const nick = name || getRandomUsername();\n    const pass = auth ? `oauth:${auth}` : 'SCHMOOPIIE';\n\n    this.sendRaw('CAP REQ :twitch.tv/tags twitch.tv/commands');\n    this.sendRaw(`PASS ${pass}`);\n    this.sendRaw(`NICK ${nick}`);\n\n    return new Promise<void>((resolve, reject) => {\n      const handleRegister = () => {\n        resolve();\n        this.off('register', handleRegister);\n      };\n\n      this.on('register', handleRegister);\n\n      setTimeout(() => {\n        reject();\n        this.off('register', handleRegister);\n      }, 10000);\n    });\n  }\n\n  _updateGlobalUserState(globalUserState: GlobalUserStateTags) {\n    this.globalUserState = { ...this.globalUserState, ...globalUserState };\n  }\n\n  _updateUserState(channel: string, userState: UserStateTags) {\n    this.channels = {\n      ...this.channels,\n      [channel]: {\n        ...this.channels[channel],\n        userState,\n      },\n    };\n  }\n\n  _updateRoomState(channel: string, roomState: RoomStateTags) {\n    this.channels = {\n      ...this.channels,\n      [channel]: {\n        ...this.channels[channel],\n        roomState,\n      },\n    };\n  }\n\n  get connected() {\n    return this._connected;\n  }\n\n  get connecting() {\n    return this._connecting;\n  }\n\n  get registered() {\n    return this._registered;\n  }\n}\n\nexport default Client;\n","import tekko from 'tekko';\n\nexport const getRandomUsername = (): string => {\n  const randomSuffix = Math.floor(Math.random() * 100000)\n    .toString()\n    .padStart(5, '0');\n  return `justinfan${randomSuffix}`;\n};\n\nexport const getIsAction = (message: string): boolean =>\n  message.startsWith('\\u0001ACTION ') && message.endsWith('\\u0001');\n\nexport const normalizeActionMessage = (message: string): string =>\n  message.slice(8, -1);\n\nexport const getChannelFromMessage = (message: tekko.Message): string =>\n  message.middle[0].slice(1);\n\nexport const isNode = !!(\n  typeof process !== 'undefined' &&\n  process.versions &&\n  process.versions.node\n);\n","import tekko from 'tekko';\nimport { Emotes, BadgeInfo, Badges, TagType, Tags } from './types';\n\nconst booleanMessageTags = [\n  'mod',\n  'emote-only',\n  'r9k',\n  'rituals',\n  'subs-only',\n  'msg-param-should-share-streak',\n];\n\nconst numberMessageTags = [\n  'tmi-sent-ts',\n  'bits',\n  'ban-duration',\n  'msg-param-cumulative-months',\n  'msg-param-months',\n  'msg-param-promo-gift-total',\n  'msg-param-streak-months',\n  'msg-param-viewerCount',\n  'msg-param-threshold',\n];\n\nconst tagNamesMap: { [key: string]: string } = {\n  'badge-info': 'badgeInfo',\n  'display-name': 'displayName',\n  'emote-sets': 'emoteSets',\n  'room-id': 'roomId',\n  'tmi-sent-ts': 'tmiSentTs',\n  'user-id': 'userId',\n  'target-msg-id': 'targetMsgId',\n  'target-user-id': 'targetUserId',\n  'msg-id': 'msgId',\n  'system-msg': 'systemMsg',\n  'emote-only': 'emoteOnly',\n  'followers-only': 'followersOnly',\n  'subs-only': 'subsOnly',\n  'ban-duration': 'banDuration',\n  'message-id': 'messageId',\n  'thread-id': 'threadId',\n  'msg-param-cumulative-months': 'msgParamCumulativeMonths',\n  'msg-param-displayName': 'msgParamDisplayName',\n  'msg-param-login': 'msgParamLogin',\n  'msg-param-months': 'msgParamMonths',\n  'msg-param-promo-gift-total': 'msgParamPromoGiftTotal',\n  'msg-param-promo-name': 'msgParamPromoName',\n  'msg-param-recipient-display-name': 'msgParamRecipientDisplayName',\n  'msg-param-recipient-id': 'msgParamRecipientId',\n  'msg-param-recipient-user-name': 'msgParamRecipientUserName',\n  'msg-param-sender-login': 'msgParamSenderLogin',\n  'msg-param-sender-name': 'msgParamSenderName',\n  'msg-param-should-share-streak': 'msgParamShouldShareStreak',\n  'msg-param-streak-months': 'msgParamStreakMonths',\n  'msg-param-sub-plan': 'msgParamSubPlan',\n  'msg-param-sub-plan-name': 'msgParamSubPlanName',\n  'msg-param-viewerCount': 'msgParamViewerCount',\n  'msg-param-ritual-name': 'msgParamRitualName',\n  'msg-param-threshold': 'msgParamThreshold',\n};\n\nconst depricatedMessageTags = ['subscriber', 'turbo', 'user-type'];\n\nconst parseMessageEmotes = (raw: string = ''): Emotes => {\n  if (!raw) return {};\n\n  return raw.split('/').reduce((acc, emote) => {\n    const [id, indexes] = emote.split(':');\n\n    return {\n      ...acc,\n      [id]: indexes.split(',').map((index) => {\n        const [start, end] = index.split('-');\n\n        return {\n          start: Number.parseInt(start, 10),\n          end: Number.parseInt(end, 10),\n        };\n      }),\n    };\n  }, {});\n};\n\nconst parseBadges = (data: string = ''): BadgeInfo | Badges => {\n  if (!data) return {};\n\n  return data.split(',').reduce((acc, badge) => {\n    const [name, value] = badge.split('/');\n\n    return {\n      ...acc,\n      [name]: value,\n    };\n  }, {});\n};\n\nconst normalizeTagValue = (name: string, value: string): TagType => {\n  if (name === 'emotes') return parseMessageEmotes(value);\n  if (name === 'badges') return parseBadges(value);\n  if (name === 'badge-info') return parseBadges(value);\n\n  if (name === 'followers-only') {\n    let followersOnly: boolean | number = false;\n    if (value === '-1') {\n      followersOnly = false;\n    } else if (value === '0') {\n      followersOnly = true;\n    } else if (typeof value === 'string') {\n      followersOnly = parseInt(value, 10);\n    }\n    return followersOnly;\n  }\n\n  if (name === 'slow') {\n    let slow: boolean | number = false;\n    if (value === '0') {\n      slow = false;\n    } else if (typeof value === 'string') {\n      slow = parseInt(value, 10);\n    }\n    return slow;\n  }\n\n  if (booleanMessageTags.includes(name)) return value === '1';\n  if (numberMessageTags.includes(name)) return parseInt(value, 10);\n\n  if (typeof value === 'string') {\n    return value.replace('\\\\s', ' ');\n  }\n\n  return value;\n};\n\nexport const parseMessageTags = (data?: tekko.MessageTags): Tags => {\n  if (!data) {\n    return {};\n  }\n\n  return Object.entries(data).reduce((acc, [key, value]) => {\n    if (depricatedMessageTags.includes(key)) {\n      return acc;\n    }\n\n    const newKey = tagNamesMap[key] || key;\n\n    return {\n      ...acc,\n      [newKey]: normalizeTagValue(key, value as string),\n    };\n  }, {});\n};\n","import tekko from 'tekko';\n\nimport {\n  TekkoMessage,\n  GlobalUserStateEvent,\n  GlobalUserStateTags,\n  MessageEvent,\n  MessageTags,\n  WhisperEvent,\n  WhisperTags,\n} from './types';\nimport {\n  getIsAction,\n  normalizeActionMessage,\n  getChannelFromMessage,\n} from './utils';\nimport { parseMessageTags } from './parse';\n\nexport const normalizeChatMessage = (data: TekkoMessage): MessageEvent => {\n  const { raw, trailing, tags, prefix } = data;\n  const { name } = prefix as tekko.MessagePrefix;\n  const isAction = getIsAction(trailing);\n\n  return {\n    raw,\n    message: isAction ? normalizeActionMessage(trailing) : trailing,\n    channel: getChannelFromMessage(data),\n    user: name,\n    get tags() {\n      return (parseMessageTags(tags) as unknown) as MessageTags;\n    },\n    isAction,\n  };\n};\n\nexport const normalizeGlobalUserState = ({\n  raw,\n  tags,\n}: TekkoMessage): GlobalUserStateEvent => ({\n  raw,\n  get tags() {\n    return parseMessageTags(tags) as GlobalUserStateTags;\n  },\n});\n\nexport const normalizeState = (data: TekkoMessage) => {\n  const { raw, tags } = data;\n\n  return {\n    raw,\n    channel: getChannelFromMessage(data),\n    get tags() {\n      return parseMessageTags(tags);\n    },\n  };\n};\n\nexport const normalizeCommand = (data: TekkoMessage) => {\n  const { raw, trailing, tags } = data;\n\n  return {\n    raw,\n    message: trailing,\n    channel: getChannelFromMessage(data),\n    get tags() {\n      return parseMessageTags(tags);\n    },\n  };\n};\n\nexport const normalizeWhisper = ({\n  raw,\n  trailing,\n  tags,\n  prefix,\n  middle: [channel],\n}: TekkoMessage): WhisperEvent => {\n  const { name } = prefix as tekko.MessagePrefix;\n\n  return {\n    raw,\n    message: trailing,\n    channel,\n    user: name,\n    get tags() {\n      return (parseMessageTags(tags) as unknown) as WhisperTags;\n    },\n  };\n};\n","import tekko from 'tekko';\n\nexport interface TekkoMessage extends tekko.Message {\n  raw: string;\n}\n\nexport interface Emotes {\n  [emoteId: string]: Array<{ start: number; end: number }>;\n}\n\nexport interface BadgeInfo {\n  /**\n   * The exact number of months the user has been a subscriber.\n   */\n  subscriber?: number;\n}\n\nexport interface Badges {\n  admin?: string;\n  bits?: string;\n  broadcaster?: string;\n  global_mod?: string;\n  moderator?: string;\n  subscriber?: string;\n  staff?: string;\n  turbo?: string;\n}\n\nexport type TagType = string | boolean | number | Emotes | BadgeInfo | Badges;\n\nexport interface Tags {\n  [key: string]: TagType;\n}\n\ninterface ATags {\n  /**\n   * Metadata related to the chat badges in the `badges` tag.\n   */\n  badgeInfo: BadgeInfo;\n\n  /**\n   * List of chat badges and the version of each badge.\n   * Many badges have only 1 version, but some badges have different versions (images), depending on how long you hold the badge status; e.g., `subscriber`.\n   */\n  badges: Badges;\n\n  /**\n   * Hexadecimal RGB color code; the empty string if it is never set.\n   */\n  color: string;\n\n  /**\n   * The user’s display name, escaped as described in the IRCv3 spec. This is empty if it is never set.\n   */\n  displayName: string;\n\n  /**\n   * Your emote set, a comma-separated list of emote sets.\n   */\n  emoteSets: string;\n\n  /**\n   * Information to replace text in the message with emote images. This can be empty.\n   */\n  emotes: Emotes;\n\n  /**\n   * A unique ID for the message.\n   */\n  id: string;\n\n  /**\n   * `true` if the user has a moderator badge; otherwise, `false`.\n   */\n  mod: boolean;\n\n  /**\n   * The channel ID.\n   */\n  roomId: string;\n\n  /**\n   * Timestamp when the server received the message.\n   */\n  tmiSentTs: number;\n\n  /**\n   * The user’s ID.\n   */\n  userId: string;\n}\n\nexport interface MessageTags\n  extends Pick<\n    ATags,\n    | 'badgeInfo'\n    | 'badges'\n    | 'color'\n    | 'displayName'\n    | 'emotes'\n    | 'id'\n    | 'mod'\n    | 'roomId'\n    | 'tmiSentTs'\n    | 'userId'\n  > {\n  /**\n   * (Sent only for Bits messages) The amount of cheer/Bits employed by the user.\n   */\n  bits?: number;\n}\n\n/**\n * Sends a message to a channel.\n */\nexport interface MessageEvent {\n  raw: string;\n  message: string;\n  channel: string;\n  user: string;\n  tags: MessageTags;\n  isAction: boolean;\n}\n\nexport type GlobalUserStateTags = Pick<\n  ATags,\n  'badgeInfo' | 'badges' | 'color' | 'displayName' | 'emoteSets' | 'userId'\n>;\n\n/**\n * On successful login, provides data about the current logged-in user through IRC tags.\n * It is sent after successfully authenticating (sending a PASS/NICK command).\n */\nexport interface GlobalUserStateEvent {\n  raw: string;\n  tags: GlobalUserStateTags;\n}\n\nexport type UserStateTags = Pick<\n  ATags,\n  'badgeInfo' | 'badges' | 'color' | 'displayName' | 'emoteSets' | 'mod'\n>;\n\n/**\n * Sends user-state data when a user joins a channel or sends a PRIVMSG to a channel.\n */\nexport interface UserStateEvent {\n  raw: string;\n  channel: string;\n  tags: UserStateTags;\n}\n\nexport interface RoomStateTags extends Pick<ATags, 'roomId'> {\n  /**\n   * Emote-only mode. If enabled, only emotes are allowed in chat.\n   */\n  emoteOnly?: boolean;\n\n  /**\n   * Followers-only mode. If enabled, controls which followers can chat.\n   * Valid values:\n   * -1 (disabled),\n   * false (all followers can chat),\n   * non-negative integer (only users following for at least the specified number of minutes can chat).\n   */\n  followersOnly?: boolean | number;\n\n  /**\n   * R9K mode. If enabled, messages with more than 9 characters must be unique.\n   */\n  r9k?: boolean;\n\n  /**\n   * (Not documented)\n   */\n  rituals?: boolean;\n\n  /**\n   * The number of seconds a chatter without moderator privileges must wait between sending messages.\n   */\n  slow?: boolean | number;\n\n  /**\n   * Subscribers-only mode. If enabled, only subscribers and moderators can chat.\n   */\n  subsOnly?: boolean;\n}\n\n/**\n * Sends room-state data when a user joins a channel or a room setting is changed.\n * For a join, the message contains all chat-room settings.\n * For changes, only the relevant tag is sent.\n */\nexport interface RoomStateEvent {\n  raw: string;\n  channel: string;\n  tags: RoomStateTags;\n}\n\n/**\n * Purges all chat messages in a channel, or purges chat messages from a specific user (typically after a timeout or ban).\n */\nexport interface ClearChatEvent {\n  raw: string;\n  message: string;\n  channel: string;\n  tags: {\n    /**\n     * Duration of the timeout, in seconds. If omitted, the ban is permanent.\n     */\n    banDuration?: number;\n\n    /**\n     * (Not documented)\n     */\n    roomId: string;\n\n    /**\n     * (Not documented)\n     */\n    targetUserId?: string;\n\n    /**\n     * (Not documented)\n     */\n    tmiSentTs: number;\n  };\n}\n\n/**\n * Removes a single message from a channel. This is triggered by the `/delete <targetMsgId>` command on IRC.\n */\nexport interface ClearMessageEvent {\n  raw: string;\n  message: string;\n  channel: string;\n  tags: {\n    /**\n     * Name of the user who sent the message.\n     */\n    login: string;\n\n    /**\n     * UUID of the message.\n     */\n    targetMsgId: string;\n\n    /**\n     * (Not documented)\n     */\n    tmiSentTs: number;\n  };\n}\n\n/**\n * Channel starts or stops host mode.\n */\nexport interface HostTargetEvent {\n  raw: string;\n  message: string;\n  channel: string;\n  tags: {};\n}\n\n/**\n * General notices from the server.\n */\nexport interface NoticeEvent {\n  raw: string;\n  message: string;\n  channel: string;\n  tags: {\n    /**\n     * A message ID string. Can be used for i18ln.\n     * Valid values: see https://dev.twitch.tv/docs/irc/msg-id\n     */\n    msgId: string;\n  };\n}\n\nexport enum UserNoticeType {\n  sub = 'sub',\n  resub = 'resub',\n  subgift = 'subgift',\n  anonsubgift = 'anonsubgift',\n  submysterygift = 'submysterygift',\n  giftpaidupgrade = 'giftpaidupgrade',\n  rewardgift = 'rewardgift',\n  anongiftpaidupgrade = 'anongiftpaidupgrade',\n  raid = 'raid',\n  unraid = 'unraid',\n  ritual = 'ritual',\n  bitsbadgetier = 'bitsbadgetier',\n}\n\ninterface AUserNoticeTags {\n  /**\n   * (Sent only on sub, resub) The total number of months the user has subscribed.\n   * This is the same as msg-param-months but sent for different types of user notices.\n   */\n  msgParamCumulativeMonths: number;\n\n  /**\n   * (Sent only on raid) The display name of the source user raiding this channel.\n   */\n  msgParamDisplayName: string;\n\n  /**\n   * (Sent on only raid) The name of the source user raiding this channel.\n   */\n  msgParamLogin: string;\n\n  /**\n   * (Sent only on subgift, anonsubgift) The total number of months the user has subscribed.\n   * This is the same as msg-param-cumulative-months but sent for different types of user notices.\n   */\n  msgParamMonths: number;\n\n  /**\n   * (Sent only on anongiftpaidupgrade, giftpaidupgrade) The number of gifts the gifter has given during the promo indicated by msg-param-promo-name.\n   */\n  msgParamPromoGiftTotal: number;\n\n  /**\n   * (Sent only on anongiftpaidupgrade, giftpaidupgrade) The subscriptions promo, if any, that is ongoing; e.g. Subtember 2018.\n   */\n  msgParamPromoName: string;\n\n  /**\n   * (Sent only on subgift, anonsubgift) The display name of the subscription gift recipient.\n   */\n  msgParamRecipientDisplayName: string;\n\n  /**\n   * (Sent only on subgift, anonsubgift) The user ID of the subscription gift recipient.\n   */\n  msgParamRecipientId: string;\n\n  /**\n   * (Sent only on subgift, anonsubgift) The user name of the subscription gift recipient.\n   */\n  msgParamRecipientUserName: string;\n\n  /**\n   * (Sent only on giftpaidupgrade) The login of the user who gifted the subscription.\n   */\n  msgParamSenderLogin: string;\n\n  /**\n   * (Sent only on giftpaidupgrade) The display name of the user who gifted the subscription.\n   */\n  msgParamSenderName: string;\n\n  /**\n   * (Sent only on sub, resub) Boolean indicating whether users want their streaks to be shared.\n   */\n  msgParamShouldShareStreak: boolean;\n\n  /**\n   * (Sent only on sub, resub) The number of consecutive months the user has subscribed. This is 0 if msg-param-should-share-streak is 0.\n   */\n  msgParamStreakMonths: number;\n\n  /**\n   * (Sent only on sub, resub, subgift, anonsubgift) The type of subscription plan being used.\n   * Valid values: Prime, 1000, 2000, 3000. 1000, 2000, and 3000 refer to the first, second, and third levels of paid subscriptions, respectively (currently $4.99, $9.99, and $24.99).\n   */\n  msgParamSubPlan: string;\n\n  /**\n   * (Sent only on sub, resub, subgift, anonsubgift) The display name of the subscription plan.\n   * This may be a default name or one created by the channel owner.\n   */\n  msgParamSubPlanName: string;\n\n  /**\n   * (Sent only on raid) The number of viewers watching the source channel raiding this channel.\n   */\n  msgParamViewerCount: number;\n\n  /**\n   * (Sent only on ritual) The name of the ritual this notice is for. Valid value: new_chatter.\n   */\n  msgParamRitualName: string;\n\n  /**\n   * (Sent only on bitsbadgetier) The tier of the bits badge the user just earned; e.g. 100, 1000, 10000.\n   */\n  msgParamThreshold: number;\n}\n\ninterface ABaseUserNoticeTags\n  extends Pick<\n    ATags,\n    | 'badgeInfo'\n    | 'badges'\n    | 'color'\n    | 'displayName'\n    | 'emotes'\n    | 'id'\n    | 'mod'\n    | 'roomId'\n    | 'tmiSentTs'\n    | 'userId'\n  > {\n  /**\n   * The name of the user who sent the notice.\n   */\n  login: string;\n\n  /**\n   * The message printed in chat along with this notice.\n   */\n  systemMsg: string;\n}\n\ninterface UserNoticeTagsSub\n  extends ABaseUserNoticeTags,\n    Pick<\n      AUserNoticeTags,\n      | 'msgParamCumulativeMonths'\n      | 'msgParamShouldShareStreak'\n      | 'msgParamStreakMonths'\n      | 'msgParamSubPlan'\n      | 'msgParamSubPlanName'\n    > {\n  /**\n   * The type of notice (not the ID).\n   */\n  msgId: 'sub';\n}\n\ninterface UserNoticeTagsResub\n  extends ABaseUserNoticeTags,\n    Pick<\n      AUserNoticeTags,\n      | 'msgParamCumulativeMonths'\n      | 'msgParamShouldShareStreak'\n      | 'msgParamStreakMonths'\n      | 'msgParamSubPlan'\n      | 'msgParamSubPlanName'\n    > {\n  msgId: 'resub';\n}\n\ninterface UserNoticeTagsSubGift\n  extends ABaseUserNoticeTags,\n    Pick<\n      AUserNoticeTags,\n      | 'msgParamMonths'\n      | 'msgParamRecipientDisplayName'\n      | 'msgParamRecipientId'\n      | 'msgParamRecipientUserName'\n      | 'msgParamSubPlan'\n      | 'msgParamSubPlanName'\n    > {\n  msgId: 'subgift';\n}\n\ninterface UserNoticeTagsAnonSubGift\n  extends ABaseUserNoticeTags,\n    Pick<\n      AUserNoticeTags,\n      | 'msgParamMonths'\n      | 'msgParamRecipientDisplayName'\n      | 'msgParamRecipientId'\n      | 'msgParamRecipientUserName'\n      | 'msgParamSubPlan'\n      | 'msgParamSubPlanName'\n    > {\n  msgId: 'anonsubgift';\n}\n\ninterface UserNoticeTagsSubMysteryGift extends ABaseUserNoticeTags {\n  msgId: 'submysterygift';\n}\n\ninterface UserNoticeTagsGiftPaidUpgrade\n  extends ABaseUserNoticeTags,\n    Pick<\n      AUserNoticeTags,\n      | 'msgParamPromoGiftTotal'\n      | 'msgParamPromoName'\n      | 'msgParamSenderLogin'\n      | 'msgParamSenderName'\n    > {\n  msgId: 'giftpaidupgrade';\n}\n\ninterface UserNoticeTagsAnonGiftPaidUpgrade\n  extends ABaseUserNoticeTags,\n    Pick<AUserNoticeTags, 'msgParamPromoGiftTotal' | 'msgParamPromoName'> {\n  msgId: 'anongiftpaidupgrade';\n}\n\ninterface UserNoticeTagsRewardGift extends ABaseUserNoticeTags {\n  msgId: 'rewardgift';\n}\n\ninterface UserNoticeTagsRaid\n  extends ABaseUserNoticeTags,\n    Pick<\n      AUserNoticeTags,\n      'msgParamDisplayName' | 'msgParamLogin' | 'msgParamViewerCount'\n    > {\n  msgId: 'raid';\n}\n\ninterface UserNoticeTagsUnraid extends ABaseUserNoticeTags {\n  msgId: 'unraid';\n}\n\ninterface UserNoticeTagsRitual\n  extends ABaseUserNoticeTags,\n    Pick<AUserNoticeTags, 'msgParamRitualName'> {\n  msgId: 'ritual';\n}\n\ninterface UserNoticeTagsBitsBadGetier\n  extends ABaseUserNoticeTags,\n    Pick<AUserNoticeTags, 'msgParamThreshold'> {\n  msgId: 'bitsbadgetier';\n}\n\ntype UserNoticeTags =\n  | UserNoticeTagsSub\n  | UserNoticeTagsResub\n  | UserNoticeTagsSubGift\n  | UserNoticeTagsAnonSubGift\n  | UserNoticeTagsSubMysteryGift\n  | UserNoticeTagsGiftPaidUpgrade\n  | UserNoticeTagsAnonGiftPaidUpgrade\n  | UserNoticeTagsRewardGift\n  | UserNoticeTagsRaid\n  | UserNoticeTagsUnraid\n  | UserNoticeTagsRitual\n  | UserNoticeTagsBitsBadGetier;\n\n/**\n * Sends a notice to the user when any of the following events occurs:\n * - Subscription, resubscription, or gift subscription to a channel.\n * - Incoming raid to a channel.\n *   Raid is a Twitch tool that allows broadcasters to send their viewers to another channel, to help support and grow other members in the community.\n * - Channel ritual.\n *   Many channels have special rituals to celebrate viewer milestones when they are shared.\n *   The rituals notice extends the sharing of these messages to other viewer milestones (initially, a new viewer chatting for the first time).\n */\nexport interface UserNoticeEvent {\n  raw: string;\n  /**\n   * The message. This is omitted if the user did not enter a message.\n   */\n  message: string;\n  channel: string;\n  tags: UserNoticeTags;\n}\n\nexport interface WhisperTags\n  extends Pick<\n    ATags,\n    'badges' | 'color' | 'displayName' | 'emotes' | 'userId'\n  > {\n  /**\n   * (Not documented)\n   */\n  messageId: string;\n\n  /**\n   * (Not documented)\n   */\n  threadId: string;\n}\n\n/**\n * (Not documented)\n */\nexport interface WhisperEvent {\n  raw: string;\n  message: string;\n  channel: string;\n  user: string;\n  tags: WhisperTags;\n}\n\nexport interface PingEvent {\n  raw: string;\n}\n\n/**\n * Join a channel.\n */\nexport interface JoinEvent {\n  raw: string;\n  channel: string;\n  user: string;\n}\n\n/**\n * Depart from a channel.\n */\nexport interface PartEvent {\n  raw: string;\n  channel: string;\n  user: string;\n}\n","import * as R from 'ramda';\nimport { createSelector } from '@reduxjs/toolkit';\n\nimport * as api from 'api';\nimport * as htmlEntity from 'features/chat/utils/htmlEntity';\nimport type { StateEmotes } from 'features/chat/selectors';\nimport getEmotesByText from 'features/chat/utils/getEmotesByText';\nimport { getEmotesFromUsageStatistic } from 'features/chat/utils/emotesUsageStatistic';\n\nexport type EmoteCategory = {\n  title?: string;\n  items: htmlEntity.Emote[];\n};\n\nconst getTwitchUserEmoteCategories = R.pipe<\n  Record<string, api.TwitchEmote[]>,\n  api.TwitchEmote[][],\n  EmoteCategory[]\n>(\n  R.values,\n  R.map((items) => ({ items: R.map(htmlEntity.createTwitchEmote, items) })),\n);\n\nconst createMainEmoteCategories = (emotes: StateEmotes) => {\n  if (!emotes) return [];\n\n  const {\n    twitchGlobal,\n    twitchUser,\n    bttvGlobal,\n    bttvChannel,\n    ffzGlobal,\n    ffzChannel,\n  } = emotes;\n\n  return [\n    {\n      title: 'BetterTTV Channel Emotes',\n      items: bttvChannel.map(htmlEntity.createBttvEmote),\n    },\n    {\n      title: 'FrankerFaceZ Channel Emotes',\n      items: ffzChannel.map(htmlEntity.createFfzEmote),\n    },\n    ...getTwitchUserEmoteCategories(twitchUser),\n    {\n      title: 'Twitch',\n      items: R.map(\n        htmlEntity.createTwitchEmote,\n        R.propOr([], '0', twitchGlobal),\n      ),\n    },\n    {\n      title: 'BetterTTV',\n      items: bttvGlobal.map(htmlEntity.createBttvEmote),\n    },\n    {\n      title: 'FrankerFaceZ',\n      items: ffzGlobal.map(htmlEntity.createFfzEmote),\n    },\n  ].filter(R.path(['items', 'length'])) as EmoteCategory[];\n};\n\nconst getMainEmoteCategories = createSelector(\n  (emotes: any) => emotes,\n  createMainEmoteCategories,\n);\n\nconst createEmoteCategories = (emotes: StateEmotes, text: string) => {\n  if (!emotes) return [];\n\n  if (text) {\n    const items = getEmotesByText(text, emotes);\n    const title = `${items.length ? '' : 'No '}Search Results for \"${text}\"`;\n\n    return [{ title, items }];\n  }\n\n  const mainEmoteCategories = getMainEmoteCategories(emotes);\n  const frequentlyUsed = getEmotesFromUsageStatistic(emotes);\n\n  if (!frequentlyUsed.length) {\n    return mainEmoteCategories;\n  }\n\n  const frequentlyUsedCategory = {\n    title: 'Frequently Used',\n    items: frequentlyUsed,\n  };\n\n  return [frequentlyUsedCategory, ...mainEmoteCategories] as EmoteCategory[];\n};\n\nexport default createEmoteCategories;\n","import * as R from 'ramda';\nimport { createSelector } from '@reduxjs/toolkit';\n\nimport * as api from 'api';\nimport type { RootState } from 'app/rootReducer';\nimport * as htmlEntity from 'features/chat/utils/htmlEntity';\nimport type { ChatMessage } from 'features/chat/slice/messages';\nimport createEmoteCategories from 'features/chat/utils/createEmoteCategories';\n\nexport type StateEmotes = {\n  twitchGlobal: Record<string, api.TwitchEmote[]>;\n  twitchUser: Record<string, api.TwitchEmote[]>;\n  bttvGlobal: api.BttvGlobalEmote[];\n  bttvChannel: api.BttvChannelEmote[];\n  ffzGlobal: api.FfzEmote[];\n  ffzChannel: api.FfzEmote[];\n} | null;\n\nexport const currentChannelSelector = (state: RootState) =>\n  state.chat.currentChannel;\n\nexport const isConnectedSelector = (state: RootState) => state.chat.isConnected;\n\n// messages\n\nexport const messagesSelector = (state: RootState): ChatMessage[] =>\n  state.chat.messages[currentChannelSelector(state)]?.items || [];\n\nexport const usersSelector = (state: RootState): string[] =>\n  state.chat.messages[currentChannelSelector(state)]?.users || [];\n\nexport const isHistoryLoadedSelector = (state: RootState) => {\n  const currentChannel = currentChannelSelector(state);\n\n  return (\n    state.chat.messages[currentChannel]?.history.status === 'success' ||\n    state.chat.messages[currentChannel]?.history.status === 'error' ||\n    false\n  );\n};\n\nexport const isHistoryAddedSelector = (state: RootState) =>\n  state.chat.messages[currentChannelSelector(state)]?.history.isAdded || false;\n\nexport const isEvenSelector = (state: RootState) =>\n  state.chat.messages[currentChannelSelector(state)]?.isEven || false;\n\n// emotes isLoaded\n\nexport const isTwitchEmotesLoadedSelector = (state: RootState) =>\n  state.chat.twitchEmotes.status === 'success' ||\n  state.chat.twitchEmotes.status === 'error';\n\nexport const isBttvGlobalEmotesLoadedSelector = (state: RootState) =>\n  state.chat.bttvEmotes.global.status === 'success' ||\n  state.chat.bttvEmotes.global.status === 'error';\n\nexport const isBttvChannelEmotesLoadedSelector = (state: RootState) => {\n  const currentChannel = currentChannelSelector(state);\n\n  return (\n    state.chat.bttvEmotes.byChannels[currentChannel]?.status === 'success' ||\n    state.chat.bttvEmotes.byChannels[currentChannel]?.status === 'error' ||\n    false\n  );\n};\n\nexport const isBttvEmotesLoadedSelector = (state: RootState) =>\n  isBttvGlobalEmotesLoadedSelector(state) &&\n  isBttvChannelEmotesLoadedSelector(state);\n\nexport const isFfzGlobalEmotesLoadedSelector = (state: RootState) =>\n  state.chat.ffzEmotes.global.status === 'success' ||\n  state.chat.ffzEmotes.global.status === 'error';\n\nexport const isFfzChannelEmotesLoadedSelector = (state: RootState) => {\n  const currentChannel = currentChannelSelector(state);\n\n  return (\n    state.chat.ffzEmotes.byChannels[currentChannel]?.status === 'success' ||\n    state.chat.ffzEmotes.byChannels[currentChannel]?.status === 'error' ||\n    false\n  );\n};\n\nexport const isFfzEmotesLoadedSelector = (state: RootState) =>\n  isFfzGlobalEmotesLoadedSelector(state) &&\n  isFfzChannelEmotesLoadedSelector(state);\n\nexport const isEmotesLoadedSelector = (state: RootState) =>\n  isTwitchEmotesLoadedSelector(state) &&\n  isBttvGlobalEmotesLoadedSelector(state) &&\n  isBttvChannelEmotesLoadedSelector(state) &&\n  isFfzGlobalEmotesLoadedSelector(state) &&\n  isFfzChannelEmotesLoadedSelector(state);\n\n// emotes\nconst twitchEmotesSelector = (state: RootState) =>\n  state.chat.twitchEmotes.items;\nconst twitchGlobalEmotesSelector = createSelector(\n  twitchEmotesSelector,\n  R.pick(['0']),\n);\nconst twitchUserEmotesSelector = createSelector(\n  twitchEmotesSelector,\n  R.omit(['0']),\n);\n\nconst bttvGlobalEmotesSelector = (state: RootState) =>\n  state.chat.bttvEmotes.global.items;\nconst bttvChannelEmotesSelector = (state: RootState) =>\n  state.chat.bttvEmotes.byChannels[currentChannelSelector(state)]?.items || [];\n\nconst ffzGlobalEmotesSelector = (state: RootState) =>\n  state.chat.ffzEmotes.global.items;\nconst ffzChannelEmotesSelector = (state: RootState) =>\n  state.chat.ffzEmotes.byChannels[currentChannelSelector(state)]?.items || [];\n\nexport const emotesSelector = createSelector(\n  isEmotesLoadedSelector,\n  twitchGlobalEmotesSelector,\n  twitchUserEmotesSelector,\n  bttvGlobalEmotesSelector,\n  bttvChannelEmotesSelector,\n  ffzGlobalEmotesSelector,\n  ffzChannelEmotesSelector,\n  (\n    isEmotesLoaded,\n    twitchGlobal,\n    twitchUser,\n    bttvGlobal,\n    bttvChannel,\n    ffzGlobal,\n    ffzChannel,\n  ) => {\n    if (!isEmotesLoaded) return null;\n\n    return {\n      twitchGlobal,\n      twitchUser,\n      bttvGlobal,\n      bttvChannel,\n      ffzGlobal,\n      ffzChannel,\n    } as StateEmotes;\n  },\n);\n\nexport const emoteCategoriesSelector = (state: RootState, search: string) => {\n  const emotes = emotesSelector(state);\n\n  return createEmoteCategories(emotes, search);\n};\n\n// Badges\n\nexport const userBadgesSelector = (state: RootState) =>\n  state.chat.params.byChannels[currentChannelSelector(state)]?.user?.badges ||\n  {};\n\nexport const isGlobalBadgesLoadedSelector = (state: RootState) =>\n  state.chat.badges.global.status === 'success' ||\n  state.chat.badges.global.status === 'error';\n\nexport const isChannelBadgesLoadedSelector = (state: RootState) =>\n  state.chat.badges.byChannels[currentChannelSelector(state)]?.status ===\n    'success' ||\n  state.chat.badges.byChannels[currentChannelSelector(state)]?.status ===\n    'error';\n\nexport const isBadgesLoadedSelector = (state: RootState) =>\n  isGlobalBadgesLoadedSelector(state) && isChannelBadgesLoadedSelector(state);\n\nexport const globalBadgesSelector = (state: RootState) =>\n  state.chat.badges.global.items;\n\nexport const channelBadgesSelector = (state: RootState) =>\n  state.chat.badges.byChannels[currentChannelSelector(state)]?.items || {};\n\nexport const userBadgesImagesSelector = createSelector(\n  userBadgesSelector,\n  globalBadgesSelector,\n  channelBadgesSelector,\n  htmlEntity.createBadges,\n);\n\n// params\n\nexport const currentChannelIdSelector = (state: RootState) =>\n  state.chat.params.byChannels[currentChannelSelector(state)]?.room?.roomId ||\n  '';\n\nexport const userColorSelector = (state: RootState) =>\n  state.chat.params.byChannels[currentChannelSelector(state)]?.user?.color ||\n  '';\n\nexport const userDisplayNameSelector = (state: RootState) =>\n  state.chat.params.byChannels[currentChannelSelector(state)]?.user\n    ?.displayName || '';\n\n// blocked users\n\nexport const isBlockedUsersLoadedSelector = (state: RootState) =>\n  state.chat.blockedUsers.status !== 'idle' &&\n  state.chat.blockedUsers.status !== 'loading';\n\nexport const blockedUsersSelector = (state: RootState) =>\n  state.chat.blockedUsers.items;\n","import { LS_OPTIONS } from 'utils/constants';\n\nexport const readOptionsFromLocalStorage = (): object => {\n  try {\n    const options = localStorage.getItem(LS_OPTIONS);\n    return JSON.parse(options as string) || {};\n  } catch {\n    return {};\n  }\n};\n\nexport const writeOptionsToLocalStore = (options: object): void => {\n  localStorage.setItem(\n    LS_OPTIONS,\n    JSON.stringify({\n      ...readOptionsFromLocalStorage(),\n      ...options,\n    }),\n  );\n};\n","/* eslint-disable no-param-reassign */\nimport { createSlice, PayloadAction } from '@reduxjs/toolkit';\n\nimport { AppThunk } from 'app/store';\nimport {\n  writeOptionsToLocalStore,\n  readOptionsFromLocalStorage,\n} from 'features/options/optionsUtils';\n\ntype OptionsState = {\n  showTimestamps: boolean;\n  splitChat: boolean;\n  blacklistKeywords: string;\n  highlightKeywords: string;\n  fixedWidth: boolean;\n};\n\ntype ChangeOption = {\n  name: keyof OptionsState;\n  value: any;\n};\n\nexport const initialState: OptionsState = {\n  showTimestamps: false,\n  splitChat: true,\n  blacklistKeywords: '',\n  highlightKeywords: '',\n  fixedWidth: false,\n  ...readOptionsFromLocalStorage(),\n};\n\nconst options = createSlice({\n  name: 'options',\n  initialState,\n  reducers: {\n    changeOption: (state, { payload }: PayloadAction<ChangeOption>): void => {\n      const { name, value } = payload;\n      (state[name] as unknown) = value;\n    },\n  },\n});\n\nexport const { changeOption } = options.actions;\n\nexport default options.reducer;\n\nexport const changeChatOption = ({\n  name,\n  value,\n}: ChangeOption): AppThunk => async (dispatch): Promise<void> => {\n  writeOptionsToLocalStore({ [name]: value });\n  dispatch(changeOption({ name, value }));\n};\n","export const TWITCH_API_AUTH_BASE = 'https://id.twitch.tv/oauth2/authorize';\n\nexport const TWITCH_API_CLIENT_ID = process.env.REACT_APP_TWITCH_API_CLIENT_ID;\nexport const TWITCH_API_REDIRECT_URI =\n  process.env.REACT_APP_TWITCH_API_REDIRECT_URI;\n\nexport const CHANNEL_MESSAGES_LIMIT = 500;\nexport const STORE_USERS_LIMIT = 500;\n\nexport const API_REQUESTS_TIMEOUT = 10000;\n\n// local storage keys\nexport const LS_ACCESS_TOKEN = 'accessToken';\nexport const LS_ID_TOKEN = 'idToken';\nexport const LS_LAST_CHANNEL = 'lastChannel';\nexport const LS_USER = 'user';\nexport const LS_EMOTES_USAGE_STATISTIC = 'emotesUsageStatistic';\nexport const LS_OPTIONS = 'options';\n\nexport const SUGGESTION_TYPES = {\n  users: {\n    name: 'users',\n    limit: 5,\n    regex: /^@([\\w\\d_]*)$/,\n  },\n  emotes: {\n    name: 'emotes',\n    limit: 10,\n    regex: /^:([\\w\\d_]{2,})$/,\n  },\n};\n\nexport const NOTICE_MESSAGE_TAGS = [\n  'msg_banned',\n  'msg_bad_characters',\n  'msg_channel_blocked',\n  'msg_channel_suspended',\n  'msg_duplicate',\n  'msg_emoteonly',\n  'msg_facebook',\n  'msg_followersonly',\n  'msg_followersonly_followed',\n  'msg_followersonly_zero',\n  'msg_r9k',\n  'msg_ratelimit',\n  'msg_rejected',\n  'msg_rejected_mandatory',\n  'msg_room_not_found',\n  'msg_slowmode',\n  'msg_subsonly',\n  'msg_suspended',\n  'msg_timedout',\n  'msg_verified_email',\n];\n","const assertNever = (value: never): never => value;\n\nexport default assertNever;\n","/* eslint-disable no-restricted-syntax */\nimport * as htmlEntity from 'features/chat/utils/htmlEntity';\nimport { StateEmotes } from 'features/chat/selectors/chatSelectors';\nimport findEmote from 'features/chat/utils/findEmote';\n\nexport type EmotesByText = {\n  begins: htmlEntity.Emote[];\n  contains: htmlEntity.Emote[];\n};\n\nconst getEmotesByText = (\n  text: string,\n  emotes: StateEmotes,\n  limit = -1,\n): htmlEntity.Emote[] => {\n  if (!emotes) return [];\n\n  const result: EmotesByText = {\n    begins: [],\n    contains: [],\n  };\n  const textLower = text.toLowerCase();\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const isOver =\n    findEmote.bttv.byText(result, emotes.bttvChannel, textLower, limit) ||\n    findEmote.ffz.byText(result, emotes.ffzChannel, textLower, limit) ||\n    findEmote.twitch.byText(result, emotes.twitchUser, textLower, limit) ||\n    findEmote.twitch.byText(result, emotes.twitchGlobal, textLower, limit) ||\n    findEmote.bttv.byText(result, emotes.bttvGlobal, textLower, limit) ||\n    findEmote.ffz.byText(result, emotes.ffzGlobal, textLower, limit);\n\n  return [...result.begins, ...result.contains];\n};\n\nexport default getEmotesByText;\n","import * as R from 'ramda';\n\nimport { LS_EMOTES_USAGE_STATISTIC } from 'utils/constants';\nimport * as htmlEntity from 'features/chat/utils/htmlEntity';\nimport findEmote from 'features/chat/utils/findEmote';\nimport { StateEmotes } from 'features/chat/selectors';\nimport { MessageEntity } from 'features/chat/slice/messages';\n\ntype Type = 'twitch-emote' | 'bttv-emote' | 'ffz-emote';\n\ntype AUsageItem = {\n  lastUpdatedAt: number;\n  uses: number;\n};\n\ntype UsageItemTwitchFfz = AUsageItem & {\n  type: 'twitch-emote' | 'ffz-emote';\n  id: number;\n};\n\ntype UsageItemBttv = AUsageItem & {\n  type: 'bttv-emote';\n  id: string;\n};\n\ntype UsageItem = UsageItemTwitchFfz | UsageItemBttv;\n\ntype EmotesUsageStatistic = Record<Type, Record<string, UsageItem>>;\n\nexport const readEmotesUsageStatistic = (): Partial<EmotesUsageStatistic> => {\n  try {\n    const statistic = localStorage.getItem(LS_EMOTES_USAGE_STATISTIC);\n\n    return JSON.parse(statistic as string) || {};\n  } catch (e) {\n    return {};\n  }\n};\n\nexport const getUsageStatisticFromEntities = R.pipe<\n  MessageEntity[],\n  any,\n  any,\n  any\n>(\n  R.filter((v: any) =>\n    R.includes(R.prop('type', v), ['twitch-emote', 'bttv-emote', 'ffz-emote']),\n  ),\n  R.groupBy<any>(R.prop('type')),\n  R.map(\n    R.pipe<any, any, any>(\n      R.groupBy<any>(R.prop('id')),\n      R.map((items: any) => ({\n        type: items[0].type,\n        id: items[0].id,\n        lastUpdatedAt: Date.now(),\n        uses: items.length,\n      })),\n    ),\n  ),\n);\n\nconst mergeFn = (key: string, left: any, right: any) =>\n  key === 'uses' ? left + right : right;\n\nexport const writeEmotesUsageStatistic = (entries: MessageEntity[]) => {\n  const statistic = getUsageStatisticFromEntities(entries) as Partial<\n    EmotesUsageStatistic\n  >;\n\n  if (R.isEmpty(statistic)) return;\n\n  const history = readEmotesUsageStatistic();\n\n  const newHistory = R.mergeDeepWithKey(mergeFn, history, statistic);\n\n  localStorage.setItem(LS_EMOTES_USAGE_STATISTIC, JSON.stringify(newHistory));\n};\n\nconst normalizeHistory = R.pipe<any, any, any, any, UsageItem[]>(\n  R.values,\n  R.map(R.values),\n  R.flatten,\n  R.sortWith([R.descend(R.prop('uses')), R.descend(R.prop('lastUpdatedAt'))]),\n);\n\nexport const getEmotesFromUsageStatistic = (\n  emotes: StateEmotes,\n  limit = 27,\n) => {\n  if (!emotes) return [];\n\n  const result: htmlEntity.Emote[] = [];\n  const history = R.pipe(readEmotesUsageStatistic, normalizeHistory)();\n\n  // eslint-disable-next-line no-restricted-syntax\n  for (const item of history) {\n    if (result.length === limit) return result;\n\n    let emoteEntity = null;\n\n    if (item.type === 'twitch-emote') {\n      emoteEntity = findEmote.twitch.byId(item.id, emotes);\n    }\n\n    if (item.type === 'bttv-emote') {\n      emoteEntity = findEmote.bttv.byId(item.id, emotes);\n    }\n\n    if (item.type === 'ffz-emote') {\n      emoteEntity = findEmote.ffz.byId(item.id, emotes);\n    }\n\n    if (emoteEntity) {\n      result.push(emoteEntity);\n    }\n  }\n\n  return result;\n};\n"],"sourceRoot":""}